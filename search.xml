<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ‰‹åŠ¨å®ç° Java NIO</title>
      <link href="/2020/java-NIO-implement/"/>
      <url>/2020/java-NIO-implement/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>NIOæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œåœ¨Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBufferç­‰æŠ½è±¡ã€‚</p><p>NIOä¸­çš„Nå¯ä»¥ç†è§£ä¸ºNon-blockingï¼Œä¸å•çº¯æ˜¯Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„I/Oæ“ä½œæ–¹æ³•ã€‚ NIOæä¾›äº†ä¸ä¼ ç»ŸBIOæ¨¡å‹ä¸­çš„ <code>Socket</code> å’Œ <code>ServerSocket</code> ç›¸å¯¹åº”çš„ <code>SocketChannel</code> å’Œ <code>ServerSocketChannel</code> ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡I/Oæ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</p><a id="more"></a><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><p>è¿™é‡Œæ‰‹æ’¸äº†ä¸€ä¸ªNIOçš„å®ç°ä»£ç ï¼Œéœ€è¦åˆ†åˆ«å®ç° Server å’Œ Client ï¼š</p><p><strong>NIOClient.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.garen.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> ByteBuffer byteBuffer;</span><br><span class="line">    <span class="keyword">private</span> SocketChannel socketChannel;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectServer</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        socketChannel = socketChannel.open();</span><br><span class="line">        socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">"127.0.0.1"</span>, <span class="number">8990</span>));</span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        byteBuffer = ByteBuffer.allocate(size);</span><br><span class="line">        receive();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            byteBuffer.clear();</span><br><span class="line">            <span class="keyword">int</span> count;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//å¦‚æœæ²¡æœ‰æ•°æ®å¯è¯»ï¼Œåˆ™readæ–¹æ³•ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°è¯»å–åˆ°æ–°çš„æ•°æ®</span></span><br><span class="line">            <span class="keyword">while</span> ((count = socketChannel.read(byteBuffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                byteBuffer.flip();</span><br><span class="line">                <span class="keyword">while</span> (byteBuffer.hasRemaining()) &#123;</span><br><span class="line">                    System.out.print((<span class="keyword">char</span>) byteBuffer.get());</span><br><span class="line">                &#125;</span><br><span class="line">                send2Server(<span class="string">"say hi"</span>.getBytes());</span><br><span class="line">                byteBuffer.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send2Server</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        byteBuffer.put(bytes);</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        socketChannel.write(byteBuffer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> NIOClient().connectServer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸­å®šä¹‰äº†åä¸ºNIOClientçš„ç±»æ¥å®ç°å®¢æˆ·ç«¯çš„Channelé€»è¾‘ï¼Œå…¶ä¸­ï¼Œ<strong><code>connectServer</code></strong>æ–¹æ³•ç”¨äºå’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼Œ<strong><code>receive</code></strong>æ–¹æ³•ç”¨äºæ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ•°æ®ï¼Œ<strong><code>send2Server</code></strong>ç”¨äºå‘æœåŠ¡ç«¯å‘é€æ•°æ®ã€‚</p><p><strong>NIOServer.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.garen.socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NIOServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> ServerSocketChannel serverSocketChannel;</span><br><span class="line">    <span class="keyword">private</span> ByteBuffer byteBuffer;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> remoteClientNum = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NIOServer</span><span class="params">(<span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            initChannel(port);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.exit(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Channelåˆå§‹åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//æ‰“å¼€Channel</span></span><br><span class="line">        serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">        <span class="comment">//è®¾ä¸ºéé˜»å¡æ¨¡å¼</span></span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//ç»‘å®šç«¯å£</span></span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line">        System.out.println(<span class="string">"listen the port : "</span> + port);</span><br><span class="line">        <span class="comment">//åˆ›å»ºé€‰æ‹©å™¨</span></span><br><span class="line">        selector = Selector.open();</span><br><span class="line">        <span class="comment">//å‘é€‰æ‹©å™¨æ³¨å†Œé€šé“</span></span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        <span class="comment">//åˆ†é…ç¼“å†²åŒº</span></span><br><span class="line">        byteBuffer = ByteBuffer.allocate(size);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç›‘å¬å™¨ ç”¨äºç›‘å¬Channelä¸Šçš„æ•°æ®å˜åŒ–</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">listener</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//è¿”å›nè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªChannelå¤„äºå°±ç»ªè½¬æ€</span></span><br><span class="line">            <span class="keyword">int</span> n = selector.select();</span><br><span class="line">            <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ¯ä¸ªSelectorå¯¹åº”å¤šä¸ªSelectionKey,æ¯ä¸ªSelectionKeyå¯¹åº”ä¸€ä¸ªChannel</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                SelectionKey selectionKey = iterator.next();</span><br><span class="line">                <span class="comment">//å¦‚æœSelectionKeyå¤„äºè¿æ¥å°±ç»ªçŠ¶æ€ï¼Œåˆ™å¼€å§‹æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class="line">                    <span class="comment">//è·å–Channel</span></span><br><span class="line">                    ServerSocketChannel server = (ServerSocketChannel) selectionKey.channel();</span><br><span class="line">                    <span class="comment">//Channelæ¥å—è¿æ¥</span></span><br><span class="line">                    SocketChannel channel = server.accept();</span><br><span class="line">                    <span class="comment">//Channelæ³¨å†Œ</span></span><br><span class="line">                    registerChannel(selector, channel, SelectionKey.OP_READ);</span><br><span class="line">                    <span class="comment">//è¿œç¨‹å®¢æˆ·ç«¯çš„è¿æ¥æ•°ç»Ÿè®¡</span></span><br><span class="line">                    remoteClientNum++;</span><br><span class="line">                    System.out.println(<span class="string">"online client num : "</span> + remoteClientNum);</span><br><span class="line">                    write(channel, <span class="string">"hello client"</span>.getBytes());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//å¦‚æœé€šé“å¤„äºè¯»å°±ç»ªçŠ¶æ€ï¼Œåˆ™è¯»å–é€šé“ä¸Šçš„æ•°æ®</span></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isReadable()) &#123;</span><br><span class="line">                    read(selectionKey);</span><br><span class="line">                &#125;</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(SelectionKey selectionKey)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel socketChannel = (SocketChannel) selectionKey.channel();</span><br><span class="line">        <span class="keyword">int</span> count;</span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        <span class="comment">//ä»é€šé“è¯»å…¥åˆ°ç¼“å†²åŒº</span></span><br><span class="line">        <span class="keyword">while</span> ((count = socketChannel.read(byteBuffer)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//byteBufferå†™æ¨¡å¼å˜ä¸ºè¯»æ¨¡å¼</span></span><br><span class="line">            byteBuffer.flip();</span><br><span class="line">            <span class="keyword">while</span> (byteBuffer.hasRemaining()) &#123;</span><br><span class="line">                System.out.println((<span class="keyword">char</span>) byteBuffer.get());</span><br><span class="line">            &#125;</span><br><span class="line">            byteBuffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            socketChannel.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(SocketChannel channel, <span class="keyword">byte</span>[] writeData)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        byteBuffer.put(writeData);</span><br><span class="line">        <span class="comment">//è¯»æ¨¡å¼å˜ä¸ºå†™æ¨¡å¼</span></span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        channel.write(byteBuffer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registerChannel</span><span class="params">(Selector selector, SocketChannel channel, <span class="keyword">int</span> opRead)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (channel == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        channel.register(selector, opRead);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            NIOServer myServer = <span class="keyword">new</span> NIOServer(<span class="number">8990</span>);</span><br><span class="line">            myServer.listener();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸­å®šä¹‰äº†åä¸º NIOServer çš„æœåŠ¡ç«¯å®ç°ç±»ï¼Œåœ¨è¯¥ç±»ä¸­å®šä¹‰äº†<strong><code>serverSocketChannel</code></strong>ç”¨äº ServerSocketChannel çš„å»ºç«‹å’Œç«¯å£çš„ç»‘å®šï¼›<strong><code>byteBuffer</code></strong>ç”¨äºä¸åŒ Channel ä¹‹é—´çš„æ•°æ®äº¤äº’ï¼›<strong><code>selector</code></strong>ç”¨äºç›‘å¬æœåŠ¡å™¨å„ä¸ª Channel ä¸Šæ•°æ®çš„å˜åŒ–å¹¶åšå‡ºå“åº”ã€‚åŒæ—¶ï¼Œåœ¨ç±»æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–äº† ServerSocketChannel çš„æ“ä½œï¼Œå®šä¹‰äº†<strong><code>listener</code></strong>æ–¹æ³•æ¥ç›‘å¬Channelä¸Šçš„æ•°æ®å˜åŒ–ï¼Œè§£æå®¢æˆ·ç«¯çš„æ•°æ®å¹¶å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚åšå‡ºå“åº”ã€‚</p><p>ç²—ç•¥è¿‡ç¨‹å¦‚å›¾ï¼š</p><p><img src="https://img.garenhou.com/java-nio-1.jpg" alt=""></p><h3 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h3><p>å…³äºNIOçš„è§£é‡Šï¼Œçœ‹è¿‡ä¸é”™çš„æ–‡ç« å°±æ˜¯ç¾å›¢tectçš„è¿™ä¸€ç¯‡ <a href="https://tech.meituan.com/2016/11/04/nio.html" target="_blank" rel="noopener">Java NIO æµ…æ</a>ï¼Œæ¨èé˜…è¯»~ (ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„æ–‡ç« å†™å¾—çœŸçš„éƒ½å¾ˆä¸é”™ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Javaç½‘ç»œç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaç½‘ç»œæ¨¡å‹ </tag>
            
            <tag> NIO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM ä¹‹å¸¸ç”¨çš„å‚æ•°é…ç½®æŒ‡åŒ—</title>
      <link href="/2020/jvm-opt-arguments/"/>
      <url>/2020/jvm-opt-arguments/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œä½ å°†æŒæ¡æœ€å¸¸ç”¨çš„ JVM å‚æ•°é…ç½®ã€‚æ¯”å¦‚ä¸‹é¢æåˆ°äº†ä¸€äº›æ¦‚å¿µæ¯”å¦‚å †ã€GCç­‰ã€‚</p><h2 id="å †å†…å­˜ç›¸å…³"><a href="#å †å†…å­˜ç›¸å…³" class="headerlink" title="å †å†…å­˜ç›¸å…³"></a>å †å†…å­˜ç›¸å…³</h2><blockquote><p>Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼ŒJava å †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚<strong>æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</strong></p></blockquote><h3 id="æ˜¾å¼æŒ‡å®šå †å†…å­˜â€“Xmså’Œ-Xmx"><a href="#æ˜¾å¼æŒ‡å®šå †å†…å­˜â€“Xmså’Œ-Xmx" class="headerlink" title="æ˜¾å¼æŒ‡å®šå †å†…å­˜â€“Xmså’Œ-Xmx"></a>æ˜¾å¼æŒ‡å®šå †å†…å­˜<code>â€“Xms</code>å’Œ<code>-Xmx</code></h3><a id="more"></a><p>ä¸æ€§èƒ½æœ‰å…³çš„æœ€å¸¸è§å®è·µä¹‹ä¸€æ˜¯æ ¹æ®åº”ç”¨ç¨‹åºè¦æ±‚åˆå§‹åŒ–å †å†…å­˜ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æŒ‡å®šæœ€å°å’Œæœ€å¤§å †å¤§å°ï¼ˆæ¨èæ˜¾ç¤ºæŒ‡å®šå¤§å°ï¼‰ï¼Œä»¥ä¸‹å‚æ•°å¯ä»¥å¸®åŠ©ä½ å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Xms&lt;heap size&gt;[unit] </span><br><span class="line">-Xmx&lt;heap size&gt;[unit]</span><br></pre></td></tr></table></figure><ul><li><strong>heap size</strong> è¡¨ç¤ºè¦åˆå§‹åŒ–å†…å­˜çš„å…·ä½“å¤§å°ã€‚</li><li><strong>unit</strong> è¡¨ç¤ºè¦åˆå§‹åŒ–å†…å­˜çš„å•ä½ã€‚å•ä½ä¸º<strong><em>â€œ gâ€</em></strong> (GB) ã€<strong><em>â€œ mâ€</em></strong>ï¼ˆMBï¼‰ã€<strong><em>â€œ kâ€</em></strong>ï¼ˆKBï¼‰ã€‚</li></ul><p>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¸ºJVMåˆ†é…æœ€å°2 GBå’Œæœ€å¤§5 GBçš„å †å†…å­˜å¤§å°ï¼Œæˆ‘ä»¬çš„å‚æ•°åº”è¯¥è¿™æ ·æ¥å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xms2G -Xmx5G</span><br></pre></td></tr></table></figure><h3 id="æ˜¾å¼æ–°ç”Ÿä»£å†…å­˜-Young-Ceneration"><a href="#æ˜¾å¼æ–°ç”Ÿä»£å†…å­˜-Young-Ceneration" class="headerlink" title="æ˜¾å¼æ–°ç”Ÿä»£å†…å­˜(Young Ceneration)"></a>æ˜¾å¼æ–°ç”Ÿä»£å†…å­˜(Young Ceneration)</h3><p>æ ¹æ®<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/sizing.html" target="_blank" rel="noopener">Oracleå®˜æ–¹æ–‡æ¡£</a>ï¼Œåœ¨å †æ€»å¯ç”¨å†…å­˜é…ç½®å®Œæˆä¹‹åï¼Œç¬¬äºŒå¤§å½±å“å› ç´ æ˜¯ä¸º <code>Young Generation</code> åœ¨å †å†…å­˜æ‰€å çš„æ¯”ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒYG çš„æœ€å°å¤§å°ä¸º 1310 <em>MB</em>ï¼Œæœ€å¤§å¤§å°ä¸º<em>æ— é™åˆ¶</em>ã€‚</p><p>ä¸€å…±æœ‰ä¸¤ç§æŒ‡å®š æ–°ç”Ÿä»£å†…å­˜(Young Ceneration)å¤§å°çš„æ–¹æ³•ï¼š</p><p><strong>1.é€šè¿‡<code>-XX:NewSize</code>å’Œ<code>-XX:MaxNewSize</code>æŒ‡å®š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:NewSize=&lt;young size&gt;[unit] </span><br><span class="line">-XX:MaxNewSize=&lt;young size&gt;[unit]</span><br></pre></td></tr></table></figure><p>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¸º æ–°ç”Ÿä»£åˆ†é… æœ€å°256m çš„å†…å­˜ï¼Œæœ€å¤§ 1024mçš„å†…å­˜æˆ‘ä»¬çš„å‚æ•°åº”è¯¥è¿™æ ·æ¥å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:NewSize=256m</span><br><span class="line">-XX:MaxNewSize=1024m</span><br></pre></td></tr></table></figure><p><strong>2.é€šè¿‡<code>-Xmn&lt;young size&gt;[unit]</code>æŒ‡å®š</strong></p><p>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œå¦‚æœæˆ‘ä»¬è¦ä¸º æ–°ç”Ÿä»£åˆ†é…256mçš„å†…å­˜ï¼ˆNewSizeä¸MaxNewSizeè®¾ä¸ºä¸€è‡´ï¼‰ï¼Œæˆ‘ä»¬çš„å‚æ•°åº”è¯¥è¿™æ ·æ¥å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xmn256m</span><br></pre></td></tr></table></figure><p>GC è°ƒä¼˜ç­–ç•¥ä¸­å¾ˆé‡è¦çš„ä¸€æ¡ç»éªŒæ€»ç»“æ˜¯è¿™æ ·è¯´çš„ï¼š</p><blockquote><p>å°†æ–°å¯¹è±¡é¢„ç•™åœ¨æ–°ç”Ÿä»£ï¼Œç”±äº Full GC çš„æˆæœ¬è¿œé«˜äº Minor GCï¼Œå› æ­¤å°½å¯èƒ½å°†å¯¹è±¡åˆ†é…åœ¨æ–°ç”Ÿä»£æ˜¯æ˜æ™ºçš„åšæ³•ï¼Œå®é™…é¡¹ç›®ä¸­æ ¹æ® GC æ—¥å¿—åˆ†ææ–°ç”Ÿä»£ç©ºé—´å¤§å°åˆ†é…æ˜¯å¦åˆç†ï¼Œé€‚å½“é€šè¿‡â€œ-Xmnâ€å‘½ä»¤è°ƒèŠ‚æ–°ç”Ÿä»£å¤§å°ï¼Œæœ€å¤§é™åº¦é™ä½æ–°å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„æƒ…å†µã€‚</p></blockquote><p>å¦å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡<strong><code>-XX:NewRatio=&lt;int&gt;</code></strong>æ¥è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£å†…å­˜çš„æ¯”å€¼ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„å‚æ•°å°±æ˜¯è®¾ç½®æ–°ç”Ÿä»£ï¼ˆåŒ…æ‹¬Edenå’Œä¸¤ä¸ªSurvivoråŒºï¼‰ä¸è€å¹´ä»£çš„æ¯”å€¼ä¸º1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ–°ç”Ÿä»£ä¸è€å¹´ä»£æ‰€å æ¯”å€¼ä¸º1ï¼š1ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †æ ˆçš„ 1/2ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:NewRatio=1</span><br></pre></td></tr></table></figure><h3 id="2-3-æ˜¾ç¤ºæŒ‡å®šæ°¸ä¹…ä»£-å…ƒç©ºé—´çš„å¤§å°"><a href="#2-3-æ˜¾ç¤ºæŒ‡å®šæ°¸ä¹…ä»£-å…ƒç©ºé—´çš„å¤§å°" class="headerlink" title="2.3.æ˜¾ç¤ºæŒ‡å®šæ°¸ä¹…ä»£/å…ƒç©ºé—´çš„å¤§å°"></a>2.3.æ˜¾ç¤ºæŒ‡å®šæ°¸ä¹…ä»£/å…ƒç©ºé—´çš„å¤§å°</h3><p><strong>ä» JDK1.8 å¼€å§‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®š Metaspace çš„å¤§å°ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ï¼ˆæ°¸ä¹…ä»£å¹¶ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼‰ã€‚</strong></p><p>JDK 1.8 ä¹‹å‰æ°¸ä¹…ä»£è¿˜æ²¡è¢«å½»åº•ç§»é™¤çš„æ—¶å€™é€šå¸¸é€šè¿‡ä¸‹é¢è¿™äº›å‚æ•°æ¥è°ƒèŠ‚æ–¹æ³•åŒºå¤§å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:PermSize=N <span class="comment">//æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å°</span></span><br><span class="line">-XX:MaxPermSize=N <span class="comment">//æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGen</span></span><br></pre></td></tr></table></figure><p>ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œä½†å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±â€œæ°¸ä¹…å­˜åœ¨â€äº†ã€‚</p><p><strong>JDK 1.8 çš„æ—¶å€™ï¼Œæ–¹æ³•åŒºï¼ˆHotSpot çš„æ°¸ä¹…ä»£ï¼‰è¢«å½»åº•ç§»é™¤äº†ï¼ˆJDK1.7 å°±å·²ç»å¼€å§‹äº†ï¼‰ï¼Œå–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ã€‚</strong></p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:MetaspaceSize=N <span class="comment">//è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰</span></span><br><span class="line">-XX:MaxMetaspaceSize=N <span class="comment">//è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°ï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°çš„è¯ï¼Œéšç€æ›´å¤šç±»çš„åˆ›å»ºï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ã€‚</span></span><br></pre></td></tr></table></figure><h2 id="3-åƒåœ¾æ”¶é›†ç›¸å…³"><a href="#3-åƒåœ¾æ”¶é›†ç›¸å…³" class="headerlink" title="3.åƒåœ¾æ”¶é›†ç›¸å…³"></a>3.åƒåœ¾æ”¶é›†ç›¸å…³</h2><h3 id="3-1-åƒåœ¾å›æ”¶å™¨"><a href="#3-1-åƒåœ¾å›æ”¶å™¨" class="headerlink" title="3.1.åƒåœ¾å›æ”¶å™¨"></a>3.1.åƒåœ¾å›æ”¶å™¨</h3><p>ä¸ºäº†æé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ï¼Œé€‰æ‹©æ­£ç¡®çš„<a href="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html" target="_blank" rel="noopener">åƒåœ¾æ”¶é›†</a>ç®—æ³•è‡³å…³é‡è¦ã€‚</p><p>JVMå…·æœ‰å››ç§ç±»å‹çš„<em>GC</em>å®ç°ï¼š</p><ul><li>ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</li><li>å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨</li><li>CMSåƒåœ¾æ”¶é›†å™¨</li><li>G1åƒåœ¾æ”¶é›†å™¨</li></ul><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°å£°æ˜è¿™äº›å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseSerialGC</span><br><span class="line">-XX:+UseParallelGC</span><br><span class="line">-XX:+USeParNewGC</span><br><span class="line">-XX:+UseG1GC</span><br></pre></td></tr></table></figure><p>æœ‰å…³<em>åƒåœ¾å›æ”¶</em>å®æ–½çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/java/jvm/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.md" target="_blank" rel="noopener">æ­¤å¤„</a>ã€‚</p><h3 id="3-2-GCè®°å½•"><a href="#3-2-GCè®°å½•" class="headerlink" title="3.2.GCè®°å½•"></a>3.2.GCè®°å½•</h3><p>ä¸ºäº†ä¸¥æ ¼ç›‘æ§åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µï¼Œæˆ‘ä»¬åº”è¯¥å§‹ç»ˆæ£€æŸ¥JVMçš„<em>åƒåœ¾å›æ”¶</em>æ€§èƒ½ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä»¥äººç±»å¯è¯»çš„æ ¼å¼è®°å½•<em>GC</em>æ´»åŠ¨ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•<em>GC</em>æ´»åŠ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseGCLogFileRotation </span><br><span class="line">-XX:NumberOfGCLogFiles=&lt; number of log files &gt; </span><br><span class="line">-XX:GCLogFileSize=&lt; file size &gt;[ unit ]</span><br><span class="line">-Xloggc:/path/to/gc.log</span><br></pre></td></tr></table></figure><h3 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h3><ul><li><a href="https://www.jianshu.com/p/832fc4d4cb53" target="_blank" rel="noopener">CMS GC é»˜è®¤æ–°ç”Ÿä»£æ˜¯å¤šå¤§ï¼Ÿ</a></li><li><a href="https://www.cnblogs.com/hongdada/p/10277782.html" target="_blank" rel="noopener">CMS GCå¯åŠ¨å‚æ•°ä¼˜åŒ–é…ç½®</a></li><li><a href="https://tech.meituan.com/2017/12/29/jvm-optimize.html" target="_blank" rel="noopener">ä»å®é™…æ¡ˆä¾‹èŠèŠJavaåº”ç”¨çš„GCä¼˜åŒ–-ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></li><li><a href="https://www.choupangxia.com/2019/11/11/interview-jvm-gc-08/" target="_blank" rel="noopener">JVMæ€§èƒ½è°ƒä¼˜è¯¦è§£</a> ï¼ˆ2019-11-11ï¼‰</li><li><a href="https://segmentfault.com/a/1190000010603813" target="_blank" rel="noopener">JVMå‚æ•°ä½¿ç”¨æ‰‹å†Œ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> å‚æ•°é…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM ä¹‹ JDK ç›‘æ§å’Œæ•…éšœå¤„ç†å·¥å…·æ€»ç»“</title>
      <link href="/2020/jvm-tools-summary/"/>
      <url>/2020/jvm-tools-summary/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å­¦ä¹  JVM çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†ç›‘æ§è™šæ‹Ÿæœºæ€§èƒ½å’Œæ›´å¥½åœ°è°ƒä¼˜ï¼Œç”¨åˆ°äº†å¾ˆå¤šçš„å·¥å…·ï¼ŒåŒ…æ‹¬äº†å‘½ä»¤è¡Œå·¥å…·ã€å¯è§†åŒ–å·¥å…·ç­‰ï¼Œåœ¨è¿™é‡ŒåŠ ä»¥æ€»ç»“ã€‚</p><a id="more"></a><h2 id="JDK-å‘½ä»¤è¡Œå·¥å…·"><a href="#JDK-å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="JDK å‘½ä»¤è¡Œå·¥å…·"></a>JDK å‘½ä»¤è¡Œå·¥å…·</h2><p>è¿™äº›å‘½ä»¤åœ¨ JDK å®‰è£…ç›®å½•ä¸‹çš„ bin ç›®å½•ä¸‹ï¼š</p><ul><li><strong><code>jps</code></strong> (JVM Process Statusï¼‰: ç±»ä¼¼ UNIX çš„ <code>ps</code> å‘½ä»¤ã€‚ç”¨æˆ·æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹çš„å¯åŠ¨ç±»ã€ä¼ å…¥å‚æ•°å’Œ Java è™šæ‹Ÿæœºå‚æ•°ç­‰ä¿¡æ¯ï¼›</li><li><strong><code>jstat</code></strong>ï¼ˆ JVM Statistics Monitoring Toolï¼‰: ç”¨äºæ”¶é›† HotSpot è™šæ‹Ÿæœºå„æ–¹é¢çš„è¿è¡Œæ•°æ®;</li><li><strong><code>jinfo</code></strong> (Configuration Info for Java) : Configuration Info forJava,æ˜¾ç¤ºè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯;</li><li><strong><code>jmap</code></strong> (Memory Map for Java) :ç”Ÿæˆå †è½¬å‚¨å¿«ç…§;</li><li><strong><code>jhat</code></strong> (JVM Heap Dump Browser ) : ç”¨äºåˆ†æ heapdump æ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ª HTTP/HTML æœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœ;</li><li><strong><code>jstack</code></strong> (Stack Trace for Java):ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼Œçº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆã€‚</li></ul><h3 id="jps-æŸ¥çœ‹æ‰€æœ‰-Java-è¿›ç¨‹"><a href="#jps-æŸ¥çœ‹æ‰€æœ‰-Java-è¿›ç¨‹" class="headerlink" title="jps:æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹"></a><code>jps</code>:æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹</h3><p><code>jps</code>(JVM Process Status) å‘½ä»¤ç±»ä¼¼ UNIX çš„ <code>ps</code> å‘½ä»¤ã€‚</p><p><code>jps</code>ï¼šæ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€ IDï¼ˆLocal Virtual Machine Identifier,LVMIDï¼‰ã€‚<code>jps -q</code> ï¼šåªè¾“å‡ºè¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€ IDã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jps</span></span><br><span class="line"><span class="number">7360</span> NettyClient2</span><br><span class="line"><span class="number">17396</span></span><br><span class="line"><span class="number">7972</span> Launcher</span><br><span class="line"><span class="number">16504</span> Jps</span><br><span class="line"><span class="number">17340</span> NettyServer</span><br></pre></td></tr></table></figure><p><code>jps -l</code>:è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ Jar åŒ…ï¼Œè¾“å‡º Jar è·¯å¾„ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jps</span> -l</span><br><span class="line"><span class="number">7360</span> firstNettyDemo.NettyClient2</span><br><span class="line"><span class="number">17396</span></span><br><span class="line"><span class="number">7972</span> org.jetbrains.jps.cmdline.Launcher</span><br><span class="line"><span class="number">16492</span> sun.tools.jps.Jps</span><br><span class="line"><span class="number">17340</span> firstNettyDemo.NettyServer</span><br></pre></td></tr></table></figure><p><code>jps -v</code>ï¼šè¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ JVM å‚æ•°ã€‚</p><p><code>jps -m</code>ï¼šè¾“å‡ºä¼ é€’ç»™ Java è¿›ç¨‹ main() å‡½æ•°çš„å‚æ•°ã€‚</p><h3 id="jstat-ç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯"><a href="#jstat-ç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯" class="headerlink" title="jstat: ç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯"></a><code>jstat</code>: ç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯</h3><p>jstatï¼ˆJVM Statistics Monitoring Toolï¼‰ ä½¿ç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ å®ƒå¯ä»¥æ˜¾ç¤ºæœ¬åœ°æˆ–è€…è¿œç¨‹ï¼ˆéœ€è¦è¿œç¨‹ä¸»æœºæä¾› RMI æ”¯æŒï¼‰è™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»ä¿¡æ¯ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ï¼Œåœ¨æ²¡æœ‰ GUIï¼Œåªæä¾›äº†çº¯æ–‡æœ¬æ§åˆ¶å°ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒå°†æ˜¯è¿è¡ŒæœŸé—´å®šä½è™šæ‹Ÿæœºæ€§èƒ½é—®é¢˜çš„é¦–é€‰å·¥å…·ã€‚</p><p><strong><code>jstat</code> å‘½ä»¤ä½¿ç”¨æ ¼å¼ï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ <code>jstat -gc -h3 31736 1000 10</code>è¡¨ç¤ºåˆ†æè¿›ç¨‹ id ä¸º 31736 çš„ gc æƒ…å†µï¼Œæ¯éš” 1000ms æ‰“å°ä¸€æ¬¡è®°å½•ï¼Œæ‰“å° 10 æ¬¡åœæ­¢ï¼Œæ¯ 3 è¡Œåæ‰“å°æŒ‡æ ‡å¤´éƒ¨ã€‚</p><p><strong>å¸¸è§çš„ option å¦‚ä¸‹ï¼š</strong></p><ul><li><code>jstat -class vmid</code> ï¼šæ˜¾ç¤º ClassLoader çš„ç›¸å…³ä¿¡æ¯ï¼›</li><li><code>jstat -compiler vmid</code> ï¼šæ˜¾ç¤º JIT ç¼–è¯‘çš„ç›¸å…³ä¿¡æ¯ï¼›</li><li><code>jstat -gc vmid</code> ï¼šæ˜¾ç¤ºä¸ GC ç›¸å…³çš„å †ä¿¡æ¯ï¼›</li><li><code>jstat -gccapacity vmid</code> ï¼šæ˜¾ç¤ºå„ä¸ªä»£çš„å®¹é‡åŠä½¿ç”¨æƒ…å†µï¼›</li><li><code>jstat -gcnew vmid</code> ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£ä¿¡æ¯ï¼›</li><li><code>jstat -gcnewcapcacity vmid</code> ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£å¤§å°ä¸ä½¿ç”¨æƒ…å†µï¼›</li><li><code>jstat -gcold vmid</code> ï¼šæ˜¾ç¤ºè€å¹´ä»£å’Œæ°¸ä¹…ä»£çš„è¡Œä¸ºç»Ÿè®¡ï¼Œä»jdk1.8å¼€å§‹,è¯¥é€‰é¡¹ä»…è¡¨ç¤ºè€å¹´ä»£ï¼Œå› ä¸ºæ°¸ä¹…ä»£è¢«ç§»é™¤äº†ï¼›</li><li><code>jstat -gcoldcapacity vmid</code> ï¼šæ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ï¼›</li><li><code>jstat -gcpermcapacity vmid</code> ï¼šæ˜¾ç¤ºæ°¸ä¹…ä»£å¤§å°ï¼Œä»jdk1.8å¼€å§‹,è¯¥é€‰é¡¹ä¸å­˜åœ¨äº†ï¼Œå› ä¸ºæ°¸ä¹…ä»£è¢«ç§»é™¤äº†ï¼›</li><li><code>jstat -gcutil vmid</code> ï¼šæ˜¾ç¤ºåƒåœ¾æ”¶é›†ä¿¡æ¯ï¼›</li></ul><p>å¦å¤–ï¼ŒåŠ ä¸Š <code>-t</code>å‚æ•°å¯ä»¥åœ¨è¾“å‡ºä¿¡æ¯ä¸ŠåŠ ä¸€ä¸ª Timestamp åˆ—ï¼Œæ˜¾ç¤ºç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚</p><h3 id="jinfo-å®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°"><a href="#jinfo-å®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°" class="headerlink" title="jinfo: å®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°"></a><code>jinfo</code>: å®æ—¶åœ°æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºå„é¡¹å‚æ•°</h3><p><code>jinfo vmid</code> :è¾“å‡ºå½“å‰ jvm è¿›ç¨‹çš„å…¨éƒ¨å‚æ•°å’Œç³»ç»Ÿå±æ€§ (ç¬¬ä¸€éƒ¨åˆ†æ˜¯ç³»ç»Ÿçš„å±æ€§ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ JVM çš„å‚æ•°)ã€‚</p><p><code>jinfo -flag name vmid</code> :è¾“å‡ºå¯¹åº”åç§°çš„å‚æ•°çš„å…·ä½“å€¼ã€‚æ¯”å¦‚è¾“å‡º MaxHeapSizeã€æŸ¥çœ‹å½“å‰ jvm è¿›ç¨‹æ˜¯å¦å¼€å¯æ‰“å° GC æ—¥å¿— ( <code>-XX:PrintGCDetails</code> :è¯¦ç»† GC æ—¥å¿—æ¨¡å¼ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯é»˜è®¤å…³é—­çš„)ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jinfo</span>  -flag MaxHeapSize <span class="number">17340</span></span><br><span class="line">-XX:MaxHeapSize=<span class="number">2124414976</span></span><br><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jinfo</span>  -flag PrintGC <span class="number">17340</span></span><br><span class="line">-XX:-PrintGC</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ jinfo å¯ä»¥åœ¨ä¸é‡å¯è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹ jvm çš„å‚æ•°ã€‚å°¤å…¶åœ¨çº¿ä¸Šçš„ç¯å¢ƒç‰¹åˆ«æœ‰ç”¨,è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><p><code>jinfo -flag [+|-]name vmid</code> å¼€å¯æˆ–è€…å…³é—­å¯¹åº”åç§°çš„å‚æ•°ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jinfo</span>  -flag  PrintGC <span class="number">17340</span></span><br><span class="line">-XX:-PrintGC</span><br><span class="line"></span><br><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jinfo</span>  -flag  +PrintGC <span class="number">17340</span></span><br><span class="line"></span><br><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jinfo</span>  -flag  PrintGC <span class="number">17340</span></span><br><span class="line">-XX:+PrintGC</span><br></pre></td></tr></table></figure><h3 id="jmap-ç”Ÿæˆå †è½¬å‚¨å¿«ç…§"><a href="#jmap-ç”Ÿæˆå †è½¬å‚¨å¿«ç…§" class="headerlink" title="jmap:ç”Ÿæˆå †è½¬å‚¨å¿«ç…§"></a><code>jmap</code>:ç”Ÿæˆå †è½¬å‚¨å¿«ç…§</h3><p><code>jmap</code>ï¼ˆMemory Map for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚ å¦‚æœä¸ä½¿ç”¨ <code>jmap</code> å‘½ä»¤ï¼Œè¦æƒ³è·å– Java å †è½¬å‚¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>â€œ-XX:+HeapDumpOnOutOfMemoryErrorâ€</code> å‚æ•°ï¼Œå¯ä»¥è®©è™šæ‹Ÿæœºåœ¨ OOM å¼‚å¸¸å‡ºç°ä¹‹åè‡ªåŠ¨ç”Ÿæˆ dump æ–‡ä»¶ï¼ŒLinux å‘½ä»¤ä¸‹å¯ä»¥é€šè¿‡ <code>kill -3</code> å‘é€è¿›ç¨‹é€€å‡ºä¿¡å·ä¹Ÿèƒ½æ‹¿åˆ° dump æ–‡ä»¶ã€‚</p><p><code>jmap</code> çš„ä½œç”¨å¹¶ä¸ä»…ä»…æ˜¯ä¸ºäº†è·å– dump æ–‡ä»¶ï¼Œå®ƒè¿˜å¯ä»¥æŸ¥è¯¢ finalizer æ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ç©ºé—´ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚å’Œ<code>jinfo</code>ä¸€æ ·ï¼Œ<code>jmap</code>æœ‰ä¸å°‘åŠŸèƒ½åœ¨ Windows å¹³å°ä¸‹ä¹Ÿæ˜¯å—é™åˆ¶çš„ã€‚</p><p>ç¤ºä¾‹ï¼šå°†æŒ‡å®šåº”ç”¨ç¨‹åºçš„å †å¿«ç…§è¾“å‡ºåˆ°æ¡Œé¢ã€‚åé¢ï¼Œå¯ä»¥é€šè¿‡ jhatã€Visual VM ç­‰å·¥å…·åˆ†æè¯¥å †æ–‡ä»¶ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou<span class="variable">$jmap</span> -dump:format=b,file=/Users/garen_hou/Desktop/heap.hprof <span class="number">17340</span></span><br><span class="line">Dumping heap to /Users/garen_hou/Desktop/heap.hprof ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure><h3 id="jhat-åˆ†æ-heapdump-æ–‡ä»¶"><a href="#jhat-åˆ†æ-heapdump-æ–‡ä»¶" class="headerlink" title="jhat: åˆ†æ heapdump æ–‡ä»¶"></a><strong><code>jhat</code></strong>: åˆ†æ heapdump æ–‡ä»¶</h3><p><strong><code>jhat</code></strong> ç”¨äºåˆ†æ heapdump æ–‡ä»¶ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ª HTTP/HTML æœåŠ¡å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨ä¸ŠæŸ¥çœ‹åˆ†æç»“æœã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou$ jhat /Users/garen_hou/Desktop/heap.hprof</span><br><span class="line">Reading from /Users/garen_hou/Desktop/heap.hprof...</span><br><span class="line">Dump file created Sat May <span class="number">04</span> <span class="number">12</span>:<span class="number">30</span>:<span class="number">31</span> CST <span class="number">2019</span></span><br><span class="line">Snapshot read, resolving...</span><br><span class="line">Resolving <span class="number">131419</span> objects...</span><br><span class="line">Chasing references, expect <span class="number">26</span> dots..........................</span><br><span class="line">Eliminating duplicate references..........................</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port <span class="number">7000</span></span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure><p>è®¿é—® <a href="http://localhost:7000/" target="_blank" rel="noopener">http://localhost:7000/</a></p><h3 id="jstack-ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§"><a href="#jstack-ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§" class="headerlink" title="jstack :ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§"></a><strong><code>jstack</code></strong> :ç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§</h3><p><code>jstack</code>ï¼ˆStack Trace for Javaï¼‰å‘½ä»¤ç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆ.</p><p>ç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ç›®çš„ä¸»è¦æ˜¯å®šä½çº¿ç¨‹é•¿æ—¶é—´å‡ºç°åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰éƒ½æ˜¯å¯¼è‡´çº¿ç¨‹é•¿æ—¶é—´åœé¡¿çš„åŸå› ã€‚çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡<code>jstack</code>æ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…åœ¨ç­‰å¾…äº›ä»€ä¹ˆèµ„æºã€‚</p><p><strong>ä¸‹é¢æ˜¯ä¸€ä¸ªçº¿ç¨‹æ­»é”çš„ä»£ç ã€‚æˆ‘ä»¬ä¸‹é¢ä¼šé€šè¿‡ <code>jstack</code> å‘½ä»¤è¿›è¡Œæ­»é”æ£€æŸ¥ï¼Œè¾“å‡ºæ­»é”ä¿¡æ¯ï¼Œæ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object resource1 = <span class="keyword">new</span> Object();<span class="comment">//èµ„æº 1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object resource2 = <span class="keyword">new</span> Object();<span class="comment">//èµ„æº 2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (resource1) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">"get resource1"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">"waiting get resource2"</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (resource2) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread() + <span class="string">"get resource2"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">"çº¿ç¨‹ 1"</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (resource2) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">"get resource2"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(Thread.currentThread() + <span class="string">"waiting get resource1"</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (resource1) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread() + <span class="string">"get resource1"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">"çº¿ç¨‹ 2"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread[çº¿ç¨‹ 1,5,main]get resource1</span><br><span class="line">Thread[çº¿ç¨‹ 2,5,main]get resource2</span><br><span class="line">Thread[çº¿ç¨‹ 1,5,main]waiting get resource2</span><br><span class="line">Thread[çº¿ç¨‹ 2,5,main]waiting get resource1</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ A é€šè¿‡ synchronized (resource1) è·å¾— resource1 çš„ç›‘è§†å™¨é”ï¼Œç„¶åé€šè¿‡<code>Thread.sleep(1000);</code>è®©çº¿ç¨‹ A ä¼‘çœ  1s ä¸ºçš„æ˜¯è®©çº¿ç¨‹ B å¾—åˆ°æ‰§è¡Œç„¶åè·å–åˆ° resource2 çš„ç›‘è§†å™¨é”ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¼‘çœ ç»“æŸäº†éƒ½å¼€å§‹ä¼å›¾è¯·æ±‚è·å–å¯¹æ–¹çš„èµ„æºï¼Œç„¶åè¿™ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šé™·å…¥äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œè¿™ä¹Ÿå°±äº§ç”Ÿäº†æ­»é”ã€‚</p><p><strong>é€šè¿‡ <code>jstack</code> å‘½ä»¤åˆ†æï¼š</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">garen-houtekiMacBook-Air:jvm garen_hou$ jps</span><br><span class="line"><span class="number">13792</span> KotlinCompileDaemon</span><br><span class="line"><span class="number">7360</span> NettyClient2</span><br><span class="line"><span class="number">17396</span></span><br><span class="line"><span class="number">7972</span> Launcher</span><br><span class="line"><span class="number">8932</span> Launcher</span><br><span class="line"><span class="number">9256</span> DeadLockDemo</span><br><span class="line"><span class="number">10764</span> Jps</span><br><span class="line"><span class="number">17340</span> NettyServer</span><br><span class="line"></span><br><span class="line">garen-houtekiMacBook-Air:jvm garen_hou$ jstack <span class="number">9256</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„éƒ¨åˆ†å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line"><span class="string">"çº¿ç¨‹ 2"</span>:</span><br><span class="line">  waiting to lock monitor <span class="number">0</span>x000000000333e668 (object <span class="number">0</span>x00000000d5efe1c0, a java.lang.Object),</span><br><span class="line">  which is held by <span class="string">"çº¿ç¨‹ 1"</span></span><br><span class="line"><span class="string">"çº¿ç¨‹ 1"</span>:</span><br><span class="line">  waiting to lock monitor <span class="number">0</span>x000000000333be88 (object <span class="number">0</span>x00000000d5efe1d0, a java.lang.Object),</span><br><span class="line">  which is held by <span class="string">"çº¿ç¨‹ 2"</span></span><br><span class="line"></span><br><span class="line">Java stack information <span class="keyword">for</span> the threads listed above:</span><br><span class="line">===================================================</span><br><span class="line"><span class="string">"çº¿ç¨‹ 2"</span>:</span><br><span class="line">        at DeadLockDemo.lambda<span class="variable">$main</span><span class="variable">$1</span>(DeadLockDemo.java:<span class="number">31</span>)</span><br><span class="line">        - waiting to lock &lt;<span class="number">0</span>x00000000d5efe1c0&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;<span class="number">0</span>x00000000d5efe1d0&gt; (a java.lang.Object)</span><br><span class="line">        at DeadLockDemo$<span class="variable">$Lambda</span><span class="variable">$2</span>/<span class="number">1078694789</span>.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line"><span class="string">"çº¿ç¨‹ 1"</span>:</span><br><span class="line">        at DeadLockDemo.lambda<span class="variable">$main</span><span class="variable">$0</span>(DeadLockDemo.java:<span class="number">16</span>)</span><br><span class="line">        - waiting to lock &lt;<span class="number">0</span>x00000000d5efe1d0&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;<span class="number">0</span>x00000000d5efe1c0&gt; (a java.lang.Object)</span><br><span class="line">        at DeadLockDemo$<span class="variable">$Lambda</span><span class="variable">$1</span>/<span class="number">1324119927</span>.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br><span class="line"></span><br><span class="line">Found <span class="number">1</span> deadlock.</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° <code>jstack</code> å‘½ä»¤å·²ç»å¸®æˆ‘ä»¬æ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹çš„å…·ä½“ä¿¡æ¯ã€‚</p><h2 id="JDK-å¯è§†åŒ–åˆ†æå·¥å…·"><a href="#JDK-å¯è§†åŒ–åˆ†æå·¥å…·" class="headerlink" title="JDK å¯è§†åŒ–åˆ†æå·¥å…·"></a>JDK å¯è§†åŒ–åˆ†æå·¥å…·</h2><h3 id="JConsole-Java-ç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°"><a href="#JConsole-Java-ç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°" class="headerlink" title="JConsole:Java ç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°"></a>JConsole:Java ç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°</h3><p>JConsole æ˜¯åŸºäº JMX çš„å¯è§†åŒ–ç›‘è§†ã€ç®¡ç†å·¥å…·ã€‚å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›‘è§†æœ¬åœ°åŠè¿œç¨‹æœåŠ¡å™¨çš„ java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ä½ å¯ä»¥åœ¨æ§åˆ¶å°è¾“å‡º<code>console</code>å‘½ä»¤å¯åŠ¨æˆ–è€…åœ¨ JDK ç›®å½•ä¸‹çš„ bin ç›®å½•æ‰¾åˆ°<code>jconsole.exe</code>ç„¶ååŒå‡»å¯åŠ¨ã€‚</p><h4 id="è¿æ¥-Jconsole"><a href="#è¿æ¥-Jconsole" class="headerlink" title="è¿æ¥ Jconsole"></a>è¿æ¥ Jconsole</h4><p><img src="https://img.garenhou.com/jvm-tools-1.png"></p><p>å¦‚æœéœ€è¦ä½¿ç”¨ JConsole è¿æ¥è¿œç¨‹è¿›ç¨‹ï¼Œå¯ä»¥åœ¨è¿œç¨‹ Java ç¨‹åºå¯åŠ¨æ—¶åŠ ä¸Šä¸‹é¢è¿™äº›å‚æ•°:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-Djava.rmi.server.hostname</span>=<span class="string">å¤–ç½‘è®¿é—® ip åœ°å€ </span></span><br><span class="line"><span class="meta">-Dcom.sun.management.jmxremote.port</span>=<span class="string">60001   //ç›‘æ§çš„ç«¯å£å·</span></span><br><span class="line"><span class="meta">-Dcom.sun.management.jmxremote.authenticate</span>=<span class="string">false   //å…³é—­è®¤è¯</span></span><br><span class="line"><span class="meta">-Dcom.sun.management.jmxremote.ssl</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨ JConsole è¿æ¥æ—¶ï¼Œè¿œç¨‹è¿›ç¨‹åœ°å€å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤–ç½‘è®¿é—® ip åœ°å€:60001</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹-Java-ç¨‹åºæ¦‚å†µ"><a href="#æŸ¥çœ‹-Java-ç¨‹åºæ¦‚å†µ" class="headerlink" title="æŸ¥çœ‹ Java ç¨‹åºæ¦‚å†µ"></a>æŸ¥çœ‹ Java ç¨‹åºæ¦‚å†µ</h4><p><img src="https://img.garenhou.com/jvm-tools-2.png" alt=""></p><h4 id="å†…å­˜ç›‘æ§"><a href="#å†…å­˜ç›‘æ§" class="headerlink" title="å†…å­˜ç›‘æ§"></a>å†…å­˜ç›‘æ§</h4><p>JConsole å¯ä»¥æ˜¾ç¤ºå½“å‰å†…å­˜çš„è¯¦ç»†ä¿¡æ¯ã€‚ä¸ä»…åŒ…æ‹¬å †å†…å­˜/éå †å†…å­˜çš„æ•´ä½“ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç»†åŒ–åˆ° eden åŒºã€survivor åŒºç­‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://img.garenhou.com/jvm-tools-3.png" alt=""></p><p>ç‚¹å‡»å³è¾¹çš„â€œæ‰§è¡Œ GC(G)â€æŒ‰é’®å¯ä»¥å¼ºåˆ¶åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ª Full GCã€‚</p><blockquote><ul><li><strong>æ–°ç”Ÿä»£ GCï¼ˆMinor GCï¼‰</strong>:æŒ‡å‘ç”Ÿæ–°ç”Ÿä»£çš„çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼ŒMinor GC éå¸¸é¢‘ç¹ï¼Œå›æ”¶é€Ÿåº¦ä¸€èˆ¬ä¹Ÿæ¯”è¾ƒå¿«ã€‚</li><li><strong>è€å¹´ä»£ GCï¼ˆMajor GC/Full GCï¼‰</strong>:æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† Major GC ç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ Minor GCï¼ˆå¹¶éç»å¯¹ï¼‰ï¼ŒMajor GC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” Minor GC çš„æ…¢ 10 å€ä»¥ä¸Šã€‚</li></ul></blockquote><h4 id="çº¿ç¨‹ç›‘æ§"><a href="#çº¿ç¨‹ç›‘æ§" class="headerlink" title="çº¿ç¨‹ç›‘æ§"></a>çº¿ç¨‹ç›‘æ§</h4><p><img src="https://img.garenhou.com/jvm-tools-4.png" alt=""></p><p>ç±»ä¼¼å‰é¢è®²çš„ <code>jstack</code> å‘½ä»¤ï¼Œä¸è¿‡è¿™ä¸ªæ˜¯å¯è§†åŒ–çš„ã€‚</p><p>æœ€ä¸‹é¢æœ‰ä¸€ä¸ªâ€æ£€æµ‹æ­»é” (D)â€æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®å¯ä»¥è‡ªåŠ¨ä¸ºä½ æ‰¾åˆ°å‘ç”Ÿæ­»é”çš„çº¿ç¨‹ä»¥åŠå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ ã€‚</p><h3 id="Visual-VM-å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·"><a href="#Visual-VM-å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·" class="headerlink" title="Visual VM:å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·"></a>Visual VM:å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·</h3><p>VisualVM æä¾›åœ¨ Java è™šæ‹Ÿæœº (Java Virutal Machine, JVM) ä¸Šè¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ã€‚åœ¨ VisualVM çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ–¹ä¾¿ã€å¿«æ·åœ°æŸ¥çœ‹å¤šä¸ª Java åº”ç”¨ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ã€‚Visual VM å®˜ç½‘ï¼š<a href="https://visualvm.github.io/" target="_blank" rel="noopener">https://visualvm.github.io/</a> ã€‚Visual VM ä¸­æ–‡æ–‡æ¡£:<a href="https://visualvm.github.io/documentation.html" target="_blank" rel="noopener">https://visualvm.github.io/documentation.html</a>ã€‚</p><p>ä¸‹é¢è¿™æ®µè¯æ‘˜è‡ªã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹ã€‚</p><blockquote><p>VisualVMï¼ˆAll-in-One Java Troubleshooting Toolï¼‰æ˜¯åˆ°ç›®å‰ä¸ºæ­¢éš JDK å‘å¸ƒçš„åŠŸèƒ½æœ€å¼ºå¤§çš„è¿è¡Œç›‘è§†å’Œæ•…éšœå¤„ç†ç¨‹åºï¼Œå®˜æ–¹åœ¨ VisualVM çš„è½¯ä»¶è¯´æ˜ä¸­å†™ä¸Šäº†â€œAll-in-Oneâ€çš„æè¿°å­—æ ·ï¼Œé¢„ç¤ºç€ä»–é™¤äº†è¿è¡Œç›‘è§†ã€æ•…éšœå¤„ç†å¤–ï¼Œè¿˜æä¾›äº†å¾ˆå¤šå…¶ä»–æ–¹é¢çš„åŠŸèƒ½ï¼Œå¦‚æ€§èƒ½åˆ†æï¼ˆProfilingï¼‰ã€‚VisualVM çš„æ€§èƒ½åˆ†æåŠŸèƒ½ç”šè‡³æ¯”èµ· JProfilerã€YourKit ç­‰ä¸“ä¸šä¸”æ”¶è´¹çš„ Profiling å·¥å…·éƒ½ä¸ä¼šé€Šè‰²å¤šå°‘ï¼Œè€Œä¸” VisualVM è¿˜æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼šä¸éœ€è¦è¢«ç›‘è§†çš„ç¨‹åºåŸºäºç‰¹æ®Š Agent è¿è¡Œï¼Œå› æ­¤ä»–å¯¹åº”ç”¨ç¨‹åºçš„å®é™…æ€§èƒ½çš„å½±å“å¾ˆå°ï¼Œä½¿å¾—ä»–å¯ä»¥ç›´æ¥åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™ä¸ªä¼˜ç‚¹æ˜¯ JProfilerã€YourKit ç­‰å·¥å…·æ— æ³•ä¸ä¹‹åª²ç¾çš„ã€‚</p></blockquote><p>VisualVM åŸºäº NetBeans å¹³å°å¼€å‘ï¼Œå› æ­¤ä»–ä¸€å¼€å§‹å°±å…·å¤‡äº†æ’ä»¶æ‰©å±•åŠŸèƒ½çš„ç‰¹æ€§ï¼Œé€šè¿‡æ’ä»¶æ‰©å±•æ”¯æŒï¼ŒVisualVM å¯ä»¥åšåˆ°ï¼š</p><ul><li><strong>æ˜¾ç¤ºè™šæ‹Ÿæœºè¿›ç¨‹ä»¥åŠè¿›ç¨‹çš„é…ç½®ã€ç¯å¢ƒä¿¡æ¯ï¼ˆjpsã€jinfoï¼‰ã€‚</strong></li><li><strong>ç›‘è§†åº”ç”¨ç¨‹åºçš„ CPUã€GCã€å †ã€æ–¹æ³•åŒºä»¥åŠçº¿ç¨‹çš„ä¿¡æ¯ï¼ˆjstatã€jstackï¼‰ã€‚</strong></li><li><strong>dump ä»¥åŠåˆ†æå †è½¬å‚¨å¿«ç…§ï¼ˆjmapã€jhatï¼‰ã€‚</strong></li><li><strong>æ–¹æ³•çº§çš„ç¨‹åºè¿è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾åˆ°è¢«è°ƒç”¨æœ€å¤šã€è¿è¡Œæ—¶é—´æœ€é•¿çš„æ–¹æ³•ã€‚</strong></li><li><strong>ç¦»çº¿ç¨‹åºå¿«ç…§ï¼šæ”¶é›†ç¨‹åºçš„è¿è¡Œæ—¶é…ç½®ã€çº¿ç¨‹ dumpã€å†…å­˜ dump ç­‰ä¿¡æ¯å»ºç«‹ä¸€ä¸ªå¿«ç…§ï¼Œå¯ä»¥å°†å¿«ç…§å‘é€å¼€å‘è€…å¤„è¿›è¡Œ Bug åé¦ˆã€‚</strong></li><li><strong>å…¶ä»– plugins çš„æ— é™çš„å¯èƒ½æ€§â€¦â€¦</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> æ€§èƒ½ç›‘æ§ </tag>
            
            <tag> å‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM ä¹‹åŠ¨æ€è®¡ç®—å¯¹è±¡å¹´é¾„çš„è§„åˆ™</title>
      <link href="/2020/jvm-dynamic-age-algorithm%20/"/>
      <url>/2020/jvm-dynamic-age-algorithm%20/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å­¦ä¹ JVMçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€äº›æ–‡ç« åœ¨è®²Javaå †ä¸­å¯¹è±¡ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡æå‡( Promotion )è§„åˆ™æ²¡æœ‰äº¤ä»£å¾—å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œå°±å†æ¥ç†è§£ä¸€ä¸‹<strong>åŠ¨æ€å¯¹è±¡å¹´é¾„è®¡ç®—è§„åˆ™</strong>ã€‚</p><a id="more"></a><h4 id="åŠ¨æ€å¯¹è±¡å¹´é¾„è®¡ç®—"><a href="#åŠ¨æ€å¯¹è±¡å¹´é¾„è®¡ç®—" class="headerlink" title="åŠ¨æ€å¯¹è±¡å¹´é¾„è®¡ç®—"></a>åŠ¨æ€å¯¹è±¡å¹´é¾„è®¡ç®—</h4><p>è™šæ‹Ÿæœºä¸ºæ¯ä¸€ä¸ªå¯¹è±¡éƒ½åˆ†é…äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨åœ¨å¯¹è±¡å¤´ä¸­ï¼Œå¯¹è±¡ä» Eden åŒº â€”&gt; Survivor åŒºåˆå§‹å¹´é¾„å˜ä¸º 1ï¼Œä¹‹åå¯¹è±¡åœ¨ Survivor åŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ Minor GCï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦å¼€å§‹è¿›å…¥è€å¹´ä»£ï¼Œè¿™ä¸ªä¸€å®šç¨‹åº¦å°±æ˜¯ä¸€ä¸ª<strong>å¹´é¾„é˜ˆå€¼</strong>ã€‚</p><h5 id="é»˜è®¤è§„åˆ™"><a href="#é»˜è®¤è§„åˆ™" class="headerlink" title="é»˜è®¤è§„åˆ™"></a><strong>é»˜è®¤è§„åˆ™</strong></h5><p>é»˜è®¤è§„åˆ™ä¸‹ï¼Œå¹´é¾„é˜ˆå€¼ç”± <strong><code>-XX:MaxTenuringThreshold</code></strong> è¿™ä¸ªå‚æ•°æ¥è§„å®šï¼Œé»˜è®¤å€¼ä¸º 15ã€‚p.s. åœ¨ Oracleå®˜ç½‘çš„<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">ä¸è™šæ‹Ÿæœºç›¸å…³çš„å‚æ•°</a>ä¸­ï¼Œå…³äº <strong><code>-XX:MaxTenuringThreshold</code></strong> æœ‰è¿™æ ·çš„ä¸€ä¸ªè¯´æ˜ï¼šé»˜è®¤æ™‹å‡å¹´é¾„å¹¶ä¸éƒ½æ˜¯15ï¼Œæ˜¯è¦åŒºåˆ†åƒåœ¾æ”¶é›†å™¨çš„ï¼ŒCMSå°±æ˜¯ 6ã€‚</p><p><img src="https://img.garenhou.com/jvm-dynamic-age-algorithm.png" alt="oracle-maxtenuringthreshold"></p><h5 id="åŠ¨æ€è§„åˆ™"><a href="#åŠ¨æ€è§„åˆ™" class="headerlink" title="åŠ¨æ€è§„åˆ™"></a><strong>åŠ¨æ€è§„åˆ™</strong></h5><p>Hotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“æŸä¸ªå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œ<strong>è¶…è¿‡äº† Survivor åŒºç©ºé—´çš„ä¸€åŠ</strong>æ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼ã€‚</p><blockquote><p>egï¼šSurvivor åŒº = 64Mï¼Œdesired Survivor = 32Mï¼Œæ­¤æ—¶ Survivor åŒºä¸­ age &lt;= 2 çš„å¯¹è±¡ç´¯è®¡å¤§å°ä¸º 41Mï¼Œ41M å¤§äº 32Mï¼Œæ‰€ä»¥æ™‹å‡å¹´é¾„é˜ˆå€¼è¢«è®¾ç½®ä¸º 2ï¼Œä¸‹æ¬¡ Minor GC æ—¶å°†å¹´é¾„è¶…è¿‡ 2 çš„å¯¹è±¡è¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚å°±ä¼šå¯¼è‡´ Old Generation å¿«é€Ÿå¡«æ»¡ï¼Œè§¦å‘Major GC (Major GC æœ‰ä¸‰å¤„ STW ) ï¼Œæ‰€ä»¥æ­¤æ—¶å»ºè®®è°ƒæ•´ <strong>-XX:SurvivorRatio</strong> å‚æ•°ã€‚</p></blockquote><p>åŠ¨æ€å¹´é¾„è®¡ç®—çš„æºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">uint ageTable::compute_tenuring_threshold(size_t survivor_capacity) &#123;</span><br><span class="line"><span class="comment">//survivor_capacityæ˜¯survivorç©ºé—´çš„å¤§å°</span></span><br><span class="line">size_t desired_survivor_size = (size_t)((((<span class="keyword">double</span>) survivor_capacity)*TargetSurvivorRatio)/<span class="number">100</span>);</span><br><span class="line">size_t total = <span class="number">0</span>;</span><br><span class="line">uint age = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (age &lt; table_size) &#123;</span><br><span class="line"> total += sizes[age];<span class="comment">//sizesæ•°ç»„æ˜¯æ¯ä¸ªå¹´é¾„æ®µå¯¹è±¡å¤§å°</span></span><br><span class="line"> <span class="keyword">if</span> (total &gt; desired_survivor_size) <span class="keyword">break</span>;</span><br><span class="line"> age++;</span><br><span class="line">&#125;</span><br><span class="line">uint result = age &lt; MaxTenuringThreshold ? age : MaxTenuringThreshold;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JVMå¼•å…¥åŠ¨æ€å¹´é¾„è®¡ç®—åŸå› "><a href="#JVMå¼•å…¥åŠ¨æ€å¹´é¾„è®¡ç®—åŸå› " class="headerlink" title="JVMå¼•å…¥åŠ¨æ€å¹´é¾„è®¡ç®—åŸå› "></a>JVMå¼•å…¥åŠ¨æ€å¹´é¾„è®¡ç®—åŸå› </h4><p>ä¸»è¦åŸºäºä»¥ä¸‹ä¸¤ç‚¹è€ƒè™‘ï¼š</p><ol><li><p>å¦‚æœå›ºå®šæŒ‰ç…§ MaxTenuringThreshold è®¾å®šçš„é˜ˆå€¼ä½œä¸ºæ™‹å‡æ¡ä»¶ï¼š aï¼‰MaxTenuringThreshold è®¾ç½®çš„è¿‡å¤§ï¼ŒåŸæœ¬åº”è¯¥æ™‹å‡çš„å¯¹è±¡ä¸€ç›´åœç•™åœ¨ Survivor åŒºï¼Œç›´åˆ° Survivor åŒºæº¢å‡ºï¼Œä¸€æ—¦æº¢å‡ºå‘ç”Ÿï¼ŒEden + Survivor ä¸­çš„å¯¹è±¡å°†ä¸å†ä¾æ®å¹´é¾„ï¼Œè€Œæ˜¯å…¨éƒ¨æå‡åˆ°è€å¹´ä»£ï¼Œè¿™æ ·å¯¹è±¡æå‡æœºåˆ¶å°±å¤±æ•ˆäº†ã€‚ bï¼‰MaxTenuringThreshold è®¾ç½®çš„è¿‡å°ï¼Œâ€œè¿‡æ—©æ™‹å‡â€ å³å¯¹è±¡ä¸èƒ½åœ¨æ–°ç”Ÿä»£å……åˆ†è¢«å›æ”¶ï¼Œå¤§é‡çŸ­æœŸå¯¹è±¡è¢«æ™‹å‡åˆ°è€å¹´ä»£ï¼Œè€å¹´ä»£æ‰€å ç©ºé—´è¿…é€Ÿå¢é•¿ï¼Œå¼•èµ·é¢‘ç¹çš„Major GCã€‚åˆ†ä»£å›æ”¶å¤±å»äº†æ„ä¹‰ï¼Œä¸¥é‡å½±å“GCæ€§èƒ½ã€‚</p></li><li><p>ç›¸åŒåº”ç”¨åœ¨ä¸åŒæ—¶é—´çš„è¡¨ç°ä¸åŒï¼šç‰¹æ®Šä»»åŠ¡çš„æ‰§è¡Œæˆ–è€…æµé‡æˆåˆ†çš„å˜åŒ–ï¼Œéƒ½ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ†å¸ƒå‘ç”Ÿæ³¢åŠ¨ï¼Œé‚£ä¹ˆå›ºå®šçš„é˜ˆå€¼è®¾å®šï¼Œå› ä¸ºæ— æ³•åŠ¨æ€é€‚åº”å˜åŒ–ï¼Œä¼šé€ æˆå’Œ 1 ä¸­ç›¸åŒçš„é—®é¢˜ã€‚</p></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œä¸ºäº†æ›´å¥½çš„é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜æƒ…å†µï¼Œ<strong>è™šæ‹Ÿæœºå¹¶ä¸æ€»æ˜¯è¦æ±‚å¯¹è±¡å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold å†æ™‹çº§è€å¹´ä»£</strong>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> åƒåœ¾å›æ”¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLçŸ¥è¯†ç‚¹æ€»ç»“</title>
      <link href="/2020/mysql-summary/"/>
      <url>/2020/mysql-summary/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>MySQLå­¦ä¹ åæ•´ç†çš„åŸºç¡€çŸ¥è¯†ä¼šæ±‡æ€»ï¼Œå¯éšæ—¶æŸ¥çœ‹ï¼Œåšå¤ä¹ ç”¨ã€‚</p><a id="more"></a><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">-- ä¿®æ”¹è¡¨æœ¬èº«çš„é€‰é¡¹</span></span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å è¡¨çš„é€‰é¡¹</span><br><span class="line">        eg: <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ENGINE</span>=MYISAM;</span><br><span class="line">    <span class="comment">-- å¯¹è¡¨è¿›è¡Œé‡å‘½å</span></span><br><span class="line">        <span class="keyword">RENAME</span> <span class="keyword">TABLE</span> åŸè¡¨å <span class="keyword">TO</span> æ–°è¡¨å</span><br><span class="line">        <span class="keyword">RENAME</span> <span class="keyword">TABLE</span> åŸè¡¨å <span class="keyword">TO</span> åº“å.è¡¨å ï¼ˆå¯å°†è¡¨ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ï¼‰</span><br><span class="line">        <span class="comment">-- RENAMEå¯ä»¥äº¤æ¢ä¸¤ä¸ªè¡¨å</span></span><br><span class="line">    <span class="comment">-- ä¿®æ”¹è¡¨çš„å­—æ®µæœºæ„ï¼ˆ13.1.2. ALTER TABLEè¯­æ³•ï¼‰</span></span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å æ“ä½œå</span><br><span class="line">        <span class="comment">-- æ“ä½œå</span></span><br><span class="line">            <span class="keyword">ADD</span>[ <span class="keyword">COLUMN</span>] å­—æ®µå®šä¹‰       <span class="comment">-- å¢åŠ å­—æ®µ</span></span><br><span class="line">                <span class="keyword">AFTER</span> å­—æ®µå          <span class="comment">-- è¡¨ç¤ºå¢åŠ åœ¨è¯¥å­—æ®µååé¢</span></span><br><span class="line">                <span class="keyword">FIRST</span>               <span class="comment">-- è¡¨ç¤ºå¢åŠ åœ¨ç¬¬ä¸€ä¸ª</span></span><br><span class="line">            <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(å­—æ®µå)   <span class="comment">-- åˆ›å»ºä¸»é”®</span></span><br><span class="line">            <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> [ç´¢å¼•å] (å­—æ®µå)<span class="comment">-- åˆ›å»ºå”¯ä¸€ç´¢å¼•</span></span><br><span class="line">            <span class="keyword">ADD</span> <span class="keyword">INDEX</span> [ç´¢å¼•å] (å­—æ®µå) <span class="comment">-- åˆ›å»ºæ™®é€šç´¢å¼•</span></span><br><span class="line">            <span class="keyword">DROP</span>[ <span class="keyword">COLUMN</span>] å­—æ®µå      <span class="comment">-- åˆ é™¤å­—æ®µ</span></span><br><span class="line">            <span class="keyword">MODIFY</span>[ <span class="keyword">COLUMN</span>] å­—æ®µå å­—æ®µå±æ€§     <span class="comment">-- æ”¯æŒå¯¹å­—æ®µå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œä¸èƒ½ä¿®æ”¹å­—æ®µå(æ‰€æœ‰åŸæœ‰å±æ€§ä¹Ÿéœ€å†™ä¸Š)</span></span><br><span class="line">            <span class="keyword">CHANGE</span>[ <span class="keyword">COLUMN</span>] åŸå­—æ®µå æ–°å­—æ®µå å­—æ®µå±æ€§      <span class="comment">-- æ”¯æŒå¯¹å­—æ®µåä¿®æ”¹</span></span><br><span class="line">            <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>    <span class="comment">-- åˆ é™¤ä¸»é”®(åˆ é™¤ä¸»é”®å‰éœ€åˆ é™¤å…¶AUTO_INCREMENTå±æ€§)</span></span><br><span class="line">            <span class="keyword">DROP</span> <span class="keyword">INDEX</span> ç´¢å¼•å <span class="comment">-- åˆ é™¤ç´¢å¼•</span></span><br><span class="line">            <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> å¤–é”®    <span class="comment">-- åˆ é™¤å¤–é”®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤è¡¨</span></span><br><span class="line">    <span class="keyword">DROP</span> <span class="keyword">TABLE</span>[ <span class="keyword">IF</span> <span class="keyword">EXISTS</span>] è¡¨å ...</span><br><span class="line"><span class="comment">-- æ¸…ç©ºè¡¨æ•°æ®</span></span><br><span class="line">    <span class="keyword">TRUNCATE</span> [<span class="keyword">TABLE</span>] è¡¨å</span><br><span class="line"><span class="comment">-- å¤åˆ¶è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">LIKE</span> è¦å¤åˆ¶çš„è¡¨å</span><br><span class="line"><span class="comment">-- å¤åˆ¶è¡¨ç»“æ„å’Œæ•°æ®</span></span><br><span class="line">    <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å [<span class="keyword">AS</span>] <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> è¦å¤åˆ¶çš„è¡¨å</span><br><span class="line"><span class="comment">-- æ£€æŸ¥è¡¨æ˜¯å¦æœ‰é”™è¯¯</span></span><br><span class="line">    <span class="keyword">CHECK</span> <span class="keyword">TABLE</span> tbl_name [, tbl_name] ... [<span class="keyword">option</span>] ...</span><br><span class="line"><span class="comment">-- ä¼˜åŒ–è¡¨</span></span><br><span class="line">    <span class="keyword">OPTIMIZE</span> [<span class="keyword">LOCAL</span> | <span class="keyword">NO_WRITE_TO_BINLOG</span>] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ...</span><br><span class="line"><span class="comment">-- ä¿®å¤è¡¨</span></span><br><span class="line">    <span class="keyword">REPAIR</span> [<span class="keyword">LOCAL</span> | <span class="keyword">NO_WRITE_TO_BINLOG</span>] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ... [<span class="keyword">QUICK</span>] [<span class="keyword">EXTENDED</span>] [USE_FRM]</span><br><span class="line"><span class="comment">-- åˆ†æè¡¨</span></span><br><span class="line">    <span class="keyword">ANALYZE</span> [<span class="keyword">LOCAL</span> | <span class="keyword">NO_WRITE_TO_BINLOG</span>] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ•°æ®æ“ä½œ */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="comment">-- å¢</span></span><br><span class="line">    <span class="keyword">INSERT</span> [<span class="keyword">INTO</span>] è¡¨å [(å­—æ®µåˆ—è¡¨)] <span class="keyword">VALUES</span> (å€¼åˆ—è¡¨)[, (å€¼åˆ—è¡¨), ...]</span><br><span class="line">        <span class="comment">-- å¦‚æœè¦æ’å…¥çš„å€¼åˆ—è¡¨åŒ…å«æ‰€æœ‰å­—æ®µå¹¶ä¸”é¡ºåºä¸€è‡´ï¼Œåˆ™å¯ä»¥çœç•¥å­—æ®µåˆ—è¡¨ã€‚</span></span><br><span class="line">        <span class="comment">-- å¯åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®è®°å½•ï¼</span></span><br><span class="line">        <span class="keyword">REPLACE</span> ä¸ <span class="keyword">INSERT</span> å®Œå…¨ä¸€æ ·ï¼Œå¯äº’æ¢ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> [<span class="keyword">INTO</span>] è¡¨å <span class="keyword">SET</span> å­—æ®µå=å€¼[, å­—æ®µå=å€¼, ...]</span><br><span class="line"><span class="comment">-- æŸ¥</span></span><br><span class="line">    <span class="keyword">SELECT</span> å­—æ®µåˆ—è¡¨ <span class="keyword">FROM</span> è¡¨å[ å…¶ä»–å­å¥]</span><br><span class="line">        <span class="comment">-- å¯æ¥è‡ªå¤šä¸ªè¡¨çš„å¤šä¸ªå­—æ®µ</span></span><br><span class="line">        <span class="comment">-- å…¶ä»–å­å¥å¯ä»¥ä¸ä½¿ç”¨</span></span><br><span class="line">        <span class="comment">-- å­—æ®µåˆ—è¡¨å¯ä»¥ç”¨*ä»£æ›¿ï¼Œè¡¨ç¤ºæ‰€æœ‰å­—æ®µ</span></span><br><span class="line"><span class="comment">-- åˆ </span></span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> è¡¨å[ åˆ é™¤æ¡ä»¶å­å¥]</span><br><span class="line">        æ²¡æœ‰æ¡ä»¶å­å¥ï¼Œåˆ™ä¼šåˆ é™¤å…¨éƒ¨</span><br><span class="line"><span class="comment">-- æ”¹</span></span><br><span class="line">    <span class="keyword">UPDATE</span> è¡¨å <span class="keyword">SET</span> å­—æ®µå=æ–°å€¼[, å­—æ®µå=æ–°å€¼] [æ›´æ–°æ¡ä»¶]</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å­—ç¬¦é›†ç¼–ç  */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="comment">-- MySQLã€æ•°æ®åº“ã€è¡¨ã€å­—æ®µå‡å¯è®¾ç½®ç¼–ç </span></span><br><span class="line"><span class="comment">-- æ•°æ®ç¼–ç ä¸å®¢æˆ·ç«¯ç¼–ç ä¸éœ€ä¸€è‡´</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'character_set_%'</span>   <span class="comment">-- æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†ç¼–ç é¡¹</span></span><br><span class="line">    character_set_client        å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ä½¿ç”¨çš„ç¼–ç </span><br><span class="line">    character_set_results       æœåŠ¡å™¨ç«¯å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯æ‰€ä½¿ç”¨çš„ç¼–ç </span><br><span class="line">    character_set_connection    è¿æ¥å±‚ç¼–ç </span><br><span class="line"><span class="keyword">SET</span> å˜é‡å = å˜é‡å€¼</span><br><span class="line">    <span class="keyword">SET</span> character_set_client = gbk;</span><br><span class="line">    <span class="keyword">SET</span> character_set_results = gbk;</span><br><span class="line">    <span class="keyword">SET</span> character_set_connection = gbk;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> GBK;  <span class="comment">-- ç›¸å½“äºå®Œæˆä»¥ä¸Šä¸‰ä¸ªè®¾ç½®</span></span><br><span class="line"><span class="comment">-- æ ¡å¯¹é›†</span></span><br><span class="line">    æ ¡å¯¹é›†ç”¨ä»¥æ’åº</span><br><span class="line">    <span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> [<span class="keyword">LIKE</span> <span class="string">'pattern'</span>]/<span class="keyword">SHOW</span> <span class="keyword">CHARSET</span> [<span class="keyword">LIKE</span> <span class="string">'pattern'</span>]   æŸ¥çœ‹æ‰€æœ‰å­—ç¬¦é›†</span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">COLLATION</span> [<span class="keyword">LIKE</span> <span class="string">'pattern'</span>]     æŸ¥çœ‹æ‰€æœ‰æ ¡å¯¹é›†</span><br><span class="line">    <span class="keyword">CHARSET</span> å­—ç¬¦é›†ç¼–ç      è®¾ç½®å­—ç¬¦é›†ç¼–ç </span><br><span class="line">    <span class="keyword">COLLATE</span> æ ¡å¯¹é›†ç¼–ç      è®¾ç½®æ ¡å¯¹é›†ç¼–ç </span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ•°æ®ç±»å‹ï¼ˆåˆ—ç±»å‹ï¼‰ */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="number">1.</span> æ•°å€¼ç±»å‹</span><br><span class="line"><span class="comment">-- a. æ•´å‹ ----------</span></span><br><span class="line">    ç±»å‹         å­—èŠ‚     èŒƒå›´ï¼ˆæœ‰ç¬¦å·ä½ï¼‰</span><br><span class="line">    <span class="built_in">tinyint</span>     <span class="number">1</span>å­—èŠ‚    <span class="number">-128</span> ~ <span class="number">127</span>      æ— ç¬¦å·ä½ï¼š<span class="number">0</span> ~ <span class="number">255</span></span><br><span class="line">    <span class="built_in">smallint</span>    <span class="number">2</span>å­—èŠ‚    <span class="number">-32768</span> ~ <span class="number">32767</span></span><br><span class="line">    mediumint   <span class="number">3</span>å­—èŠ‚    <span class="number">-8388608</span> ~ <span class="number">8388607</span></span><br><span class="line">    <span class="built_in">int</span>         <span class="number">4</span>å­—èŠ‚</span><br><span class="line">    <span class="built_in">bigint</span>      <span class="number">8</span>å­—èŠ‚</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span>(M)  Mè¡¨ç¤ºæ€»ä½æ•°</span><br><span class="line">    - é»˜è®¤å­˜åœ¨ç¬¦å·ä½ï¼Œ<span class="keyword">unsigned</span> å±æ€§ä¿®æ”¹</span><br><span class="line">    - æ˜¾ç¤ºå®½åº¦ï¼Œå¦‚æœæŸä¸ªæ•°ä¸å¤Ÿå®šä¹‰å­—æ®µæ—¶è®¾ç½®çš„ä½æ•°ï¼Œåˆ™å‰é¢ä»¥<span class="number">0</span>è¡¥å¡«ï¼Œzerofill å±æ€§ä¿®æ”¹</span><br><span class="line">        ä¾‹ï¼š<span class="built_in">int</span>(<span class="number">5</span>)   æ’å…¥ä¸€ä¸ªæ•°<span class="string">'123'</span>ï¼Œè¡¥å¡«åä¸º<span class="string">'00123'</span></span><br><span class="line">    - åœ¨æ»¡è¶³è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œè¶Šå°è¶Šå¥½ã€‚</span><br><span class="line">    - <span class="number">1</span>è¡¨ç¤º<span class="built_in">bool</span>å€¼çœŸï¼Œ<span class="number">0</span>è¡¨ç¤º<span class="built_in">bool</span>å€¼å‡ã€‚MySQLæ²¡æœ‰å¸ƒå°”ç±»å‹ï¼Œé€šè¿‡æ•´å‹<span class="number">0</span>å’Œ<span class="number">1</span>è¡¨ç¤ºã€‚å¸¸ç”¨<span class="built_in">tinyint</span>(<span class="number">1</span>)è¡¨ç¤ºå¸ƒå°”å‹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. æµ®ç‚¹å‹ ----------</span></span><br><span class="line">    ç±»å‹             å­—èŠ‚     èŒƒå›´</span><br><span class="line">    <span class="built_in">float</span>(å•ç²¾åº¦)     <span class="number">4</span>å­—èŠ‚</span><br><span class="line">    <span class="keyword">double</span>(åŒç²¾åº¦)    <span class="number">8</span>å­—èŠ‚</span><br><span class="line">    æµ®ç‚¹å‹æ—¢æ”¯æŒç¬¦å·ä½ <span class="keyword">unsigned</span> å±æ€§ï¼Œä¹Ÿæ”¯æŒæ˜¾ç¤ºå®½åº¦ zerofill å±æ€§ã€‚</span><br><span class="line">        ä¸åŒäºæ•´å‹ï¼Œå‰åå‡ä¼šè¡¥å¡«<span class="number">0.</span></span><br><span class="line">    å®šä¹‰æµ®ç‚¹å‹æ—¶ï¼Œéœ€æŒ‡å®šæ€»ä½æ•°å’Œå°æ•°ä½æ•°ã€‚</span><br><span class="line">        <span class="built_in">float</span>(M, D)     <span class="keyword">double</span>(M, D)</span><br><span class="line">        Mè¡¨ç¤ºæ€»ä½æ•°ï¼ŒDè¡¨ç¤ºå°æ•°ä½æ•°ã€‚</span><br><span class="line">        Må’ŒDçš„å¤§å°ä¼šå†³å®šæµ®ç‚¹æ•°çš„èŒƒå›´ã€‚ä¸åŒäºæ•´å‹çš„å›ºå®šèŒƒå›´ã€‚</span><br><span class="line">        Mæ—¢è¡¨ç¤ºæ€»ä½æ•°ï¼ˆä¸åŒ…æ‹¬å°æ•°ç‚¹å’Œæ­£è´Ÿå·ï¼‰ï¼Œä¹Ÿè¡¨ç¤ºæ˜¾ç¤ºå®½åº¦ï¼ˆæ‰€æœ‰æ˜¾ç¤ºç¬¦å·å‡åŒ…æ‹¬ï¼‰ã€‚</span><br><span class="line">        æ”¯æŒç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºã€‚</span><br><span class="line">        æµ®ç‚¹æ•°è¡¨ç¤ºè¿‘ä¼¼å€¼ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- c. å®šç‚¹æ•° ----------</span></span><br><span class="line">    <span class="built_in">decimal</span> <span class="comment">-- å¯å˜é•¿åº¦</span></span><br><span class="line">    <span class="built_in">decimal</span>(M, D)   Mä¹Ÿè¡¨ç¤ºæ€»ä½æ•°ï¼ŒDè¡¨ç¤ºå°æ•°ä½æ•°ã€‚</span><br><span class="line">    ä¿å­˜ä¸€ä¸ªç²¾ç¡®çš„æ•°å€¼ï¼Œä¸ä¼šå‘ç”Ÿæ•°æ®çš„æ”¹å˜ï¼Œä¸åŒäºæµ®ç‚¹æ•°çš„å››èˆäº”å…¥ã€‚</span><br><span class="line">    å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¥ä¿å­˜ï¼Œæ¯<span class="number">9</span>ä½æ•°å­—ä¿å­˜ä¸º<span class="number">4</span>ä¸ªå­—èŠ‚ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> å­—ç¬¦ä¸²ç±»å‹</span><br><span class="line"><span class="comment">-- a. char, varchar ----------</span></span><br><span class="line">    <span class="built_in">char</span>    å®šé•¿å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æµªè´¹ç©ºé—´</span><br><span class="line">    <span class="built_in">varchar</span> å˜é•¿å­—ç¬¦ä¸²ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†èŠ‚çœç©ºé—´</span><br><span class="line">    Mè¡¨ç¤ºèƒ½å­˜å‚¨çš„æœ€å¤§é•¿åº¦ï¼Œæ­¤é•¿åº¦æ˜¯å­—ç¬¦æ•°ï¼Œéå­—èŠ‚æ•°ã€‚</span><br><span class="line">    ä¸åŒçš„ç¼–ç ï¼Œæ‰€å ç”¨çš„ç©ºé—´ä¸åŒã€‚</span><br><span class="line">    <span class="built_in">char</span>,æœ€å¤š<span class="number">255</span>ä¸ªå­—ç¬¦ï¼Œä¸ç¼–ç æ— å…³ã€‚</span><br><span class="line">    <span class="built_in">varchar</span>,æœ€å¤š<span class="number">65535</span>å­—ç¬¦ï¼Œä¸ç¼–ç æœ‰å…³ã€‚</span><br><span class="line">    ä¸€æ¡æœ‰æ•ˆè®°å½•æœ€å¤§ä¸èƒ½è¶…è¿‡<span class="number">65535</span>ä¸ªå­—èŠ‚ã€‚</span><br><span class="line">        utf8 æœ€å¤§ä¸º<span class="number">21844</span>ä¸ªå­—ç¬¦ï¼Œgbk æœ€å¤§ä¸º<span class="number">32766</span>ä¸ªå­—ç¬¦ï¼Œlatin1 æœ€å¤§ä¸º<span class="number">65532</span>ä¸ªå­—ç¬¦</span><br><span class="line">    <span class="built_in">varchar</span> æ˜¯å˜é•¿çš„ï¼Œéœ€è¦åˆ©ç”¨å­˜å‚¨ç©ºé—´ä¿å­˜ <span class="built_in">varchar</span> çš„é•¿åº¦ï¼Œå¦‚æœæ•°æ®å°äº<span class="number">255</span>ä¸ªå­—èŠ‚ï¼Œåˆ™é‡‡ç”¨ä¸€ä¸ªå­—èŠ‚æ¥ä¿å­˜é•¿åº¦ï¼Œåä¹‹éœ€è¦ä¸¤ä¸ªå­—èŠ‚æ¥ä¿å­˜ã€‚</span><br><span class="line">    <span class="built_in">varchar</span> çš„æœ€å¤§æœ‰æ•ˆé•¿åº¦ç”±æœ€å¤§è¡Œå¤§å°å’Œä½¿ç”¨çš„å­—ç¬¦é›†ç¡®å®šã€‚</span><br><span class="line">    æœ€å¤§æœ‰æ•ˆé•¿åº¦æ˜¯<span class="number">65532</span>å­—èŠ‚ï¼Œå› ä¸ºåœ¨<span class="built_in">varchar</span>å­˜å­—ç¬¦ä¸²æ—¶ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ç©ºçš„ï¼Œä¸å­˜åœ¨ä»»ä½•æ•°æ®ï¼Œç„¶åè¿˜éœ€ä¸¤ä¸ªå­—èŠ‚æ¥å­˜æ”¾å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥æœ‰æ•ˆé•¿åº¦æ˜¯<span class="number">64432</span><span class="number">-1</span><span class="number">-2</span>=<span class="number">65532</span>å­—èŠ‚ã€‚</span><br><span class="line">    ä¾‹ï¼šè‹¥ä¸€ä¸ªè¡¨å®šä¹‰ä¸º CREATE TABLE tb(c1 int, c2 char(30), c3 varchar(N)) charset=utf8; é—®Nçš„æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Ÿ ç­”ï¼š(65535-1-2-4-30*3)/3</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. blob, text ----------</span></span><br><span class="line">    blob äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—èŠ‚å­—ç¬¦ä¸²ï¼‰</span><br><span class="line">        tinyblob, blob, mediumblob, longblob</span><br><span class="line">    text éäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå­—ç¬¦å­—ç¬¦ä¸²ï¼‰</span><br><span class="line">        tinytext, text, mediumtext, longtext</span><br><span class="line">    text åœ¨å®šä¹‰æ—¶ï¼Œä¸éœ€è¦å®šä¹‰é•¿åº¦ï¼Œä¹Ÿä¸ä¼šè®¡ç®—æ€»é•¿åº¦ã€‚</span><br><span class="line">    text ç±»å‹åœ¨å®šä¹‰æ—¶ï¼Œä¸å¯ç»™defaultå€¼</span><br><span class="line"></span><br><span class="line"><span class="comment">-- c. binary, varbinary ----------</span></span><br><span class="line">    ç±»ä¼¼äºcharå’Œvarcharï¼Œç”¨äºä¿å­˜äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜å­—èŠ‚å­—ç¬¦ä¸²è€Œéå­—ç¬¦å­—ç¬¦ä¸²ã€‚</span><br><span class="line">    char, varchar, text å¯¹åº” binary, varbinary, blob.</span><br><span class="line"></span><br><span class="line">3. æ—¥æœŸæ—¶é—´ç±»å‹</span><br><span class="line">    ä¸€èˆ¬ç”¨æ•´å‹ä¿å­˜æ—¶é—´æˆ³ï¼Œå› ä¸ºPHPå¯ä»¥å¾ˆæ–¹ä¾¿çš„å°†æ—¶é—´æˆ³è¿›è¡Œæ ¼å¼åŒ–ã€‚</span><br><span class="line">    datetime    8å­—èŠ‚    æ—¥æœŸåŠæ—¶é—´     1000-01-01 00:00:00 åˆ° 9999-12-31 23:59:59</span><br><span class="line">    date        3å­—èŠ‚    æ—¥æœŸ         1000-01-01 åˆ° 9999-12-31</span><br><span class="line">    timestamp   4å­—èŠ‚    æ—¶é—´æˆ³        19700101000000 åˆ° 2038-01-19 03:14:07</span><br><span class="line">    time        3å­—èŠ‚    æ—¶é—´         -838:59:59 åˆ° 838:59:59</span><br><span class="line">    year        1å­—èŠ‚    å¹´ä»½         1901 - 2155</span><br><span class="line"></span><br><span class="line">datetime    YYYY-MM-DD hh:mm:ss</span><br><span class="line">timestamp   YY-MM-DD hh:mm:ss</span><br><span class="line">            YYYYMMDDhhmmss</span><br><span class="line">            YYMMDDhhmmss</span><br><span class="line">            YYYYMMDDhhmmss</span><br><span class="line">            YYMMDDhhmmss</span><br><span class="line">date        YYYY-MM-DD</span><br><span class="line">            YY-MM-DD</span><br><span class="line">            YYYYMMDD</span><br><span class="line">            YYMMDD</span><br><span class="line">            YYYYMMDD</span><br><span class="line">            YYMMDD</span><br><span class="line">time        hh:mm:ss</span><br><span class="line">            hhmmss</span><br><span class="line">            hhmmss</span><br><span class="line">year        YYYY</span><br><span class="line">            YY</span><br><span class="line">            YYYY</span><br><span class="line">            YY</span><br><span class="line"></span><br><span class="line">4. æšä¸¾å’Œé›†åˆ</span><br><span class="line"><span class="comment">-- æšä¸¾(enum) ----------</span></span><br><span class="line">enum(val1, val2, val3...)</span><br><span class="line">    åœ¨å·²çŸ¥çš„å€¼ä¸­è¿›è¡Œå•é€‰ã€‚æœ€å¤§æ•°é‡ä¸º65535.</span><br><span class="line">    æšä¸¾å€¼åœ¨ä¿å­˜æ—¶ï¼Œä»¥2ä¸ªå­—èŠ‚çš„æ•´å‹(smallint)ä¿å­˜ã€‚æ¯ä¸ªæšä¸¾å€¼ï¼ŒæŒ‰ä¿å­˜çš„ä½ç½®é¡ºåºï¼Œä»1å¼€å§‹é€ä¸€é€’å¢ã€‚</span><br><span class="line">    è¡¨ç°ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå­˜å‚¨å´æ˜¯æ•´å‹ã€‚</span><br><span class="line">    NULLå€¼çš„ç´¢å¼•æ˜¯NULLã€‚</span><br><span class="line">    ç©ºå­—ç¬¦ä¸²é”™è¯¯å€¼çš„ç´¢å¼•å€¼æ˜¯0ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é›†åˆï¼ˆsetï¼‰ ----------</span></span><br><span class="line"><span class="keyword">set</span>(val1, val2, val3...)</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">table</span> tab ( gender <span class="keyword">set</span>(<span class="string">'ç”·'</span>, <span class="string">'å¥³'</span>, <span class="string">'æ— '</span>) );</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> tab <span class="keyword">values</span> (<span class="string">'ç”·, å¥³'</span>);</span><br><span class="line">    æœ€å¤šå¯ä»¥æœ‰64ä¸ªä¸åŒçš„æˆå‘˜ã€‚ä»¥bigintå­˜å‚¨ï¼Œå…±8ä¸ªå­—èŠ‚ã€‚é‡‡å–ä½è¿ç®—çš„å½¢å¼ã€‚</span><br><span class="line">    å½“åˆ›å»ºè¡¨æ—¶ï¼Œ<span class="keyword">SET</span>æˆå‘˜å€¼çš„å°¾éƒ¨ç©ºæ ¼å°†è‡ªåŠ¨è¢«åˆ é™¤ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é€‰æ‹©ç±»å‹ */</span></span><br><span class="line"><span class="comment">-- PHPè§’åº¦</span></span><br><span class="line"><span class="number">1.</span> åŠŸèƒ½æ»¡è¶³</span><br><span class="line"><span class="number">2.</span> å­˜å‚¨ç©ºé—´å°½é‡å°ï¼Œå¤„ç†æ•ˆç‡æ›´é«˜</span><br><span class="line"><span class="number">3.</span> è€ƒè™‘å…¼å®¹é—®é¢˜</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IPå­˜å‚¨ ----------</span></span><br><span class="line"><span class="number">1.</span> åªéœ€å­˜å‚¨ï¼Œå¯ç”¨å­—ç¬¦ä¸²</span><br><span class="line"><span class="number">2.</span> å¦‚æœéœ€è®¡ç®—ï¼ŒæŸ¥æ‰¾ç­‰ï¼Œå¯å­˜å‚¨ä¸º<span class="number">4</span>ä¸ªå­—èŠ‚çš„æ— ç¬¦å·<span class="built_in">int</span>ï¼Œå³<span class="keyword">unsigned</span></span><br><span class="line">    <span class="number">1</span>) PHPå‡½æ•°è½¬æ¢</span><br><span class="line">        ip2longå¯è½¬æ¢ä¸ºæ•´å‹ï¼Œä½†ä¼šå‡ºç°æºå¸¦ç¬¦å·é—®é¢˜ã€‚éœ€æ ¼å¼åŒ–ä¸ºæ— ç¬¦å·çš„æ•´å‹ã€‚</span><br><span class="line">        åˆ©ç”¨sprintfå‡½æ•°æ ¼å¼åŒ–å­—ç¬¦ä¸²</span><br><span class="line">        sprintf(<span class="string">"%u"</span>, ip2long(<span class="string">'192.168.3.134'</span>));</span><br><span class="line">        ç„¶åç”¨long2ipå°†æ•´å‹è½¬å›IPå­—ç¬¦ä¸²</span><br><span class="line">    2) MySQLå‡½æ•°è½¬æ¢(æ— ç¬¦å·æ•´å‹ï¼ŒUNSIGNED)</span><br><span class="line">        INET_ATON('127.0.0.1') å°†IPè½¬ä¸ºæ•´å‹</span><br><span class="line">        INET_NTOA(2130706433) å°†æ•´å‹è½¬ä¸ºIP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆ—å±æ€§ï¼ˆåˆ—çº¦æŸï¼‰ */</span> <span class="comment">------------------</span></span><br><span class="line">1. PRIMARY ä¸»é”®</span><br><span class="line">    - èƒ½å”¯ä¸€æ ‡è¯†è®°å½•çš„å­—æ®µï¼Œå¯ä»¥ä½œä¸ºä¸»é”®ã€‚</span><br><span class="line">    - ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</span><br><span class="line">    - ä¸»é”®å…·æœ‰å”¯ä¸€æ€§ã€‚</span><br><span class="line">    - å£°æ˜å­—æ®µæ—¶ï¼Œç”¨ primary key æ ‡è¯†ã€‚</span><br><span class="line">        ä¹Ÿå¯ä»¥åœ¨å­—æ®µåˆ—è¡¨ä¹‹åå£°æ˜</span><br><span class="line">            ä¾‹ï¼š<span class="keyword">create</span> <span class="keyword">table</span> tab ( <span class="keyword">id</span> <span class="built_in">int</span>, stu <span class="built_in">varchar</span>(<span class="number">10</span>), primary <span class="keyword">key</span> (<span class="keyword">id</span>));</span><br><span class="line">    - ä¸»é”®å­—æ®µçš„å€¼ä¸èƒ½ä¸ºnullã€‚</span><br><span class="line">    - ä¸»é”®å¯ä»¥ç”±å¤šä¸ªå­—æ®µå…±åŒç»„æˆã€‚æ­¤æ—¶éœ€è¦åœ¨å­—æ®µåˆ—è¡¨åå£°æ˜çš„æ–¹æ³•ã€‚</span><br><span class="line">        ä¾‹ï¼š<span class="keyword">create</span> <span class="keyword">table</span> tab ( <span class="keyword">id</span> <span class="built_in">int</span>, stu <span class="built_in">varchar</span>(<span class="number">10</span>), age <span class="built_in">int</span>, primary <span class="keyword">key</span> (stu, age));</span><br><span class="line"></span><br><span class="line">2. UNIQUE å”¯ä¸€ç´¢å¼•ï¼ˆå”¯ä¸€çº¦æŸï¼‰</span><br><span class="line">    ä½¿å¾—æŸå­—æ®µçš„å€¼ä¹Ÿä¸èƒ½é‡å¤ã€‚</span><br><span class="line"></span><br><span class="line">3. NULL çº¦æŸ</span><br><span class="line">    nullä¸æ˜¯æ•°æ®ç±»å‹ï¼Œæ˜¯åˆ—çš„ä¸€ä¸ªå±æ€§ã€‚</span><br><span class="line">    è¡¨ç¤ºå½“å‰åˆ—æ˜¯å¦å¯ä»¥ä¸ºnullï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚</span><br><span class="line">    null, å…è®¸ä¸ºç©ºã€‚é»˜è®¤ã€‚</span><br><span class="line">    not null, ä¸å…è®¸ä¸ºç©ºã€‚</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> tab <span class="keyword">values</span> (<span class="literal">null</span>, <span class="string">'val'</span>);</span><br><span class="line">        <span class="comment">-- æ­¤æ—¶è¡¨ç¤ºå°†ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼è®¾ä¸ºnull, å–å†³äºè¯¥å­—æ®µæ˜¯å¦å…è®¸ä¸ºnull</span></span><br><span class="line"></span><br><span class="line">4. DEFAULT é»˜è®¤å€¼å±æ€§</span><br><span class="line">    å½“å‰å­—æ®µçš„é»˜è®¤å€¼ã€‚</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> tab <span class="keyword">values</span> (<span class="keyword">default</span>, <span class="string">'val'</span>);    <span class="comment">-- æ­¤æ—¶è¡¨ç¤ºå¼ºåˆ¶ä½¿ç”¨é»˜è®¤å€¼ã€‚</span></span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">table</span> tab ( add_time <span class="built_in">timestamp</span> <span class="keyword">default</span> <span class="keyword">current_timestamp</span> );</span><br><span class="line">        <span class="comment">-- è¡¨ç¤ºå°†å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³è®¾ä¸ºé»˜è®¤å€¼ã€‚</span></span><br><span class="line">        current_date, current_time</span><br><span class="line"></span><br><span class="line">5. AUTO_INCREMENT è‡ªåŠ¨å¢é•¿çº¦æŸ</span><br><span class="line">    è‡ªåŠ¨å¢é•¿å¿…é¡»ä¸ºç´¢å¼•ï¼ˆä¸»é”®æˆ–uniqueï¼‰</span><br><span class="line">    åªèƒ½å­˜åœ¨ä¸€ä¸ªå­—æ®µä¸ºè‡ªåŠ¨å¢é•¿ã€‚</span><br><span class="line">    é»˜è®¤ä¸º1å¼€å§‹è‡ªåŠ¨å¢é•¿ã€‚å¯ä»¥é€šè¿‡è¡¨å±æ€§ auto_increment = xè¿›è¡Œè®¾ç½®ï¼Œæˆ– <span class="keyword">alter</span> <span class="keyword">table</span> tbl auto_increment = x;</span><br><span class="line"></span><br><span class="line">6. <span class="keyword">COMMENT</span> æ³¨é‡Š</span><br><span class="line">    ä¾‹ï¼š<span class="keyword">create</span> <span class="keyword">table</span> tab ( <span class="keyword">id</span> <span class="built_in">int</span> ) <span class="keyword">comment</span> <span class="string">'æ³¨é‡Šå†…å®¹'</span>;</span><br><span class="line"></span><br><span class="line">7. FOREIGN KEY å¤–é”®çº¦æŸ</span><br><span class="line">    ç”¨äºé™åˆ¶ä¸»è¡¨ä¸ä»è¡¨æ•°æ®å®Œæ•´æ€§ã€‚</span><br><span class="line">    <span class="keyword">alter</span> <span class="keyword">table</span> t1 <span class="keyword">add</span> <span class="keyword">constraint</span> <span class="string">`t1_t2_fk`</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (t1_id) <span class="keyword">references</span> t2(<span class="keyword">id</span>);</span><br><span class="line">        <span class="comment">-- å°†è¡¨t1çš„t1_idå¤–é”®å…³è”åˆ°è¡¨t2çš„idå­—æ®µã€‚</span></span><br><span class="line">        <span class="comment">-- æ¯ä¸ªå¤–é”®éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œå¯ä»¥é€šè¿‡ constraint æŒ‡å®š</span></span><br><span class="line"></span><br><span class="line">    å­˜åœ¨å¤–é”®çš„è¡¨ï¼Œç§°ä¹‹ä¸ºä»è¡¨ï¼ˆå­è¡¨ï¼‰ï¼Œå¤–é”®æŒ‡å‘çš„è¡¨ï¼Œç§°ä¹‹ä¸ºä¸»è¡¨ï¼ˆçˆ¶è¡¨ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">    ä½œç”¨ï¼šä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œå®Œæ•´æ€§ï¼Œä¸»è¦ç›®çš„æ˜¯æ§åˆ¶å­˜å‚¨åœ¨å¤–é”®è¡¨ï¼ˆä»è¡¨ï¼‰ä¸­çš„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">    MySQLä¸­ï¼Œå¯ä»¥å¯¹InnoDBå¼•æ“ä½¿ç”¨å¤–é”®çº¦æŸï¼š</span><br><span class="line">    è¯­æ³•ï¼š</span><br><span class="line">    foreign key (å¤–é”®å­—æ®µï¼‰ references ä¸»è¡¨å (å…³è”å­—æ®µ) [ä¸»è¡¨è®°å½•åˆ é™¤æ—¶çš„åŠ¨ä½œ] [ä¸»è¡¨è®°å½•æ›´æ–°æ—¶çš„åŠ¨ä½œ]</span><br><span class="line">    æ­¤æ—¶éœ€è¦æ£€æµ‹ä¸€ä¸ªä»è¡¨çš„å¤–é”®éœ€è¦çº¦æŸä¸ºä¸»è¡¨çš„å·²å­˜åœ¨çš„å€¼ã€‚å¤–é”®åœ¨æ²¡æœ‰å…³è”çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½®ä¸ºnull.å‰ææ˜¯è¯¥å¤–é”®åˆ—ï¼Œæ²¡æœ‰not nullã€‚</span><br><span class="line"></span><br><span class="line">    å¯ä»¥ä¸æŒ‡å®šä¸»è¡¨è®°å½•æ›´æ”¹æˆ–æ›´æ–°æ—¶çš„åŠ¨ä½œï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸»è¡¨çš„æ“ä½œè¢«æ‹’ç»ã€‚</span><br><span class="line">    å¦‚æœæŒ‡å®šäº† on <span class="keyword">update</span> æˆ– <span class="keyword">on</span> <span class="keyword">delete</span>ï¼šåœ¨åˆ é™¤æˆ–æ›´æ–°æ—¶ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªæ“ä½œå¯ä»¥é€‰æ‹©ï¼š</span><br><span class="line">    <span class="number">1.</span> <span class="keyword">cascade</span>ï¼Œçº§è”æ“ä½œã€‚ä¸»è¡¨æ•°æ®è¢«æ›´æ–°ï¼ˆä¸»é”®å€¼æ›´æ–°ï¼‰ï¼Œä»è¡¨ä¹Ÿè¢«æ›´æ–°ï¼ˆå¤–é”®å€¼æ›´æ–°ï¼‰ã€‚ä¸»è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä»è¡¨ç›¸å…³è®°å½•ä¹Ÿè¢«åˆ é™¤ã€‚</span><br><span class="line">    <span class="number">2.</span> <span class="keyword">set</span> <span class="literal">null</span>ï¼Œè®¾ç½®ä¸º<span class="literal">null</span>ã€‚ä¸»è¡¨æ•°æ®è¢«æ›´æ–°ï¼ˆä¸»é”®å€¼æ›´æ–°ï¼‰ï¼Œä»è¡¨çš„å¤–é”®è¢«è®¾ç½®ä¸º<span class="literal">null</span>ã€‚ä¸»è¡¨è®°å½•è¢«åˆ é™¤ï¼Œä»è¡¨ç›¸å…³è®°å½•å¤–é”®è¢«è®¾ç½®æˆ<span class="literal">null</span>ã€‚ä½†æ³¨æ„ï¼Œè¦æ±‚è¯¥å¤–é”®åˆ—ï¼Œæ²¡æœ‰<span class="keyword">not</span> <span class="literal">null</span>å±æ€§çº¦æŸã€‚</span><br><span class="line">    <span class="number">3.</span> restrictï¼Œæ‹’ç»çˆ¶è¡¨åˆ é™¤å’Œæ›´æ–°ã€‚</span><br><span class="line"></span><br><span class="line">    æ³¨æ„ï¼Œå¤–é”®åªè¢«<span class="keyword">InnoDB</span>å­˜å‚¨å¼•æ“æ‰€æ”¯æŒã€‚å…¶ä»–å¼•æ“æ˜¯ä¸æ”¯æŒçš„ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å»ºè¡¨è§„èŒƒ */</span> <span class="comment">------------------</span></span><br><span class="line">    <span class="comment">-- Normal Format, NF</span></span><br><span class="line">        - æ¯ä¸ªè¡¨ä¿å­˜ä¸€ä¸ªå®ä½“ä¿¡æ¯</span><br><span class="line">        - æ¯ä¸ªå…·æœ‰ä¸€ä¸ª<span class="keyword">ID</span>å­—æ®µä½œä¸ºä¸»é”®</span><br><span class="line">        - <span class="keyword">ID</span>ä¸»é”® + åŸå­è¡¨</span><br><span class="line">    <span class="comment">-- 1NF, ç¬¬ä¸€èŒƒå¼</span></span><br><span class="line">        å­—æ®µä¸èƒ½å†åˆ†ï¼Œå°±æ»¡è¶³ç¬¬ä¸€èŒƒå¼ã€‚</span><br><span class="line">    <span class="comment">-- 2NF, ç¬¬äºŒèŒƒå¼</span></span><br><span class="line">        æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„å‰æä¸‹ï¼Œä¸èƒ½å‡ºç°éƒ¨åˆ†ä¾èµ–ã€‚</span><br><span class="line">        æ¶ˆé™¤ç¬¦åˆä¸»é”®å°±å¯ä»¥é¿å…éƒ¨åˆ†ä¾èµ–ã€‚å¢åŠ å•åˆ—å…³é”®å­—ã€‚</span><br><span class="line">    <span class="comment">-- 3NF, ç¬¬ä¸‰èŒƒå¼</span></span><br><span class="line">        æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„å‰æä¸‹ï¼Œä¸èƒ½å‡ºç°ä¼ é€’ä¾èµ–ã€‚</span><br><span class="line">        æŸä¸ªå­—æ®µä¾èµ–äºä¸»é”®ï¼Œè€Œæœ‰å…¶ä»–å­—æ®µä¾èµ–äºè¯¥å­—æ®µã€‚è¿™å°±æ˜¯ä¼ é€’ä¾èµ–ã€‚</span><br><span class="line">        å°†ä¸€ä¸ªå®ä½“ä¿¡æ¯çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªè¡¨å†…å®ç°ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SELECT */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">ALL</span>|<span class="keyword">DISTINCT</span>] select_expr <span class="keyword">FROM</span> -&gt; <span class="keyword">WHERE</span> -&gt; <span class="keyword">GROUP</span> <span class="keyword">BY</span> [åˆè®¡å‡½æ•°] -&gt; <span class="keyword">HAVING</span> -&gt; <span class="keyword">ORDER</span> <span class="keyword">BY</span> -&gt; <span class="keyword">LIMIT</span></span><br><span class="line"></span><br><span class="line">a. select_expr</span><br><span class="line">    <span class="comment">-- å¯ä»¥ç”¨ * è¡¨ç¤ºæ‰€æœ‰å­—æ®µã€‚</span></span><br><span class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> tb;</span><br><span class="line">    <span class="comment">-- å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼ˆè®¡ç®—å…¬å¼ã€å‡½æ•°è°ƒç”¨ã€å­—æ®µä¹Ÿæ˜¯ä¸ªè¡¨è¾¾å¼ï¼‰</span></span><br><span class="line">        <span class="keyword">select</span> stu, <span class="number">29</span>+<span class="number">25</span>, <span class="keyword">now</span>() <span class="keyword">from</span> tb;</span><br><span class="line">    <span class="comment">-- å¯ä»¥ä¸ºæ¯ä¸ªåˆ—ä½¿ç”¨åˆ«åã€‚é€‚ç”¨äºç®€åŒ–åˆ—æ ‡è¯†ï¼Œé¿å…å¤šä¸ªåˆ—æ ‡è¯†ç¬¦é‡å¤ã€‚</span></span><br><span class="line">        - ä½¿ç”¨ as å…³é”®å­—ï¼Œä¹Ÿå¯çœç•¥ as.</span><br><span class="line">        <span class="keyword">select</span> stu+<span class="number">10</span> <span class="keyword">as</span> add10 <span class="keyword">from</span> tb;</span><br><span class="line"></span><br><span class="line">b. FROM å­å¥</span><br><span class="line">    ç”¨äºæ ‡è¯†æŸ¥è¯¢æ¥æºã€‚</span><br><span class="line">    <span class="comment">-- å¯ä»¥ä¸ºè¡¨èµ·åˆ«åã€‚ä½¿ç”¨aså…³é”®å­—ã€‚</span></span><br><span class="line">        <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tb1 <span class="keyword">AS</span> tt, tb2 <span class="keyword">AS</span> bb;</span><br><span class="line">    <span class="comment">-- fromå­å¥åï¼Œå¯ä»¥åŒæ—¶å‡ºç°å¤šä¸ªè¡¨ã€‚</span></span><br><span class="line">        <span class="comment">-- å¤šä¸ªè¡¨ä¼šæ¨ªå‘å åŠ åˆ°ä¸€èµ·ï¼Œè€Œæ•°æ®ä¼šå½¢æˆä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚</span></span><br><span class="line">        <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tb1, tb2;</span><br><span class="line">    <span class="comment">-- å‘ä¼˜åŒ–ç¬¦æç¤ºå¦‚ä½•é€‰æ‹©ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">USE</span> <span class="keyword">INDEX</span>ã€<span class="keyword">IGNORE</span> <span class="keyword">INDEX</span>ã€<span class="keyword">FORCE</span> <span class="keyword">INDEX</span></span><br><span class="line">        <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table1 <span class="keyword">USE</span> <span class="keyword">INDEX</span> (key1,key2) <span class="keyword">WHERE</span> key1=<span class="number">1</span> <span class="keyword">AND</span> key2=<span class="number">2</span> <span class="keyword">AND</span> key3=<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> table1 <span class="keyword">IGNORE</span> <span class="keyword">INDEX</span> (key3) <span class="keyword">WHERE</span> key1=<span class="number">1</span> <span class="keyword">AND</span> key2=<span class="number">2</span> <span class="keyword">AND</span> key3=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">c. WHERE å­å¥</span><br><span class="line">    <span class="comment">-- ä»fromè·å¾—çš„æ•°æ®æºä¸­è¿›è¡Œç­›é€‰ã€‚</span></span><br><span class="line">    <span class="comment">-- æ•´å‹1è¡¨ç¤ºçœŸï¼Œ0è¡¨ç¤ºå‡ã€‚</span></span><br><span class="line">    <span class="comment">-- è¡¨è¾¾å¼ç”±è¿ç®—ç¬¦å’Œè¿ç®—æ•°ç»„æˆã€‚</span></span><br><span class="line">        <span class="comment">-- è¿ç®—æ•°ï¼šå˜é‡ï¼ˆå­—æ®µï¼‰ã€å€¼ã€å‡½æ•°è¿”å›å€¼</span></span><br><span class="line">        <span class="comment">-- è¿ç®—ç¬¦ï¼š</span></span><br><span class="line">            =, &lt;=&gt;, &lt;&gt;, !=, &lt;=, &lt;, &gt;=, &gt;, !, &amp;&amp;, ||,</span><br><span class="line">            in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xor</span><br><span class="line">            is/is not åŠ ä¸Šture/false/unknownï¼Œæ£€éªŒæŸä¸ªå€¼çš„çœŸå‡</span><br><span class="line">            &lt;=&gt;ä¸&lt;&gt;åŠŸèƒ½ç›¸åŒï¼Œ&lt;=&gt;å¯ç”¨äºnullæ¯”è¾ƒ</span><br><span class="line"></span><br><span class="line">d. GROUP BY å­å¥, åˆ†ç»„å­å¥</span><br><span class="line">    GROUP BY å­—æ®µ/åˆ«å [æ’åºæ–¹å¼]</span><br><span class="line">    åˆ†ç»„åä¼šè¿›è¡Œæ’åºã€‚å‡åºï¼šASCï¼Œé™åºï¼šDESC</span><br><span class="line"></span><br><span class="line">    ä»¥ä¸‹[åˆè®¡å‡½æ•°]éœ€é…åˆ GROUP BY ä½¿ç”¨ï¼š</span><br><span class="line">    count è¿”å›ä¸åŒçš„éNULLå€¼æ•°ç›®  count(*)ã€count(å­—æ®µ)</span><br><span class="line">    sum æ±‚å’Œ</span><br><span class="line">    max æ±‚æœ€å¤§å€¼</span><br><span class="line">    min æ±‚æœ€å°å€¼</span><br><span class="line">    avg æ±‚å¹³å‡å€¼</span><br><span class="line">    group_concat è¿”å›å¸¦æœ‰æ¥è‡ªä¸€ä¸ªç»„çš„è¿æ¥çš„éNULLå€¼çš„å­—ç¬¦ä¸²ç»“æœã€‚ç»„å†…å­—ç¬¦ä¸²è¿æ¥ã€‚</span><br><span class="line"></span><br><span class="line">e. HAVING å­å¥ï¼Œæ¡ä»¶å­å¥</span><br><span class="line">    ä¸ where åŠŸèƒ½ã€ç”¨æ³•ç›¸åŒï¼Œæ‰§è¡Œæ—¶æœºä¸åŒã€‚</span><br><span class="line">    where åœ¨å¼€å§‹æ—¶æ‰§è¡Œæ£€æµ‹æ•°æ®ï¼Œå¯¹åŸæ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚</span><br><span class="line">    having å¯¹ç­›é€‰å‡ºçš„ç»“æœå†æ¬¡è¿›è¡Œè¿‡æ»¤ã€‚</span><br><span class="line">    having å­—æ®µå¿…é¡»æ˜¯æŸ¥è¯¢å‡ºæ¥çš„ï¼Œwhere å­—æ®µå¿…é¡»æ˜¯æ•°æ®è¡¨å­˜åœ¨çš„ã€‚</span><br><span class="line">    where ä¸å¯ä»¥ä½¿ç”¨å­—æ®µçš„åˆ«åï¼Œhaving å¯ä»¥ã€‚å› ä¸ºæ‰§è¡ŒWHEREä»£ç æ—¶ï¼Œå¯èƒ½å°šæœªç¡®å®šåˆ—å€¼ã€‚</span><br><span class="line">    where ä¸å¯ä»¥ä½¿ç”¨åˆè®¡å‡½æ•°ã€‚ä¸€èˆ¬éœ€ç”¨åˆè®¡å‡½æ•°æ‰ä¼šç”¨ having</span><br><span class="line">    SQLæ ‡å‡†è¦æ±‚HAVINGå¿…é¡»å¼•ç”¨GROUP BYå­å¥ä¸­çš„åˆ—æˆ–ç”¨äºåˆè®¡å‡½æ•°ä¸­çš„åˆ—ã€‚</span><br><span class="line"></span><br><span class="line">f. ORDER BY å­å¥ï¼Œæ’åºå­å¥</span><br><span class="line">    order by æ’åºå­—æ®µ/åˆ«å æ’åºæ–¹å¼ [,æ’åºå­—æ®µ/åˆ«å æ’åºæ–¹å¼]...</span><br><span class="line">    å‡åºï¼šASCï¼Œé™åºï¼šDESC</span><br><span class="line">    æ”¯æŒå¤šä¸ªå­—æ®µçš„æ’åºã€‚</span><br><span class="line"></span><br><span class="line">g. LIMIT å­å¥ï¼Œé™åˆ¶ç»“æœæ•°é‡å­å¥</span><br><span class="line">    ä»…å¯¹å¤„ç†å¥½çš„ç»“æœè¿›è¡Œæ•°é‡é™åˆ¶ã€‚å°†å¤„ç†å¥½çš„ç»“æœçš„çœ‹ä½œæ˜¯ä¸€ä¸ªé›†åˆï¼ŒæŒ‰ç…§è®°å½•å‡ºç°çš„é¡ºåºï¼Œç´¢å¼•ä»0å¼€å§‹ã€‚</span><br><span class="line">    limit èµ·å§‹ä½ç½®, è·å–æ¡æ•°</span><br><span class="line">    çœç•¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä»ç´¢å¼•0å¼€å§‹ã€‚limit è·å–æ¡æ•°</span><br><span class="line"></span><br><span class="line">h. DISTINCT, ALL é€‰é¡¹</span><br><span class="line">    distinct å»é™¤é‡å¤è®°å½•</span><br><span class="line">    é»˜è®¤ä¸º all, å…¨éƒ¨è®°å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* UNION */</span> <span class="comment">------------------</span></span><br><span class="line">    å°†å¤šä¸ª<span class="keyword">select</span>æŸ¥è¯¢çš„ç»“æœç»„åˆæˆä¸€ä¸ªç»“æœé›†åˆã€‚</span><br><span class="line">    <span class="keyword">SELECT</span> ... <span class="keyword">UNION</span> [<span class="keyword">ALL</span>|<span class="keyword">DISTINCT</span>] <span class="keyword">SELECT</span> ...</span><br><span class="line">    é»˜è®¤ <span class="keyword">DISTINCT</span> æ–¹å¼ï¼Œå³æ‰€æœ‰è¿”å›çš„è¡Œéƒ½æ˜¯å”¯ä¸€çš„</span><br><span class="line">    å»ºè®®ï¼Œå¯¹æ¯ä¸ª<span class="keyword">SELECT</span>æŸ¥è¯¢åŠ ä¸Šå°æ‹¬å·åŒ…è£¹ã€‚</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> æ’åºæ—¶ï¼Œéœ€åŠ ä¸Š <span class="keyword">LIMIT</span> è¿›è¡Œç»“åˆã€‚</span><br><span class="line">    éœ€è¦å„<span class="keyword">select</span>æŸ¥è¯¢çš„å­—æ®µæ•°é‡ä¸€æ ·ã€‚</span><br><span class="line">    æ¯ä¸ª<span class="keyword">select</span>æŸ¥è¯¢çš„å­—æ®µåˆ—è¡¨(æ•°é‡ã€ç±»å‹)åº”ä¸€è‡´ï¼Œå› ä¸ºç»“æœä¸­çš„å­—æ®µåä»¥ç¬¬ä¸€æ¡<span class="keyword">select</span>è¯­å¥ä¸ºå‡†ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å­æŸ¥è¯¢ */</span> <span class="comment">------------------</span></span><br><span class="line">    - å­æŸ¥è¯¢éœ€ç”¨æ‹¬å·åŒ…è£¹ã€‚</span><br><span class="line"><span class="comment">-- fromå‹</span></span><br><span class="line">    <span class="keyword">from</span>åè¦æ±‚æ˜¯ä¸€ä¸ªè¡¨ï¼Œå¿…é¡»ç»™å­æŸ¥è¯¢ç»“æœå–ä¸ªåˆ«åã€‚</span><br><span class="line">    - ç®€åŒ–æ¯ä¸ªæŸ¥è¯¢å†…çš„æ¡ä»¶ã€‚</span><br><span class="line">    - <span class="keyword">from</span>å‹éœ€å°†ç»“æœç”Ÿæˆä¸€ä¸ªä¸´æ—¶è¡¨æ ¼ï¼Œå¯ç”¨ä»¥åŸè¡¨çš„é”å®šçš„é‡Šæ”¾ã€‚</span><br><span class="line">    - å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªè¡¨ï¼Œè¡¨å‹å­æŸ¥è¯¢ã€‚</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> tb <span class="keyword">where</span> <span class="keyword">id</span>&gt;<span class="number">0</span>) <span class="keyword">as</span> subfrom <span class="keyword">where</span> <span class="keyword">id</span>&gt;<span class="number">1</span>;</span><br><span class="line"><span class="comment">-- whereå‹</span></span><br><span class="line">    - å­æŸ¥è¯¢è¿”å›ä¸€ä¸ªå€¼ï¼Œæ ‡é‡å­æŸ¥è¯¢ã€‚</span><br><span class="line">    - ä¸éœ€è¦ç»™å­æŸ¥è¯¢å–åˆ«åã€‚</span><br><span class="line">    - whereå­æŸ¥è¯¢å†…çš„è¡¨ï¼Œä¸èƒ½ç›´æ¥ç”¨ä»¥æ›´æ–°ã€‚</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> tb <span class="keyword">where</span> money = (<span class="keyword">select</span> <span class="keyword">max</span>(money) <span class="keyword">from</span> tb);</span><br><span class="line">    <span class="comment">-- åˆ—å­æŸ¥è¯¢</span></span><br><span class="line">        å¦‚æœå­æŸ¥è¯¢ç»“æœè¿”å›çš„æ˜¯ä¸€åˆ—ã€‚</span><br><span class="line">        ä½¿ç”¨ in æˆ– not in å®ŒæˆæŸ¥è¯¢</span><br><span class="line">        exists å’Œ not exists æ¡ä»¶</span><br><span class="line">            å¦‚æœå­æŸ¥è¯¢è¿”å›æ•°æ®ï¼Œåˆ™è¿”å›1æˆ–0ã€‚å¸¸ç”¨äºåˆ¤æ–­æ¡ä»¶ã€‚</span><br><span class="line">            <span class="keyword">select</span> column1 <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> * <span class="keyword">from</span> t2);</span><br><span class="line">    <span class="comment">-- è¡Œå­æŸ¥è¯¢</span></span><br><span class="line">        æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªè¡Œã€‚</span><br><span class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> t1 <span class="keyword">where</span> (<span class="keyword">id</span>, gender) <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">id</span>, gender <span class="keyword">from</span> t2);</span><br><span class="line">        è¡Œæ„é€ ç¬¦ï¼š(col1, col2, ...) æˆ– ROW(col1, col2, ...)</span><br><span class="line">        è¡Œæ„é€ ç¬¦é€šå¸¸ç”¨äºä¸å¯¹èƒ½è¿”å›ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šåˆ—çš„å­æŸ¥è¯¢è¿›è¡Œæ¯”è¾ƒã€‚</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- ç‰¹æ®Šè¿ç®—ç¬¦</span></span><br><span class="line">    != all()    ç›¸å½“äº not in</span><br><span class="line">    = some()    ç›¸å½“äº inã€‚any æ˜¯ some çš„åˆ«å</span><br><span class="line">    != some()   ä¸ç­‰åŒäº not inï¼Œä¸ç­‰äºå…¶ä¸­æŸä¸€ä¸ªã€‚</span><br><span class="line">    all, some å¯ä»¥é…åˆå…¶ä»–è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿æ¥æŸ¥è¯¢(join) */</span> <span class="comment">------------------</span></span><br><span class="line">    å°†å¤šä¸ªè¡¨çš„å­—æ®µè¿›è¡Œè¿æ¥ï¼Œå¯ä»¥æŒ‡å®šè¿æ¥æ¡ä»¶ã€‚</span><br><span class="line"><span class="comment">-- å†…è¿æ¥(inner join)</span></span><br><span class="line">    - é»˜è®¤å°±æ˜¯å†…è¿æ¥ï¼Œå¯çœç•¥innerã€‚</span><br><span class="line">    - åªæœ‰æ•°æ®å­˜åœ¨æ—¶æ‰èƒ½å‘é€è¿æ¥ã€‚å³è¿æ¥ç»“æœä¸èƒ½å‡ºç°ç©ºè¡Œã€‚</span><br><span class="line">    on è¡¨ç¤ºè¿æ¥æ¡ä»¶ã€‚å…¶æ¡ä»¶è¡¨è¾¾å¼ä¸whereç±»ä¼¼ã€‚ä¹Ÿå¯ä»¥çœç•¥æ¡ä»¶ï¼ˆè¡¨ç¤ºæ¡ä»¶æ°¸è¿œä¸ºçœŸï¼‰</span><br><span class="line">    ä¹Ÿå¯ç”¨whereè¡¨ç¤ºè¿æ¥æ¡ä»¶ã€‚</span><br><span class="line">    è¿˜æœ‰ using, ä½†éœ€å­—æ®µåç›¸åŒã€‚ using(å­—æ®µå)</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- äº¤å‰è¿æ¥ cross join</span></span><br><span class="line">        å³ï¼Œæ²¡æœ‰æ¡ä»¶çš„å†…è¿æ¥ã€‚</span><br><span class="line">        <span class="keyword">select</span> * <span class="keyword">from</span> tb1 <span class="keyword">cross</span> <span class="keyword">join</span> tb2;</span><br><span class="line"><span class="comment">-- å¤–è¿æ¥(outer join)</span></span><br><span class="line">    - å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‡ºç°åœ¨è¿æ¥ç»“æœä¸­ã€‚</span><br><span class="line">    <span class="comment">-- å·¦å¤–è¿æ¥ left join</span></span><br><span class="line">        å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå·¦è¡¨è®°å½•ä¼šå‡ºç°ï¼Œè€Œå³è¡¨ä¸ºnullå¡«å……</span><br><span class="line">    <span class="comment">-- å³å¤–è¿æ¥ right join</span></span><br><span class="line">        å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå³è¡¨è®°å½•ä¼šå‡ºç°ï¼Œè€Œå·¦è¡¨ä¸ºnullå¡«å……</span><br><span class="line"><span class="comment">-- è‡ªç„¶è¿æ¥(natural join)</span></span><br><span class="line">    è‡ªåŠ¨åˆ¤æ–­è¿æ¥æ¡ä»¶å®Œæˆè¿æ¥ã€‚</span><br><span class="line">    ç›¸å½“äºçœç•¥äº†usingï¼Œä¼šè‡ªåŠ¨æŸ¥æ‰¾ç›¸åŒå­—æ®µåã€‚</span><br><span class="line">    natural join</span><br><span class="line">    natural left join</span><br><span class="line">    natural right join</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> info.id, info.name, info.stu_num, extra_info.hobby, extra_info.sex <span class="keyword">from</span> info, extra_info <span class="keyword">where</span> info.stu_num = extra_info.stu_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¯¼å…¥å¯¼å‡º */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> <span class="keyword">outfile</span> æ–‡ä»¶åœ°å€ [æ§åˆ¶æ ¼å¼] <span class="keyword">from</span> è¡¨å;   <span class="comment">-- å¯¼å‡ºè¡¨æ•°æ®</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> [<span class="keyword">local</span>] <span class="keyword">infile</span> æ–‡ä»¶åœ°å€ [<span class="keyword">replace</span>|<span class="keyword">ignore</span>] <span class="keyword">into</span> <span class="keyword">table</span> è¡¨å [æ§åˆ¶æ ¼å¼]; <span class="comment">-- å¯¼å…¥æ•°æ®</span></span><br><span class="line">    ç”Ÿæˆçš„æ•°æ®é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯åˆ¶è¡¨ç¬¦</span><br><span class="line">    localæœªæŒ‡å®šï¼Œåˆ™æ•°æ®æ–‡ä»¶å¿…é¡»åœ¨æœåŠ¡å™¨ä¸Š</span><br><span class="line">    <span class="keyword">replace</span> å’Œ <span class="keyword">ignore</span> å…³é”®è¯æ§åˆ¶å¯¹ç°æœ‰çš„å”¯ä¸€é”®è®°å½•çš„é‡å¤çš„å¤„ç†</span><br><span class="line"><span class="comment">-- æ§åˆ¶æ ¼å¼</span></span><br><span class="line"><span class="keyword">fields</span>  æ§åˆ¶å­—æ®µæ ¼å¼</span><br><span class="line">é»˜è®¤ï¼š<span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span> <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">''</span> <span class="keyword">escaped</span> <span class="keyword">by</span> <span class="string">'\\'</span></span><br><span class="line">    <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'string'</span>  <span class="comment">-- ç»ˆæ­¢</span></span><br><span class="line">    <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">'char'</span>      <span class="comment">-- åŒ…è£¹</span></span><br><span class="line">    <span class="keyword">escaped</span> <span class="keyword">by</span> <span class="string">'char'</span>       <span class="comment">-- è½¬ä¹‰</span></span><br><span class="line">    <span class="comment">-- ç¤ºä¾‹ï¼š</span></span><br><span class="line">        <span class="keyword">SELECT</span> a,b,a+b <span class="keyword">INTO</span> <span class="keyword">OUTFILE</span> <span class="string">'/tmp/result.text'</span></span><br><span class="line">        <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span> <span class="keyword">OPTIONALLY</span> <span class="keyword">ENCLOSED</span> <span class="keyword">BY</span> <span class="string">'"'</span></span><br><span class="line">        <span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\n'</span></span><br><span class="line">        <span class="keyword">FROM</span> test_table;</span><br><span class="line">lines   æ§åˆ¶è¡Œæ ¼å¼</span><br><span class="line">é»˜è®¤ï¼šlines terminated by '\n'</span><br><span class="line">    terminated by 'string'  <span class="comment">-- ç»ˆæ­¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* INSERT */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="keyword">select</span>è¯­å¥è·å¾—çš„æ•°æ®å¯ä»¥ç”¨<span class="keyword">insert</span>æ’å…¥ã€‚</span><br><span class="line"></span><br><span class="line">å¯ä»¥çœç•¥å¯¹åˆ—çš„æŒ‡å®šï¼Œè¦æ±‚ <span class="keyword">values</span> () æ‹¬å·å†…ï¼Œæä¾›ç»™äº†æŒ‰ç…§åˆ—é¡ºåºå‡ºç°çš„æ‰€æœ‰å­—æ®µçš„å€¼ã€‚</span><br><span class="line">    æˆ–è€…ä½¿ç”¨<span class="keyword">set</span>è¯­æ³•ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_name <span class="keyword">SET</span> <span class="keyword">field</span>=<span class="keyword">value</span>,...ï¼›</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä¸€æ¬¡æ€§ä½¿ç”¨å¤šä¸ªå€¼ï¼Œé‡‡ç”¨(), (), ();çš„å½¢å¼ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_name <span class="keyword">VALUES</span> (), (), ();</span><br><span class="line"></span><br><span class="line">å¯ä»¥åœ¨åˆ—å€¼æŒ‡å®šæ—¶ï¼Œä½¿ç”¨è¡¨è¾¾å¼ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_name <span class="keyword">VALUES</span> (field_value, <span class="number">10</span>+<span class="number">10</span>, <span class="keyword">now</span>());</span><br><span class="line">å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šå€¼ DEFAULTï¼Œè¡¨ç¤ºè¯¥åˆ—ä½¿ç”¨é»˜è®¤å€¼ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_name <span class="keyword">VALUES</span> (field_value, <span class="keyword">DEFAULT</span>);</span><br><span class="line"></span><br><span class="line">å¯ä»¥é€šè¿‡ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœï¼Œä½œä¸ºéœ€è¦æ’å…¥çš„å€¼ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_name <span class="keyword">SELECT</span> ...;</span><br><span class="line"></span><br><span class="line">å¯ä»¥æŒ‡å®šåœ¨æ’å…¥çš„å€¼å‡ºç°ä¸»é”®ï¼ˆæˆ–å”¯ä¸€ç´¢å¼•ï¼‰å†²çªæ—¶ï¼Œæ›´æ–°å…¶ä»–éä¸»é”®åˆ—çš„ä¿¡æ¯ã€‚</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> tbl_name <span class="keyword">VALUES</span>/<span class="keyword">SET</span>/<span class="keyword">SELECT</span> <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> å­—æ®µ=å€¼, â€¦;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* DELETE */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tbl_name [<span class="keyword">WHERE</span> where_definition] [<span class="keyword">ORDER</span> <span class="keyword">BY</span> ...] [<span class="keyword">LIMIT</span> <span class="keyword">row_count</span>]</span><br><span class="line"></span><br><span class="line">æŒ‰ç…§æ¡ä»¶åˆ é™¤ã€‚<span class="keyword">where</span></span><br><span class="line"></span><br><span class="line">æŒ‡å®šåˆ é™¤çš„æœ€å¤šè®°å½•æ•°ã€‚<span class="keyword">limit</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥é€šè¿‡æ’åºæ¡ä»¶åˆ é™¤ã€‚<span class="keyword">order</span> <span class="keyword">by</span> + <span class="keyword">limit</span></span><br><span class="line"></span><br><span class="line">æ”¯æŒå¤šè¡¨åˆ é™¤ï¼Œä½¿ç”¨ç±»ä¼¼è¿æ¥è¯­æ³•ã€‚</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> éœ€è¦åˆ é™¤æ•°æ®å¤šè¡¨<span class="number">1</span>ï¼Œè¡¨<span class="number">2</span> <span class="keyword">using</span> è¡¨è¿æ¥æ“ä½œ æ¡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">/* TRUNCATE */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> [<span class="keyword">TABLE</span>] tbl_name</span><br><span class="line">æ¸…ç©ºæ•°æ®</span><br><span class="line">åˆ é™¤é‡å»ºè¡¨</span><br><span class="line"></span><br><span class="line">åŒºåˆ«ï¼š</span><br><span class="line"><span class="number">1</span>ï¼Œ<span class="keyword">truncate</span> æ˜¯åˆ é™¤è¡¨å†åˆ›å»ºï¼Œ<span class="keyword">delete</span> æ˜¯é€æ¡åˆ é™¤</span><br><span class="line"><span class="number">2</span>ï¼Œ<span class="keyword">truncate</span> é‡ç½®auto_incrementçš„å€¼ã€‚è€Œ<span class="keyword">delete</span>ä¸ä¼š</span><br><span class="line"><span class="number">3</span>ï¼Œ<span class="keyword">truncate</span> ä¸çŸ¥é“åˆ é™¤äº†å‡ æ¡ï¼Œè€Œ<span class="keyword">delete</span>çŸ¥é“ã€‚</span><br><span class="line"><span class="number">4</span>ï¼Œå½“è¢«ç”¨äºå¸¦åˆ†åŒºçš„è¡¨æ—¶ï¼Œ<span class="keyword">truncate</span> ä¼šä¿ç•™åˆ†åŒº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¤‡ä»½ä¸è¿˜åŸ */</span> <span class="comment">------------------</span></span><br><span class="line">å¤‡ä»½ï¼Œå°†æ•°æ®çš„ç»“æ„ä¸è¡¨å†…æ•°æ®ä¿å­˜èµ·æ¥ã€‚</span><br><span class="line">åˆ©ç”¨ mysqldump æŒ‡ä»¤å®Œæˆã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯¼å‡º</span></span><br><span class="line">mysqldump [options] db_name [<span class="keyword">tables</span>]</span><br><span class="line">mysqldump [options] <span class="comment">---database DB1 [DB2 DB3...]</span></span><br><span class="line">mysqldump [options] <span class="comment">--all--database</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> å¯¼å‡ºä¸€å¼ è¡¨</span><br><span class="line">ã€€ã€€mysqldump -uç”¨æˆ·å -på¯†ç  åº“å è¡¨å &gt; æ–‡ä»¶å(D:/a.sql)</span><br><span class="line"><span class="number">2.</span> å¯¼å‡ºå¤šå¼ è¡¨</span><br><span class="line">ã€€ã€€mysqldump -uç”¨æˆ·å -på¯†ç  åº“å è¡¨<span class="number">1</span> è¡¨<span class="number">2</span> è¡¨<span class="number">3</span> &gt; æ–‡ä»¶å(D:/a.sql)</span><br><span class="line"><span class="number">3.</span> å¯¼å‡ºæ‰€æœ‰è¡¨</span><br><span class="line">ã€€ã€€mysqldump -uç”¨æˆ·å -på¯†ç  åº“å &gt; æ–‡ä»¶å(D:/a.sql)</span><br><span class="line"><span class="number">4.</span> å¯¼å‡ºä¸€ä¸ªåº“</span><br><span class="line">ã€€ã€€mysqldump -uç”¨æˆ·å -på¯†ç  <span class="comment">--lock-all-tables --database åº“å &gt; æ–‡ä»¶å(D:/a.sql)</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥-wæºå¸¦<span class="keyword">WHERE</span>æ¡ä»¶</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯¼å…¥</span></span><br><span class="line"><span class="number">1.</span> åœ¨ç™»å½•mysqlçš„æƒ…å†µä¸‹ï¼š</span><br><span class="line">ã€€ã€€<span class="keyword">source</span>  å¤‡ä»½æ–‡ä»¶</span><br><span class="line"><span class="number">2.</span> åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹</span><br><span class="line">ã€€ã€€mysql -uç”¨æˆ·å -på¯†ç  åº“å &lt; å¤‡ä»½æ–‡ä»¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* è§†å›¾ */</span> <span class="comment">------------------</span></span><br><span class="line">ä»€ä¹ˆæ˜¯è§†å›¾ï¼š</span><br><span class="line">    è§†å›¾æ˜¯ä¸€ä¸ªè™šæ‹Ÿè¡¨ï¼Œå…¶å†…å®¹ç”±æŸ¥è¯¢å®šä¹‰ã€‚åŒçœŸå®çš„è¡¨ä¸€æ ·ï¼Œè§†å›¾åŒ…å«ä¸€ç³»åˆ—å¸¦æœ‰åç§°çš„åˆ—å’Œè¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­ä»¥å­˜å‚¨çš„æ•°æ®å€¼é›†å½¢å¼å­˜åœ¨ã€‚è¡Œå’Œåˆ—æ•°æ®æ¥è‡ªç”±å®šä¹‰è§†å›¾çš„æŸ¥è¯¢æ‰€å¼•ç”¨çš„è¡¨ï¼Œå¹¶ä¸”åœ¨å¼•ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆã€‚</span><br><span class="line">    è§†å›¾å…·æœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼Œä½†ä¸å­˜åœ¨æ•°æ®æ–‡ä»¶ã€‚</span><br><span class="line">    å¯¹å…¶ä¸­æ‰€å¼•ç”¨çš„åŸºç¡€è¡¨æ¥è¯´ï¼Œè§†å›¾çš„ä½œç”¨ç±»ä¼¼äºç­›é€‰ã€‚å®šä¹‰è§†å›¾çš„ç­›é€‰å¯ä»¥æ¥è‡ªå½“å‰æˆ–å…¶å®ƒæ•°æ®åº“çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ï¼Œæˆ–è€…å…¶å®ƒè§†å›¾ã€‚é€šè¿‡è§†å›¾è¿›è¡ŒæŸ¥è¯¢æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œé€šè¿‡å®ƒä»¬è¿›è¡Œæ•°æ®ä¿®æ”¹æ—¶çš„é™åˆ¶ä¹Ÿå¾ˆå°‘ã€‚</span><br><span class="line">    è§†å›¾æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æŸ¥è¯¢çš„<span class="keyword">sql</span>è¯­å¥ï¼Œå®ƒä¸»è¦å‡ºäºä¸¤ç§åŸå› ï¼šå®‰å…¨åŸå› ï¼Œè§†å›¾å¯ä»¥éšè—ä¸€äº›æ•°æ®ï¼Œå¦‚ï¼šç¤¾ä¼šä¿é™©åŸºé‡‘è¡¨ï¼Œå¯ä»¥ç”¨è§†å›¾åªæ˜¾ç¤ºå§“åï¼Œåœ°å€ï¼Œè€Œä¸æ˜¾ç¤ºç¤¾ä¼šä¿é™©å·å’Œå·¥èµ„æ•°ç­‰ï¼Œå¦ä¸€åŸå› æ˜¯å¯ä½¿å¤æ‚çš„æŸ¥è¯¢æ˜“äºç†è§£å’Œä½¿ç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºè§†å›¾</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> <span class="keyword">REPLACE</span>] [ALGORITHM = &#123;UNDEFINED | <span class="keyword">MERGE</span> | TEMPTABLE&#125;] <span class="keyword">VIEW</span> view_name [(column_list)] <span class="keyword">AS</span> select_statement</span><br><span class="line">    - è§†å›¾åå¿…é¡»å”¯ä¸€ï¼ŒåŒæ—¶ä¸èƒ½ä¸è¡¨é‡åã€‚</span><br><span class="line">    - è§†å›¾å¯ä»¥ä½¿ç”¨<span class="keyword">select</span>è¯­å¥æŸ¥è¯¢åˆ°çš„åˆ—åï¼Œä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šç›¸åº”çš„åˆ—åã€‚</span><br><span class="line">    - å¯ä»¥æŒ‡å®šè§†å›¾æ‰§è¡Œçš„ç®—æ³•ï¼Œé€šè¿‡ALGORITHMæŒ‡å®šã€‚</span><br><span class="line">    - column_listå¦‚æœå­˜åœ¨ï¼Œåˆ™æ•°ç›®å¿…é¡»ç­‰äº<span class="keyword">SELECT</span>è¯­å¥æ£€ç´¢çš„åˆ—æ•°</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹ç»“æ„</span></span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤è§†å›¾</span></span><br><span class="line">    - åˆ é™¤è§†å›¾åï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ã€‚</span><br><span class="line">    - å¯åŒæ—¶åˆ é™¤å¤šä¸ªè§†å›¾ã€‚</span><br><span class="line">    <span class="keyword">DROP</span> <span class="keyword">VIEW</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] view_name ...</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿®æ”¹è§†å›¾ç»“æ„</span></span><br><span class="line">    - ä¸€èˆ¬ä¸ä¿®æ”¹è§†å›¾ï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰çš„æ›´æ–°è§†å›¾éƒ½ä¼šæ˜ å°„åˆ°è¡¨ä¸Šã€‚</span><br><span class="line">    <span class="keyword">ALTER</span> <span class="keyword">VIEW</span> view_name [(column_list)] <span class="keyword">AS</span> select_statement</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è§†å›¾ä½œç”¨</span></span><br><span class="line">    <span class="number">1.</span> ç®€åŒ–ä¸šåŠ¡é€»è¾‘</span><br><span class="line">    <span class="number">2.</span> å¯¹å®¢æˆ·ç«¯éšè—çœŸå®çš„è¡¨ç»“æ„</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è§†å›¾ç®—æ³•(ALGORITHM)</span></span><br><span class="line">    <span class="keyword">MERGE</span>       åˆå¹¶</span><br><span class="line">        å°†è§†å›¾çš„æŸ¥è¯¢è¯­å¥ï¼Œä¸å¤–éƒ¨æŸ¥è¯¢éœ€è¦å…ˆåˆå¹¶å†æ‰§è¡Œï¼</span><br><span class="line">    TEMPTABLE   ä¸´æ—¶è¡¨</span><br><span class="line">        å°†è§†å›¾æ‰§è¡Œå®Œæ¯•åï¼Œå½¢æˆä¸´æ—¶è¡¨ï¼Œå†åšå¤–å±‚æŸ¥è¯¢ï¼</span><br><span class="line">    UNDEFINED   æœªå®šä¹‰(é»˜è®¤)ï¼ŒæŒ‡çš„æ˜¯MySQLè‡ªä¸»å»é€‰æ‹©ç›¸åº”çš„ç®—æ³•ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* äº‹åŠ¡(transaction) */</span> <span class="comment">------------------</span></span><br><span class="line">äº‹åŠ¡æ˜¯æŒ‡é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œç»„æˆè¿™ç»„æ“ä½œçš„å„ä¸ªå•å…ƒï¼Œè¦ä¸å…¨æˆåŠŸè¦ä¸å…¨å¤±è´¥ã€‚</span><br><span class="line">    - æ”¯æŒè¿ç»­<span class="keyword">SQL</span>çš„é›†ä½“æˆåŠŸæˆ–é›†ä½“æ’¤é”€ã€‚</span><br><span class="line">    - äº‹åŠ¡æ˜¯æ•°æ®åº“åœ¨æ•°æ®æ™šè‡ªä¹ æ–¹é¢çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</span><br><span class="line">    - éœ€è¦åˆ©ç”¨ <span class="keyword">InnoDB</span> æˆ– BDB å­˜å‚¨å¼•æ“ï¼Œå¯¹è‡ªåŠ¨æäº¤çš„ç‰¹æ€§æ”¯æŒå®Œæˆã€‚</span><br><span class="line">    - <span class="keyword">InnoDB</span>è¢«ç§°ä¸ºäº‹åŠ¡å®‰å…¨å‹å¼•æ“ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº‹åŠ¡å¼€å¯</span></span><br><span class="line">    <span class="keyword">START</span> <span class="keyword">TRANSACTION</span>; æˆ–è€… <span class="keyword">BEGIN</span>;</span><br><span class="line">    å¼€å¯äº‹åŠ¡åï¼Œæ‰€æœ‰è¢«æ‰§è¡Œçš„SQLè¯­å¥å‡è¢«è®¤ä½œå½“å‰äº‹åŠ¡å†…çš„SQLè¯­å¥ã€‚</span><br><span class="line"><span class="comment">-- äº‹åŠ¡æäº¤</span></span><br><span class="line">    <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="comment">-- äº‹åŠ¡å›æ»š</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span>;</span><br><span class="line">    å¦‚æœéƒ¨åˆ†æ“ä½œå‘ç”Ÿé—®é¢˜ï¼Œæ˜ å°„åˆ°äº‹åŠ¡å¼€å¯å‰ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº‹åŠ¡çš„ç‰¹æ€§</span></span><br><span class="line">    1. åŸå­æ€§ï¼ˆAtomicityï¼‰</span><br><span class="line">        äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆéƒ½å‘ç”Ÿï¼Œè¦ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</span><br><span class="line">    2. ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</span><br><span class="line">        äº‹åŠ¡å‰åæ•°æ®çš„å®Œæ•´æ€§å¿…é¡»ä¿æŒä¸€è‡´ã€‚</span><br><span class="line">        - äº‹åŠ¡å¼€å§‹å’Œç»“æŸæ—¶ï¼Œå¤–éƒ¨æ•°æ®ä¸€è‡´</span><br><span class="line">        - åœ¨æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œæ“ä½œæ˜¯è¿ç»­çš„</span><br><span class="line">    3. éš”ç¦»æ€§ï¼ˆIsolationï¼‰</span><br><span class="line">        å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸èƒ½è¢«å…¶å®ƒç”¨æˆ·çš„äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´çš„æ•°æ®è¦ç›¸äº’éš”ç¦»ã€‚</span><br><span class="line">    4. æŒä¹…æ€§ï¼ˆDurabilityï¼‰</span><br><span class="line">        ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤ï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº‹åŠ¡çš„å®ç°</span></span><br><span class="line">    1. è¦æ±‚æ˜¯äº‹åŠ¡æ”¯æŒçš„è¡¨ç±»å‹</span><br><span class="line">    2. æ‰§è¡Œä¸€ç»„ç›¸å…³çš„æ“ä½œå‰å¼€å¯äº‹åŠ¡</span><br><span class="line">    3. æ•´ç»„æ“ä½œå®Œæˆåï¼Œéƒ½æˆåŠŸï¼Œåˆ™æäº¤ï¼›å¦‚æœå­˜åœ¨å¤±è´¥ï¼Œé€‰æ‹©å›æ»šï¼Œåˆ™ä¼šå›åˆ°äº‹åŠ¡å¼€å§‹çš„å¤‡ä»½ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- äº‹åŠ¡çš„åŸç†</span></span><br><span class="line">    åˆ©ç”¨InnoDBçš„è‡ªåŠ¨æäº¤(autocommit)ç‰¹æ€§å®Œæˆã€‚</span><br><span class="line">    æ™®é€šçš„MySQLæ‰§è¡Œè¯­å¥åï¼Œå½“å‰çš„æ•°æ®æäº¤æ“ä½œå‡å¯è¢«å…¶ä»–å®¢æˆ·ç«¯å¯è§ã€‚</span><br><span class="line">    è€Œäº‹åŠ¡æ˜¯æš‚æ—¶å…³é—­â€œè‡ªåŠ¨æäº¤â€æœºåˆ¶ï¼Œéœ€è¦<span class="keyword">commit</span>æäº¤æŒä¹…åŒ–æ•°æ®æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ³¨æ„</span></span><br><span class="line">    <span class="number">1.</span> æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆ<span class="keyword">DDL</span>ï¼‰è¯­å¥ä¸èƒ½è¢«å›æ»šï¼Œæ¯”å¦‚åˆ›å»ºæˆ–å–æ¶ˆæ•°æ®åº“çš„è¯­å¥ï¼Œå’Œåˆ›å»ºã€å–æ¶ˆæˆ–æ›´æ”¹è¡¨æˆ–å­˜å‚¨çš„å­ç¨‹åºçš„è¯­å¥ã€‚</span><br><span class="line">    <span class="number">2.</span> äº‹åŠ¡ä¸èƒ½è¢«åµŒå¥—</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿å­˜ç‚¹</span></span><br><span class="line">    <span class="keyword">SAVEPOINT</span> ä¿å­˜ç‚¹åç§° <span class="comment">-- è®¾ç½®ä¸€ä¸ªäº‹åŠ¡ä¿å­˜ç‚¹</span></span><br><span class="line">    <span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> <span class="keyword">SAVEPOINT</span> ä¿å­˜ç‚¹åç§° <span class="comment">-- å›æ»šåˆ°ä¿å­˜ç‚¹</span></span><br><span class="line">    <span class="keyword">RELEASE</span> <span class="keyword">SAVEPOINT</span> ä¿å­˜ç‚¹åç§° <span class="comment">-- åˆ é™¤ä¿å­˜ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- InnoDBè‡ªåŠ¨æäº¤ç‰¹æ€§è®¾ç½®</span></span><br><span class="line">    <span class="keyword">SET</span> autocommit = <span class="number">0</span>|<span class="number">1</span>;   0è¡¨ç¤ºå…³é—­è‡ªåŠ¨æäº¤ï¼Œ1è¡¨ç¤ºå¼€å¯è‡ªåŠ¨æäº¤ã€‚</span><br><span class="line">    - å¦‚æœå…³é—­äº†ï¼Œé‚£æ™®é€šæ“ä½œçš„ç»“æœå¯¹å…¶ä»–å®¢æˆ·ç«¯ä¹Ÿä¸å¯è§ï¼Œéœ€è¦<span class="keyword">commit</span>æäº¤åæ‰èƒ½æŒä¹…åŒ–æ•°æ®æ“ä½œã€‚</span><br><span class="line">    - ä¹Ÿå¯ä»¥å…³é—­è‡ªåŠ¨æäº¤æ¥å¼€å¯äº‹åŠ¡ã€‚ä½†ä¸<span class="keyword">START</span> <span class="keyword">TRANSACTION</span>ä¸åŒçš„æ˜¯ï¼Œ</span><br><span class="line">        <span class="keyword">SET</span> autocommitæ˜¯æ°¸ä¹…æ”¹å˜æœåŠ¡å™¨çš„è®¾ç½®ï¼Œç›´åˆ°ä¸‹æ¬¡å†æ¬¡ä¿®æ”¹è¯¥è®¾ç½®ã€‚(é’ˆå¯¹å½“å‰è¿æ¥)</span><br><span class="line">        è€Œ<span class="keyword">START</span> <span class="keyword">TRANSACTION</span>è®°å½•å¼€å¯å‰çš„çŠ¶æ€ï¼Œè€Œä¸€æ—¦äº‹åŠ¡æäº¤æˆ–å›æ»šåå°±éœ€è¦å†æ¬¡å¼€å¯äº‹åŠ¡ã€‚(é’ˆå¯¹å½“å‰äº‹åŠ¡)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* é”è¡¨ */</span></span><br><span class="line">è¡¨é”å®šåªç”¨äºé˜²æ­¢å…¶å®ƒå®¢æˆ·ç«¯è¿›è¡Œä¸æ­£å½“åœ°è¯»å–å’Œå†™å…¥</span><br><span class="line">MyISAM æ”¯æŒè¡¨é”ï¼Œ<span class="keyword">InnoDB</span> æ”¯æŒè¡Œé”</span><br><span class="line"><span class="comment">-- é”å®š</span></span><br><span class="line">    <span class="keyword">LOCK</span> <span class="keyword">TABLES</span> tbl_name [<span class="keyword">AS</span> <span class="keyword">alias</span>]</span><br><span class="line"><span class="comment">-- è§£é”</span></span><br><span class="line">    <span class="keyword">UNLOCK</span> <span class="keyword">TABLES</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* è§¦å‘å™¨ */</span> <span class="comment">------------------</span></span><br><span class="line">    è§¦å‘ç¨‹åºæ˜¯ä¸è¡¨æœ‰å…³çš„å‘½åæ•°æ®åº“å¯¹è±¡ï¼Œå½“è¯¥è¡¨å‡ºç°ç‰¹å®šäº‹ä»¶æ—¶ï¼Œå°†æ¿€æ´»è¯¥å¯¹è±¡</span><br><span class="line">    ç›‘å¬ï¼šè®°å½•çš„å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºè§¦å‘å™¨</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> trigger_name trigger_time trigger_event <span class="keyword">ON</span> tbl_name <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> trigger_stmt</span><br><span class="line">    å‚æ•°ï¼š</span><br><span class="line">    trigger_timeæ˜¯è§¦å‘ç¨‹åºçš„åŠ¨ä½œæ—¶é—´ã€‚å®ƒå¯ä»¥æ˜¯ <span class="keyword">before</span> æˆ– <span class="keyword">after</span>ï¼Œä»¥æŒ‡æ˜è§¦å‘ç¨‹åºæ˜¯åœ¨æ¿€æ´»å®ƒçš„è¯­å¥ä¹‹å‰æˆ–ä¹‹åè§¦å‘ã€‚</span><br><span class="line">    trigger_eventæŒ‡æ˜äº†æ¿€æ´»è§¦å‘ç¨‹åºçš„è¯­å¥çš„ç±»å‹</span><br><span class="line">        <span class="keyword">INSERT</span>ï¼šå°†æ–°è¡Œæ’å…¥è¡¨æ—¶æ¿€æ´»è§¦å‘ç¨‹åº</span><br><span class="line">        <span class="keyword">UPDATE</span>ï¼šæ›´æ”¹æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘ç¨‹åº</span><br><span class="line">        <span class="keyword">DELETE</span>ï¼šä»è¡¨ä¸­åˆ é™¤æŸä¸€è¡Œæ—¶æ¿€æ´»è§¦å‘ç¨‹åº</span><br><span class="line">    tbl_nameï¼šç›‘å¬çš„è¡¨ï¼Œå¿…é¡»æ˜¯æ°¸ä¹…æ€§çš„è¡¨ï¼Œä¸èƒ½å°†è§¦å‘ç¨‹åºä¸<span class="keyword">TEMPORARY</span>è¡¨æˆ–è§†å›¾å…³è”èµ·æ¥ã€‚</span><br><span class="line">    trigger_stmtï¼šå½“è§¦å‘ç¨‹åºæ¿€æ´»æ—¶æ‰§è¡Œçš„è¯­å¥ã€‚æ‰§è¡Œå¤šä¸ªè¯­å¥ï¼Œå¯ä½¿ç”¨BEGIN...ENDå¤åˆè¯­å¥ç»“æ„</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> [schema_name.]trigger_name</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä½¿ç”¨<span class="keyword">old</span>å’Œ<span class="keyword">new</span>ä»£æ›¿æ—§çš„å’Œæ–°çš„æ•°æ®</span><br><span class="line">    æ›´æ–°æ“ä½œï¼Œæ›´æ–°å‰æ˜¯<span class="keyword">old</span>ï¼Œæ›´æ–°åæ˜¯new.</span><br><span class="line">    åˆ é™¤æ“ä½œï¼Œåªæœ‰old.</span><br><span class="line">    å¢åŠ æ“ä½œï¼Œåªæœ‰new.</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ³¨æ„</span></span><br><span class="line">    <span class="number">1.</span> å¯¹äºå…·æœ‰ç›¸åŒè§¦å‘ç¨‹åºåŠ¨ä½œæ—¶é—´å’Œäº‹ä»¶çš„ç»™å®šè¡¨ï¼Œä¸èƒ½æœ‰ä¸¤ä¸ªè§¦å‘ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å­—ç¬¦è¿æ¥å‡½æ•°</span></span><br><span class="line"><span class="keyword">concat</span>(str1,str2,...])</span><br><span class="line"><span class="keyword">concat_ws</span>(separator,str1,str2,...)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ†æ”¯è¯­å¥</span></span><br><span class="line"><span class="keyword">if</span> æ¡ä»¶ <span class="keyword">then</span></span><br><span class="line">    æ‰§è¡Œè¯­å¥</span><br><span class="line">elseif æ¡ä»¶ <span class="keyword">then</span></span><br><span class="line">    æ‰§è¡Œè¯­å¥</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    æ‰§è¡Œè¯­å¥</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿®æ”¹æœ€å¤–å±‚è¯­å¥ç»“æŸç¬¦</span></span><br><span class="line">delimiter è‡ªå®šä¹‰ç»“æŸç¬¦å·</span><br><span class="line">    SQLè¯­å¥</span><br><span class="line">è‡ªå®šä¹‰ç»“æŸç¬¦å·</span><br><span class="line"></span><br><span class="line">delimiter ;     <span class="comment">-- ä¿®æ”¹å›åŸæ¥çš„åˆ†å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¯­å¥å—åŒ…è£¹</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    è¯­å¥å—</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç‰¹æ®Šçš„æ‰§è¡Œ</span></span><br><span class="line"><span class="number">1.</span> åªè¦æ·»åŠ è®°å½•ï¼Œå°±ä¼šè§¦å‘ç¨‹åºã€‚</span><br><span class="line"><span class="number">2.</span> <span class="keyword">Insert</span> <span class="keyword">into</span> <span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span> è¯­æ³•ä¼šè§¦å‘ï¼š</span><br><span class="line">    å¦‚æœæ²¡æœ‰é‡å¤è®°å½•ï¼Œä¼šè§¦å‘ <span class="keyword">before</span> <span class="keyword">insert</span>, <span class="keyword">after</span> <span class="keyword">insert</span>;</span><br><span class="line">    å¦‚æœæœ‰é‡å¤è®°å½•å¹¶æ›´æ–°ï¼Œä¼šè§¦å‘ before <span class="keyword">insert</span>, <span class="keyword">before</span> <span class="keyword">update</span>, <span class="keyword">after</span> <span class="keyword">update</span>;</span><br><span class="line">    å¦‚æœæœ‰é‡å¤è®°å½•ä½†æ˜¯æ²¡æœ‰å‘ç”Ÿæ›´æ–°ï¼Œåˆ™è§¦å‘ before <span class="keyword">insert</span>, <span class="keyword">before</span> <span class="keyword">update</span></span><br><span class="line"><span class="number">3.</span> <span class="keyword">Replace</span> è¯­æ³• å¦‚æœæœ‰è®°å½•ï¼Œåˆ™æ‰§è¡Œ <span class="keyword">before</span> <span class="keyword">insert</span>, <span class="keyword">before</span> <span class="keyword">delete</span>, <span class="keyword">after</span> <span class="keyword">delete</span>, <span class="keyword">after</span> <span class="keyword">insert</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SQLç¼–ç¨‹ */</span> <span class="comment">------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--// å±€éƒ¨å˜é‡ ----------</span></span><br><span class="line"><span class="comment">-- å˜é‡å£°æ˜</span></span><br><span class="line">    <span class="keyword">declare</span> var_name[,...] <span class="keyword">type</span> [<span class="keyword">default</span> <span class="keyword">value</span>]</span><br><span class="line">    è¿™ä¸ªè¯­å¥è¢«ç”¨æ¥å£°æ˜å±€éƒ¨å˜é‡ã€‚è¦ç»™å˜é‡æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¯·åŒ…å«ä¸€ä¸ª<span class="keyword">default</span>å­å¥ã€‚å€¼å¯ä»¥è¢«æŒ‡å®šä¸ºä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸éœ€è¦ä¸ºä¸€ä¸ªå¸¸æ•°ã€‚å¦‚æœæ²¡æœ‰<span class="keyword">default</span>å­å¥ï¼Œåˆå§‹å€¼ä¸º<span class="literal">null</span>ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- èµ‹å€¼</span></span><br><span class="line">    ä½¿ç”¨ <span class="keyword">set</span> å’Œ <span class="keyword">select</span> <span class="keyword">into</span> è¯­å¥ä¸ºå˜é‡èµ‹å€¼ã€‚</span><br><span class="line"></span><br><span class="line">    - æ³¨æ„ï¼šåœ¨å‡½æ•°å†…æ˜¯å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ï¼ˆç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--// å…¨å±€å˜é‡ ----------</span></span><br><span class="line"><span class="comment">-- å®šä¹‰ã€èµ‹å€¼</span></span><br><span class="line"><span class="keyword">set</span> è¯­å¥å¯ä»¥å®šä¹‰å¹¶ä¸ºå˜é‡èµ‹å€¼ã€‚</span><br><span class="line"><span class="keyword">set</span> @<span class="keyword">var</span> = <span class="keyword">value</span>;</span><br><span class="line">ä¹Ÿå¯ä»¥ä½¿ç”¨<span class="keyword">select</span> <span class="keyword">into</span>è¯­å¥ä¸ºå˜é‡åˆå§‹åŒ–å¹¶èµ‹å€¼ã€‚è¿™æ ·è¦æ±‚<span class="keyword">select</span>è¯­å¥åªèƒ½è¿”å›ä¸€è¡Œï¼Œä½†æ˜¯å¯ä»¥æ˜¯å¤šä¸ªå­—æ®µï¼Œå°±æ„å‘³ç€åŒæ—¶ä¸ºå¤šä¸ªå˜é‡è¿›è¡Œèµ‹å€¼ï¼Œå˜é‡çš„æ•°é‡éœ€è¦ä¸æŸ¥è¯¢çš„åˆ—æ•°ä¸€è‡´ã€‚</span><br><span class="line">è¿˜å¯ä»¥æŠŠèµ‹å€¼è¯­å¥çœ‹ä½œä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé€šè¿‡<span class="keyword">select</span>æ‰§è¡Œå®Œæˆã€‚æ­¤æ—¶ä¸ºäº†é¿å…=è¢«å½“ä½œå…³ç³»è¿ç®—ç¬¦çœ‹å¾…ï¼Œä½¿ç”¨:=ä»£æ›¿ã€‚ï¼ˆ<span class="keyword">set</span>è¯­å¥å¯ä»¥ä½¿ç”¨= å’Œ :=ï¼‰ã€‚</span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">var</span>:=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">select</span> @v1:=<span class="keyword">id</span>, @v2=<span class="keyword">name</span> <span class="keyword">from</span> t1 <span class="keyword">limit</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tbl_name <span class="keyword">where</span> @<span class="keyword">var</span>:=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">into</span> å¯ä»¥å°†è¡¨ä¸­æŸ¥è¯¢è·å¾—çš„æ•°æ®èµ‹ç»™å˜é‡ã€‚</span><br><span class="line">    -| <span class="keyword">select</span> <span class="keyword">max</span>(height) <span class="keyword">into</span> @max_height <span class="keyword">from</span> tb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è‡ªå®šä¹‰å˜é‡å</span></span><br><span class="line">ä¸ºäº†é¿å…<span class="keyword">select</span>è¯­å¥ä¸­ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„å˜é‡ä¸ç³»ç»Ÿæ ‡è¯†ç¬¦ï¼ˆé€šå¸¸æ˜¯å­—æ®µåï¼‰å†²çªï¼Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡åœ¨å˜é‡åå‰ä½¿ç”¨@ä½œä¸ºå¼€å§‹ç¬¦å·ã€‚</span><br><span class="line">@<span class="keyword">var</span>=<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    - å˜é‡è¢«å®šä¹‰åï¼Œåœ¨æ•´ä¸ªä¼šè¯å‘¨æœŸéƒ½æœ‰æ•ˆï¼ˆç™»å½•åˆ°é€€å‡ºï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--// æ§åˆ¶ç»“æ„ ----------</span></span><br><span class="line"><span class="comment">-- ifè¯­å¥</span></span><br><span class="line">if search_condition then</span><br><span class="line">    statement_list   </span><br><span class="line">[elseif search_condition then</span><br><span class="line">    statement_list]</span><br><span class="line">...</span><br><span class="line">[else</span><br><span class="line">    statement_list]</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- caseè¯­å¥</span></span><br><span class="line">CASE value WHEN [compare-value] THEN result</span><br><span class="line">[WHEN [compare-value] THEN result ...]</span><br><span class="line">[ELSE result]</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- whileå¾ªç¯</span></span><br><span class="line">[begin_label:] <span class="keyword">while</span> search_condition <span class="keyword">do</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span> [end_label];</span><br><span class="line"></span><br><span class="line">- å¦‚æœéœ€è¦åœ¨å¾ªç¯å†…æå‰ç»ˆæ­¢ whileå¾ªç¯ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ ‡ç­¾ï¼›æ ‡ç­¾éœ€è¦æˆå¯¹å‡ºç°ã€‚</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- é€€å‡ºå¾ªç¯</span></span><br><span class="line">        é€€å‡ºæ•´ä¸ªå¾ªç¯ leave</span><br><span class="line">        é€€å‡ºå½“å‰å¾ªç¯ iterate</span><br><span class="line">        é€šè¿‡é€€å‡ºçš„æ ‡ç­¾å†³å®šé€€å‡ºå“ªä¸ªå¾ªç¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--// å†…ç½®å‡½æ•° ----------</span></span><br><span class="line"><span class="comment">-- æ•°å€¼å‡½æ•°</span></span><br><span class="line">abs(x)          <span class="comment">-- ç»å¯¹å€¼ abs(-10.9) = 10</span></span><br><span class="line">format(x, d)    <span class="comment">-- æ ¼å¼åŒ–åƒåˆ†ä½æ•°å€¼ format(1234567.456, 2) = 1,234,567.46</span></span><br><span class="line">ceil(x)         <span class="comment">-- å‘ä¸Šå–æ•´ ceil(10.1) = 11</span></span><br><span class="line">floor(x)        <span class="comment">-- å‘ä¸‹å–æ•´ floor (10.1) = 10</span></span><br><span class="line">round(x)        <span class="comment">-- å››èˆäº”å…¥å»æ•´</span></span><br><span class="line">mod(m, n)       <span class="comment">-- m%n m mod n æ±‚ä½™ 10%3=1</span></span><br><span class="line">pi()            <span class="comment">-- è·å¾—åœ†å‘¨ç‡</span></span><br><span class="line">pow(m, n)       <span class="comment">-- m^n</span></span><br><span class="line">sqrt(x)         <span class="comment">-- ç®—æœ¯å¹³æ–¹æ ¹</span></span><br><span class="line">rand()          <span class="comment">-- éšæœºæ•°</span></span><br><span class="line"><span class="keyword">truncate</span>(x, d)  <span class="comment">-- æˆªå–dä½å°æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ—¶é—´æ—¥æœŸå‡½æ•°</span></span><br><span class="line"><span class="keyword">now</span>(), <span class="keyword">current_timestamp</span>();     <span class="comment">-- å½“å‰æ—¥æœŸæ—¶é—´</span></span><br><span class="line">current_date();                 <span class="comment">-- å½“å‰æ—¥æœŸ</span></span><br><span class="line">current_time();                 <span class="comment">-- å½“å‰æ—¶é—´</span></span><br><span class="line">date('yyyy-mm-dd hh:ii:ss');    <span class="comment">-- è·å–æ—¥æœŸéƒ¨åˆ†</span></span><br><span class="line">time('yyyy-mm-dd hh:ii:ss');    <span class="comment">-- è·å–æ—¶é—´éƒ¨åˆ†</span></span><br><span class="line">date_format('yyyy-mm-dd hh:ii:ss', '%d %y %a %d %m %b %j'); <span class="comment">-- æ ¼å¼åŒ–æ—¶é—´</span></span><br><span class="line">unix_timestamp();               <span class="comment">-- è·å¾—unixæ—¶é—´æˆ³</span></span><br><span class="line">from_unixtime();                <span class="comment">-- ä»æ—¶é—´æˆ³è·å¾—æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å­—ç¬¦ä¸²å‡½æ•°</span></span><br><span class="line">length(string)          <span class="comment">-- stringé•¿åº¦ï¼Œå­—èŠ‚</span></span><br><span class="line">char_length(string)     <span class="comment">-- stringçš„å­—ç¬¦ä¸ªæ•°</span></span><br><span class="line">substring(str, position [,length])      <span class="comment">-- ä»strçš„positionå¼€å§‹,å–lengthä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">replace</span>(<span class="keyword">str</span> ,search_str ,replace_str)   <span class="comment">-- åœ¨strä¸­ç”¨replace_stræ›¿æ¢search_str</span></span><br><span class="line"><span class="keyword">instr</span>(<span class="keyword">string</span> ,<span class="keyword">substring</span>)    <span class="comment">-- è¿”å›substringé¦–æ¬¡åœ¨stringä¸­å‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">concat</span>(<span class="keyword">string</span> [,...])   <span class="comment">-- è¿æ¥å­—ä¸²</span></span><br><span class="line"><span class="keyword">charset</span>(<span class="keyword">str</span>)            <span class="comment">-- è¿”å›å­—ä¸²å­—ç¬¦é›†</span></span><br><span class="line"><span class="keyword">lcase</span>(<span class="keyword">string</span>)           <span class="comment">-- è½¬æ¢æˆå°å†™</span></span><br><span class="line"><span class="keyword">left</span>(<span class="keyword">string</span>, <span class="keyword">length</span>)    <span class="comment">-- ä»string2ä¸­çš„å·¦è¾¹èµ·å–lengthä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">load_file</span>(file_name)    <span class="comment">-- ä»æ–‡ä»¶è¯»å–å†…å®¹</span></span><br><span class="line"><span class="keyword">locate</span>(<span class="keyword">substring</span>, <span class="keyword">string</span> [,start_position]) <span class="comment">-- åŒinstr,ä½†å¯æŒ‡å®šå¼€å§‹ä½ç½®</span></span><br><span class="line"><span class="keyword">lpad</span>(<span class="keyword">string</span>, <span class="keyword">length</span>, <span class="keyword">pad</span>)   <span class="comment">-- é‡å¤ç”¨padåŠ åœ¨stringå¼€å¤´,ç›´åˆ°å­—ä¸²é•¿åº¦ä¸ºlength</span></span><br><span class="line"><span class="keyword">ltrim</span>(<span class="keyword">string</span>)           <span class="comment">-- å»é™¤å‰ç«¯ç©ºæ ¼</span></span><br><span class="line"><span class="keyword">repeat</span>(<span class="keyword">string</span>, <span class="keyword">count</span>)   <span class="comment">-- é‡å¤countæ¬¡</span></span><br><span class="line">rpad(<span class="keyword">string</span>, <span class="keyword">length</span>, <span class="keyword">pad</span>)   <span class="comment">--åœ¨stråç”¨padè¡¥å……,ç›´åˆ°é•¿åº¦ä¸ºlength</span></span><br><span class="line"><span class="keyword">rtrim</span>(<span class="keyword">string</span>)           <span class="comment">-- å»é™¤åç«¯ç©ºæ ¼</span></span><br><span class="line"><span class="keyword">strcmp</span>(string1 ,string2)    <span class="comment">-- é€å­—ç¬¦æ¯”è¾ƒä¸¤å­—ä¸²å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æµç¨‹å‡½æ•°</span></span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> [condition] <span class="keyword">then</span> <span class="keyword">result</span> [<span class="keyword">when</span> [condition] <span class="keyword">then</span> <span class="keyword">result</span> ...] [<span class="keyword">else</span> <span class="keyword">result</span>] <span class="keyword">end</span>   å¤šåˆ†æ”¯</span><br><span class="line"><span class="keyword">if</span>(expr1,expr2,expr3)  åŒåˆ†æ”¯ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- èšåˆå‡½æ•°</span></span><br><span class="line"><span class="keyword">count</span>()</span><br><span class="line"><span class="keyword">sum</span>();</span><br><span class="line">max();</span><br><span class="line">min();</span><br><span class="line">avg();</span><br><span class="line">group_concat()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…¶ä»–å¸¸ç”¨å‡½æ•°</span></span><br><span class="line">md5();</span><br><span class="line">default();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--// å­˜å‚¨å‡½æ•°ï¼Œè‡ªå®šä¹‰å‡½æ•° ----------</span></span><br><span class="line"><span class="comment">-- æ–°å»º</span></span><br><span class="line">    <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> function_name (å‚æ•°åˆ—è¡¨) <span class="keyword">RETURNS</span> è¿”å›å€¼ç±»å‹</span><br><span class="line">        å‡½æ•°ä½“</span><br><span class="line"></span><br><span class="line">    - å‡½æ•°åï¼Œåº”è¯¥åˆæ³•çš„æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”ä¸åº”è¯¥ä¸å·²æœ‰çš„å…³é”®å­—å†²çªã€‚</span><br><span class="line">    - ä¸€ä¸ªå‡½æ•°åº”è¯¥å±äºæŸä¸ªæ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨db_name.funciton_nameçš„å½¢å¼æ‰§è¡Œå½“å‰å‡½æ•°æ‰€å±æ•°æ®åº“ï¼Œå¦åˆ™ä¸ºå½“å‰æ•°æ®åº“ã€‚</span><br><span class="line">    - å‚æ•°éƒ¨åˆ†ï¼Œç”±<span class="string">"å‚æ•°å"</span>å’Œ<span class="string">"å‚æ•°ç±»å‹"</span>ç»„æˆã€‚å¤šä¸ªå‚æ•°ç”¨é€—å·éš”å¼€ã€‚</span><br><span class="line">    - å‡½æ•°ä½“ç”±å¤šæ¡å¯ç”¨çš„mysqlè¯­å¥ï¼Œæµç¨‹æ§åˆ¶ï¼Œå˜é‡å£°æ˜ç­‰è¯­å¥æ„æˆã€‚</span><br><span class="line">    - å¤šæ¡è¯­å¥åº”è¯¥ä½¿ç”¨ begin...end è¯­å¥å—åŒ…å«ã€‚</span><br><span class="line">    - ä¸€å®šè¦æœ‰ <span class="keyword">return</span> è¿”å›å€¼è¯­å¥ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤</span></span><br><span class="line">    <span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] function_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹</span></span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">'partten'</span></span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> function_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">ALTER</span> <span class="keyword">FUNCTION</span> function_name å‡½æ•°é€‰é¡¹</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--// å­˜å‚¨è¿‡ç¨‹ï¼Œè‡ªå®šä¹‰åŠŸèƒ½ ----------</span></span><br><span class="line"><span class="comment">-- å®šä¹‰</span></span><br><span class="line">å­˜å‚¨å­˜å‚¨è¿‡ç¨‹ æ˜¯ä¸€æ®µä»£ç ï¼ˆè¿‡ç¨‹ï¼‰ï¼Œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„<span class="keyword">sql</span>ç»„æˆã€‚</span><br><span class="line">ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹é€šå¸¸ç”¨äºå®Œæˆä¸€æ®µä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚æŠ¥åï¼Œäº¤ç­è´¹ï¼Œè®¢å•å…¥åº“ç­‰ã€‚</span><br><span class="line">è€Œä¸€ä¸ªå‡½æ•°é€šå¸¸ä¸“æ³¨ä¸æŸä¸ªåŠŸèƒ½ï¼Œè§†ä¸ºå…¶ä»–ç¨‹åºæœåŠ¡çš„ï¼Œéœ€è¦åœ¨å…¶ä»–è¯­å¥ä¸­è°ƒç”¨å‡½æ•°æ‰å¯ä»¥ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸èƒ½è¢«å…¶ä»–è°ƒç”¨ï¼Œæ˜¯è‡ªå·±æ‰§è¡Œ é€šè¿‡<span class="keyword">call</span>æ‰§è¡Œã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»º</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_name (å‚æ•°åˆ—è¡¨)</span><br><span class="line">    è¿‡ç¨‹ä½“</span><br><span class="line"></span><br><span class="line">å‚æ•°åˆ—è¡¨ï¼šä¸åŒäºå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œéœ€è¦æŒ‡æ˜å‚æ•°ç±»å‹</span><br><span class="line"><span class="keyword">IN</span>ï¼Œè¡¨ç¤ºè¾“å…¥å‹</span><br><span class="line"><span class="keyword">OUT</span>ï¼Œè¡¨ç¤ºè¾“å‡ºå‹</span><br><span class="line">INOUTï¼Œè¡¨ç¤ºæ··åˆå‹</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å­˜å‚¨è¿‡ç¨‹ */</span> <span class="comment">------------------</span></span><br><span class="line">å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€æ®µå¯æ‰§è¡Œæ€§ä»£ç çš„é›†åˆã€‚ç›¸æ¯”å‡½æ•°ï¼Œæ›´åå‘äºä¸šåŠ¡é€»è¾‘ã€‚</span><br><span class="line">è°ƒç”¨ï¼š<span class="keyword">CALL</span> è¿‡ç¨‹å</span><br><span class="line"><span class="comment">-- æ³¨æ„</span></span><br><span class="line">- æ²¡æœ‰è¿”å›å€¼ã€‚</span><br><span class="line">- åªèƒ½å•ç‹¬è°ƒç”¨ï¼Œä¸å¯å¤¹æ‚åœ¨å…¶ä»–è¯­å¥ä¸­</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å‚æ•°</span></span><br><span class="line"><span class="keyword">IN</span>|<span class="keyword">OUT</span>|INOUT å‚æ•°å æ•°æ®ç±»å‹</span><br><span class="line"><span class="keyword">IN</span>      è¾“å…¥ï¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®è¾“å…¥åˆ°è¿‡ç¨‹ä½“å†…éƒ¨çš„å‚æ•°</span><br><span class="line"><span class="keyword">OUT</span>     è¾“å‡ºï¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå°†è¿‡ç¨‹ä½“å¤„ç†å®Œçš„ç»“æœè¿”å›åˆ°å®¢æˆ·ç«¯</span><br><span class="line">INOUT   è¾“å…¥è¾“å‡ºï¼šæ—¢å¯è¾“å…¥ï¼Œä¹Ÿå¯è¾“å‡º</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¯­æ³•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> è¿‡ç¨‹å (å‚æ•°åˆ—è¡¨)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    è¿‡ç¨‹ä½“</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ç”¨æˆ·å’Œæƒé™ç®¡ç† */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="comment">-- rootå¯†ç é‡ç½®</span></span><br><span class="line"><span class="number">1.</span> åœæ­¢MySQLæœåŠ¡</span><br><span class="line"><span class="number">2.</span>  [Linux] /usr/<span class="keyword">local</span>/mysql/<span class="keyword">bin</span>/safe_mysqld <span class="comment">--skip-grant-tables &amp;</span></span><br><span class="line">    [Windows] mysqld <span class="comment">--skip-grant-tables</span></span><br><span class="line"><span class="number">3.</span> <span class="keyword">use</span> mysql;</span><br><span class="line">4. <span class="keyword">UPDATE</span> <span class="string">`user`</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="keyword">PASSWORD</span>(<span class="string">"å¯†ç "</span>) <span class="keyword">WHERE</span> <span class="string">`user`</span> = <span class="string">"root"</span>;</span><br><span class="line">5. <span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·ä¿¡æ¯è¡¨ï¼šmysql.user</span><br><span class="line"><span class="comment">-- åˆ·æ–°æƒé™</span></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br><span class="line"><span class="comment">-- å¢åŠ ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> ç”¨æˆ·å <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> [<span class="keyword">PASSWORD</span>] å¯†ç (å­—ç¬¦ä¸²)</span><br><span class="line">    - å¿…é¡»æ‹¥æœ‰mysqlæ•°æ®åº“çš„å…¨å±€<span class="keyword">CREATE</span> <span class="keyword">USER</span>æƒé™ï¼Œæˆ–æ‹¥æœ‰<span class="keyword">INSERT</span>æƒé™ã€‚</span><br><span class="line">    - åªèƒ½åˆ›å»ºç”¨æˆ·ï¼Œä¸èƒ½èµ‹äºˆæƒé™ã€‚</span><br><span class="line">    - ç”¨æˆ·åï¼Œæ³¨æ„å¼•å·ï¼šå¦‚ <span class="string">'user_name'</span>@<span class="string">'192.168.1.1'</span></span><br><span class="line">    - å¯†ç ä¹Ÿéœ€å¼•å·ï¼Œçº¯æ•°å­—å¯†ç ä¹Ÿè¦åŠ å¼•å·</span><br><span class="line">    - è¦åœ¨çº¯æ–‡æœ¬ä¸­æŒ‡å®šå¯†ç ï¼Œéœ€å¿½ç•¥<span class="keyword">PASSWORD</span>å…³é”®è¯ã€‚è¦æŠŠå¯†ç æŒ‡å®šä¸ºç”±<span class="keyword">PASSWORD</span>()å‡½æ•°è¿”å›çš„æ··ç¼–å€¼ï¼Œéœ€åŒ…å«å…³é”®å­—<span class="keyword">PASSWORD</span></span><br><span class="line"><span class="comment">-- é‡å‘½åç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RENAME</span> <span class="keyword">USER</span> old_user <span class="keyword">TO</span> new_user</span><br><span class="line"><span class="comment">-- è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> = <span class="keyword">PASSWORD</span>(<span class="string">'å¯†ç '</span>)  <span class="comment">-- ä¸ºå½“å‰ç”¨æˆ·è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> ç”¨æˆ·å = <span class="keyword">PASSWORD</span>(<span class="string">'å¯†ç '</span>) <span class="comment">-- ä¸ºæŒ‡å®šç”¨æˆ·è®¾ç½®å¯†ç </span></span><br><span class="line"><span class="comment">-- åˆ é™¤ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> ç”¨æˆ·å</span><br><span class="line"><span class="comment">-- åˆ†é…æƒé™/æ·»åŠ ç”¨æˆ·</span></span><br><span class="line"><span class="keyword">GRANT</span> æƒé™åˆ—è¡¨ <span class="keyword">ON</span> è¡¨å <span class="keyword">TO</span> ç”¨æˆ·å [<span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> [<span class="keyword">PASSWORD</span>] <span class="string">'password'</span>]</span><br><span class="line">    - <span class="keyword">all</span> <span class="keyword">privileges</span> è¡¨ç¤ºæ‰€æœ‰æƒé™</span><br><span class="line">    - *.* è¡¨ç¤ºæ‰€æœ‰åº“çš„æ‰€æœ‰è¡¨</span><br><span class="line">    - åº“å.è¡¨å è¡¨ç¤ºæŸåº“ä¸‹é¢çš„æŸè¡¨</span><br><span class="line">    <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> <span class="string">`pms`</span>.* <span class="keyword">TO</span> <span class="string">'pms'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'pms0817'</span>;</span><br><span class="line"><span class="comment">-- æŸ¥çœ‹æƒé™</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> ç”¨æˆ·å</span><br><span class="line">    <span class="comment">-- æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span></span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">GRANTS</span>; æˆ– <span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="keyword">CURRENT_USER</span>; æˆ– <span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="keyword">CURRENT_USER</span>();</span><br><span class="line"><span class="comment">-- æ’¤æ¶ˆæƒé™</span></span><br><span class="line"><span class="keyword">REVOKE</span> æƒé™åˆ—è¡¨ <span class="keyword">ON</span> è¡¨å <span class="keyword">FROM</span> ç”¨æˆ·å</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span>, <span class="keyword">GRANT</span> <span class="keyword">OPTION</span> <span class="keyword">FROM</span> ç”¨æˆ·å   <span class="comment">-- æ’¤é”€æ‰€æœ‰æƒé™</span></span><br><span class="line"><span class="comment">-- æƒé™å±‚çº§</span></span><br><span class="line"><span class="comment">-- è¦ä½¿ç”¨GRANTæˆ–REVOKEï¼Œæ‚¨å¿…é¡»æ‹¥æœ‰GRANT OPTIONæƒé™ï¼Œå¹¶ä¸”æ‚¨å¿…é¡»ç”¨äºæ‚¨æ­£åœ¨æˆäºˆæˆ–æ’¤é”€çš„æƒé™ã€‚</span></span><br><span class="line">å…¨å±€å±‚çº§ï¼šå…¨å±€æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šæœåŠ¡å™¨ä¸­çš„æ‰€æœ‰æ•°æ®åº“ï¼Œmysql.user</span><br><span class="line">    <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> *.*å’Œ <span class="keyword">REVOKE</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> *.*åªæˆäºˆå’Œæ’¤é”€å…¨å±€æƒé™ã€‚</span><br><span class="line">æ•°æ®åº“å±‚çº§ï¼šæ•°æ®åº“æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰ç›®æ ‡ï¼Œmysql.db, mysql.host</span><br><span class="line">    <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> db_name.*å’Œ<span class="keyword">REVOKE</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> db_name.*åªæˆäºˆå’Œæ’¤é”€æ•°æ®åº“æƒé™ã€‚</span><br><span class="line">è¡¨å±‚çº§ï¼šè¡¨æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šè¡¨ä¸­çš„æ‰€æœ‰åˆ—ï¼Œmysql.talbes_priv</span><br><span class="line">    <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> db_name.tbl_nameå’Œ<span class="keyword">REVOKE</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> db_name.tbl_nameåªæˆäºˆå’Œæ’¤é”€è¡¨æƒé™ã€‚</span><br><span class="line">åˆ—å±‚çº§ï¼šåˆ—æƒé™é€‚ç”¨äºä¸€ä¸ªç»™å®šè¡¨ä¸­çš„å•ä¸€åˆ—ï¼Œmysql.columns_priv</span><br><span class="line">    å½“ä½¿ç”¨<span class="keyword">REVOKE</span>æ—¶ï¼Œæ‚¨å¿…é¡»æŒ‡å®šä¸è¢«æˆæƒåˆ—ç›¸åŒçš„åˆ—ã€‚</span><br><span class="line"><span class="comment">-- æƒé™åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">ALL</span> [<span class="keyword">PRIVILEGES</span>]    <span class="comment">-- è®¾ç½®é™¤GRANT OPTIONä¹‹å¤–çš„æ‰€æœ‰ç®€å•æƒé™</span></span><br><span class="line"><span class="keyword">ALTER</span>   <span class="comment">-- å…è®¸ä½¿ç”¨ALTER TABLE</span></span><br><span class="line"><span class="keyword">ALTER</span> ROUTINE   <span class="comment">-- æ›´æ”¹æˆ–å–æ¶ˆå·²å­˜å‚¨çš„å­ç¨‹åº</span></span><br><span class="line"><span class="keyword">CREATE</span>  <span class="comment">-- å…è®¸ä½¿ç”¨CREATE TABLE</span></span><br><span class="line"><span class="keyword">CREATE</span> ROUTINE  <span class="comment">-- åˆ›å»ºå·²å­˜å‚¨çš„å­ç¨‹åº</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLES</span>     <span class="comment">-- å…è®¸ä½¿ç”¨CREATE TEMPORARY TABLE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span>     <span class="comment">-- å…è®¸ä½¿ç”¨CREATE USER, DROP USER, RENAME USERå’ŒREVOKE ALL PRIVILEGESã€‚</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span>     <span class="comment">-- å…è®¸ä½¿ç”¨CREATE VIEW</span></span><br><span class="line"><span class="keyword">DELETE</span>  <span class="comment">-- å…è®¸ä½¿ç”¨DELETE</span></span><br><span class="line"><span class="keyword">DROP</span>    <span class="comment">-- å…è®¸ä½¿ç”¨DROP TABLE</span></span><br><span class="line"><span class="keyword">EXECUTE</span>     <span class="comment">-- å…è®¸ç”¨æˆ·è¿è¡Œå·²å­˜å‚¨çš„å­ç¨‹åº</span></span><br><span class="line"><span class="keyword">FILE</span>    <span class="comment">-- å…è®¸ä½¿ç”¨SELECT...INTO OUTFILEå’ŒLOAD DATA INFILE</span></span><br><span class="line"><span class="keyword">INDEX</span>   <span class="comment">-- å…è®¸ä½¿ç”¨CREATE INDEXå’ŒDROP INDEX</span></span><br><span class="line"><span class="keyword">INSERT</span>  <span class="comment">-- å…è®¸ä½¿ç”¨INSERT</span></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">TABLES</span>     <span class="comment">-- å…è®¸å¯¹æ‚¨æ‹¥æœ‰SELECTæƒé™çš„è¡¨ä½¿ç”¨LOCK TABLES</span></span><br><span class="line">PROCESS     <span class="comment">-- å…è®¸ä½¿ç”¨SHOW FULL PROCESSLIST</span></span><br><span class="line"><span class="keyword">REFERENCES</span>  <span class="comment">-- æœªè¢«å®æ–½</span></span><br><span class="line">RELOAD  <span class="comment">-- å…è®¸ä½¿ç”¨FLUSH</span></span><br><span class="line"><span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span>  <span class="comment">-- å…è®¸ç”¨æˆ·è¯¢é—®ä»å±æœåŠ¡å™¨æˆ–ä¸»æœåŠ¡å™¨çš„åœ°å€</span></span><br><span class="line"><span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span>   <span class="comment">-- ç”¨äºå¤åˆ¶å‹ä»å±æœåŠ¡å™¨ï¼ˆä»ä¸»æœåŠ¡å™¨ä¸­è¯»å–äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="comment">-- å…è®¸ä½¿ç”¨SELECT</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>  <span class="comment">-- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VIEW</span>   <span class="comment">-- å…è®¸ä½¿ç”¨SHOW CREATE VIEW</span></span><br><span class="line"><span class="keyword">SHUTDOWN</span>    <span class="comment">-- å…è®¸ä½¿ç”¨mysqladmin shutdown</span></span><br><span class="line">SUPER   <span class="comment">-- å…è®¸ä½¿ç”¨CHANGE MASTER, KILL, PURGE MASTER LOGSå’ŒSET GLOBALè¯­å¥ï¼Œmysqladmin debugå‘½ä»¤ï¼›å…è®¸æ‚¨è¿æ¥ï¼ˆä¸€æ¬¡ï¼‰ï¼Œå³ä½¿å·²è¾¾åˆ°max_connectionsã€‚</span></span><br><span class="line"><span class="keyword">UPDATE</span>  <span class="comment">-- å…è®¸ä½¿ç”¨UPDATE</span></span><br><span class="line"><span class="keyword">USAGE</span>   <span class="comment">-- â€œæ— æƒé™â€çš„åŒä¹‰è¯</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">OPTION</span>    <span class="comment">-- å…è®¸æˆäºˆæƒé™</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¡¨ç»´æŠ¤ */</span></span><br><span class="line"><span class="comment">-- åˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒ</span></span><br><span class="line"><span class="keyword">ANALYZE</span> [<span class="keyword">LOCAL</span> | <span class="keyword">NO_WRITE_TO_BINLOG</span>] <span class="keyword">TABLE</span> è¡¨å ...</span><br><span class="line"><span class="comment">-- æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯</span></span><br><span class="line"><span class="keyword">CHECK</span> <span class="keyword">TABLE</span> tbl_name [, tbl_name] ... [<span class="keyword">option</span>] ...</span><br><span class="line"><span class="keyword">option</span> = &#123;<span class="keyword">QUICK</span> | <span class="keyword">FAST</span> | <span class="keyword">MEDIUM</span> | <span class="keyword">EXTENDED</span> | <span class="keyword">CHANGED</span>&#125;</span><br><span class="line"><span class="comment">-- æ•´ç†æ•°æ®æ–‡ä»¶çš„ç¢ç‰‡</span></span><br><span class="line"><span class="keyword">OPTIMIZE</span> [<span class="keyword">LOCAL</span> | <span class="keyword">NO_WRITE_TO_BINLOG</span>] <span class="keyword">TABLE</span> tbl_name [, tbl_name] ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ‚é¡¹ */</span> <span class="comment">------------------</span></span><br><span class="line"><span class="number">1.</span> å¯ç”¨åå¼•å·ï¼ˆ<span class="string">`ï¼‰ä¸ºæ ‡è¯†ç¬¦ï¼ˆåº“åã€è¡¨åã€å­—æ®µåã€ç´¢å¼•ã€åˆ«åï¼‰åŒ…è£¹ï¼Œä»¥é¿å…ä¸å…³é”®å­—é‡åï¼ä¸­æ–‡ä¹Ÿå¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦ï¼</span></span><br><span class="line"><span class="string">2. æ¯ä¸ªåº“ç›®å½•å­˜åœ¨ä¸€ä¸ªä¿å­˜å½“å‰æ•°æ®åº“çš„é€‰é¡¹æ–‡ä»¶db.optã€‚</span></span><br><span class="line"><span class="string">3. æ³¨é‡Šï¼š</span></span><br><span class="line"><span class="string">    å•è¡Œæ³¨é‡Š # æ³¨é‡Šå†…å®¹</span></span><br><span class="line"><span class="string">    å¤šè¡Œæ³¨é‡Š /* æ³¨é‡Šå†…å®¹ */</span></span><br><span class="line"><span class="string">    å•è¡Œæ³¨é‡Š -- æ³¨é‡Šå†…å®¹     (æ ‡å‡†SQLæ³¨é‡Šé£æ ¼ï¼Œè¦æ±‚åŒç ´æŠ˜å·ååŠ ä¸€ç©ºæ ¼ç¬¦ï¼ˆç©ºæ ¼ã€TABã€æ¢è¡Œç­‰ï¼‰)</span></span><br><span class="line"><span class="string">4. æ¨¡å¼é€šé…ç¬¦ï¼š</span></span><br><span class="line"><span class="string">    _   ä»»æ„å•ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="string">    %   ä»»æ„å¤šä¸ªå­—ç¬¦ï¼Œç”šè‡³åŒ…æ‹¬é›¶å­—ç¬¦</span></span><br><span class="line"><span class="string">    å•å¼•å·éœ€è¦è¿›è¡Œè½¬ä¹‰ \'</span></span><br><span class="line"><span class="string">5. CMDå‘½ä»¤è¡Œå†…çš„è¯­å¥ç»“æŸç¬¦å¯ä»¥ä¸º ";", "\G", "\g"ï¼Œä»…å½±å“æ˜¾ç¤ºç»“æœã€‚å…¶ä»–åœ°æ–¹è¿˜æ˜¯ç”¨åˆ†å·ç»“æŸã€‚delimiter å¯ä¿®æ”¹å½“å‰å¯¹è¯çš„è¯­å¥ç»“æŸç¬¦ã€‚</span></span><br><span class="line"><span class="string">6. SQLå¯¹å¤§å°å†™ä¸æ•æ„Ÿ</span></span><br><span class="line"><span class="string">7. æ¸…é™¤å·²æœ‰è¯­å¥ï¼š\c</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> è®¡ç®—æœºåŸºç¡€çŸ¥è¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€‘é“¾è¡¨åŠç›¸å…³é—®é¢˜</title>
      <link href="/2019/Structure-and-Algorithm-Linkedlist/"/>
      <url>/2019/Structure-and-Algorithm-Linkedlist/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><img src="https://img.garenhou.com/diagram.jpeg" alt="é“¾è¡¨"></p><blockquote><p><strong>é“¾è¡¨</strong>(Linked list)ç›¸å…³ç®—æ³•é¢˜åœ¨é¢è¯•ä¸­å¾ˆå¸¸è§ï¼Œæœ¬æ–‡å°†è¯¦ç»†ä»‹ç»é“¾è¡¨ç›¸å¯¹å¤æ‚çš„æ“ä½œï¼Œå¹¶ç”¨Javaè¯­è¨€å®ç°ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šå»ºç«‹å¸¦ç¯é“¾è¡¨ï¼ˆåŒºåˆ«äºå¾ªç¯é“¾è¡¨ï¼‰ã€åˆ¤æ–­é“¾è¡¨æ˜¯å¦å¸¦ç¯ï¼Œæ±‚å¾—ç¯å…¥å£ç»“ç‚¹åŠç¯çš„é•¿åº¦ï¼›åˆ¤æ–­ä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸äº¤ã€æ±‚å¾—äº¤ç‚¹ï¼›æŸ¥æ‰¾å€’æ•°ç¬¬Kä¸ªç»“ç‚¹ï¼›åè½¬é“¾è¡¨ã€‚åœ¨LeetCodeå’Œå‰‘æŒ‡Offerä¸­å‡ºç°çš„é“¾è¡¨é—®é¢˜ï¼ŒåŸºæœ¬åŸºäºè¿™å‡ ä¸ªæ“ä½œã€‚ï¼ˆåæ­£æˆ‘æ˜¯ä¸€æ–‡ææ‡‚å•¦~ï¼‰å…¶ä»–ç®€å•çš„æ“ä½œå®ç°åœ¨æ–‡åé“¾æ¥ä¸­ã€‚</p><p><strong>å­¦ä¹ ç›®çš„</strong>ï¼šæŒæ¡é“¾è¡¨ç›¸å…³æ“ä½œï¼Œç†Ÿç»ƒä½¿ç”¨<strong>åŒæŒ‡é’ˆæ³•</strong>(å¿«æ…¢æŒ‡é’ˆæ³•)</p></blockquote><a id="more"></a><h2 id="ä¸€-å¸¦ç¯å•é“¾è¡¨ç›¸å…³é—®é¢˜"><a href="#ä¸€-å¸¦ç¯å•é“¾è¡¨ç›¸å…³é—®é¢˜" class="headerlink" title="ä¸€. å¸¦ç¯å•é“¾è¡¨ç›¸å…³é—®é¢˜"></a>ä¸€. å¸¦ç¯å•é“¾è¡¨ç›¸å…³é—®é¢˜</h2><h3 id="1-å¸¦ç¯å•é“¾è¡¨å»ºç«‹"><a href="#1-å¸¦ç¯å•é“¾è¡¨å»ºç«‹" class="headerlink" title="1. å¸¦ç¯å•é“¾è¡¨å»ºç«‹"></a>1. å¸¦ç¯å•é“¾è¡¨å»ºç«‹</h3><blockquote><p>çœ‹è¿‡çš„è§£å†³å¸¦ç¯é“¾è¡¨é—®é¢˜çš„æ–‡ç« ï¼Œéƒ½åªè®¨è®ºæ€æ ·æ±‚å¾—ç¯å…¥å£ç»“ç‚¹å’Œç¯é•¿åº¦ï¼Œåšä¸»è¿™ç§æ¸£æ¸£å°±åœ¨æƒ³æ€ä¹ˆä¸è®²æ€ä¹ˆå»ºç«‹å¸¦ç¯é“¾è¡¨ï¼Œéƒ½æ²¡æœ‰åŠæ³•éªŒè¯â€¦â€¦äºæ˜¯è‡ªå·±å†™äº†ã€‚</p></blockquote><p><strong>ä»£ç </strong>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@description</span> å»ºç«‹ä¸€ä¸ªå¸¦ç¯å•é“¾è¡¨</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLoopList</span><span class="params">(Node&lt;E&gt; head)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> i;</span><br><span class="line">     Node&lt;E&gt; current = head;</span><br><span class="line">     Node&lt;E&gt; target = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">         Node&lt;E&gt; temp = <span class="keyword">new</span> Node(i);</span><br><span class="line">         temp.next = <span class="keyword">null</span>;</span><br><span class="line">         current.next = temp;</span><br><span class="line">         <span class="keyword">this</span>.size++;</span><br><span class="line">         <span class="keyword">if</span> (i == <span class="number">6</span>)</span><br><span class="line">             target = temp;<span class="comment">//æŒ‡å®šè¿™ä¸ªç»“ç‚¹ä¸ºç¯çš„ç¬¬ä¸€ä¸ªç»“ç‚¹</span></span><br><span class="line">         current = temp;</span><br><span class="line">     &#125;</span><br><span class="line">     current.next = target;  <span class="comment">//é“¾è¡¨æœ«ç«¯æŒ‡å‘ä¸­é—´çš„ä¸€ä¸ªç»“ç‚¹ï¼Œè¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªå¸¦ç¯å•é“¾è¡¨</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="2-åˆ¤æ–­é“¾è¡¨æ˜¯å¦å¸¦ç¯"><a href="#2-åˆ¤æ–­é“¾è¡¨æ˜¯å¦å¸¦ç¯" class="headerlink" title="2.åˆ¤æ–­é“¾è¡¨æ˜¯å¦å¸¦ç¯"></a>2.åˆ¤æ–­é“¾è¡¨æ˜¯å¦å¸¦ç¯</h3><p><img src="https://img.garenhou.com/diagram.jpeg" alt="å¸¦ç¯é“¾è¡¨"></p><p><strong>ç®—æ³•æ€æƒ³</strong>ï¼šå›¾ä¸­æ˜¯ä¸€ä¸ªå¸¦ç¯å•é“¾è¡¨ï¼Œè¿™é‡Œè¦åŒºåˆ†ï¼Œå¾ªç¯é“¾è¡¨å¹¶éè¿™é‡Œæ‰€è®¨è®ºçš„å¸¦ç¯å•é“¾è¡¨ã€‚è¿™é‡Œåˆ¤æ–­é“¾è¡¨æ˜¯å¦å¸¦ç¯é‡‡ç”¨çš„ä¾¿æ˜¯çš„<strong>åŒæŒ‡é’ˆæ³•</strong>ï¼Œä¹‹åä¹Ÿä¼šå¸¸ç”¨åˆ°æ­¤æ–¹æ³•ï¼Œåº”ç”¨åŒæŒ‡é’ˆçš„ç®—æ³•<strong>æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)</strong>ã€‚åŒæŒ‡é’ˆæ³•ï¼Œå³è®¾ç½®å¿«æ…¢æŒ‡é’ˆï¼Œåœ¨åˆ¤æ–­æ˜¯å¦å¸¦ç¯æ—¶ï¼Œæˆ‘ä»¬è®©å¿«æŒ‡é’ˆæ¯æ¬¡èµ°ä¸¤ä¸ªæ­¥é•¿ï¼ˆå³fast=fast-&gt;next-&gt;nextï¼‰ï¼Œæ…¢æŒ‡é’ˆæ¯æ¬¡èµ°ä¸€ä¸ªæ­¥é•¿ï¼ˆå³slow=slow-&gt;nextï¼‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœé“¾è¡¨å¸¦ç¯ï¼Œåˆ™å¿«æŒ‡é’ˆæ—©æ™šä¼šç»è¿‡ä¸æ‡ˆåŠªåŠ›å†æ¬¡è¿½èµ¶ä¸Šæ…¢æŒ‡é’ˆï¼Œå¹¶ä¸”ä¸¤æŒ‡é’ˆä¸€å®šåœ¨ç¯ä¸Šç›¸é‡ã€‚</p><p>&emsp;&emsp;p.s.:ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æ ‡å¿—ä½çš„æ–¹æ³•ï¼Œä½†æ˜¯ç©ºé—´å¤æ‚åº¦è¾ƒé«˜ã€‚</p><p><strong>ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  * <span class="doctag">@description</span> åˆ¤æ–­å•é“¾è¡¨æ˜¯å¦æœ‰ç¯(åŒæŒ‡é’ˆæ³•)--æ—¶é—´å¤æ‚åº¦O(n);ç©ºé—´å¤æ‚åº¦O(1)[è®¾ç½®æ ‡å¿—ä½ç©ºé—´å¤æ‚åº¦å¤§]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasLoop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     Node&lt;E&gt; pre = head.next;</span><br><span class="line">     Node&lt;E&gt; post = head.next;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (pre == <span class="keyword">null</span>)</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     <span class="keyword">while</span> (pre != <span class="keyword">null</span> &amp;&amp; pre.next != <span class="keyword">null</span> &amp;&amp; pre.next.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">         post = post.next;   <span class="comment">//æ…¢æŒ‡é’ˆèµ°ä¸€æ­¥</span></span><br><span class="line">         pre = pre.next.next;   <span class="comment">//å¿«æŒ‡é’ˆèµ°ä¸¤æ­¥</span></span><br><span class="line">         <span class="keyword">if</span> (pre == post)</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ±‚ç¯å…¥å£ç»“ç‚¹"><a href="#3-æ±‚ç¯å…¥å£ç»“ç‚¹" class="headerlink" title="3.æ±‚ç¯å…¥å£ç»“ç‚¹"></a>3.æ±‚ç¯å…¥å£ç»“ç‚¹</h3><p><img src="https://img.garenhou.com/LoopList.png" alt="å¸¦ç¯é“¾è¡¨"></p><p>&emsp;&emsp;æ‰¾åˆ°ç¯çš„å…¥å£ç»“ç‚¹ï¼Œä»ç„¶ä½¿ç”¨åŒæŒ‡é’ˆæ³•ï¼Œæˆ‘ä»¬è®¾å…¥å£ç»“ç‚¹åˆ°å¤´ç»“ç‚¹è·ç¦»ä¸ºeï¼Œå¿«æ…¢æŒ‡é’ˆç›¸é‡ç‚¹åˆ°å¤´ç»“ç‚¹è·ç¦»ä¸ºmï¼Œè®¾ç¯çš„é•¿åº¦ä¸ºLï¼Œå¿«æŒ‡é’ˆä¸æ…¢æŒ‡é’ˆç›¸é‡æ—¶ï¼Œæ…¢æŒ‡é’ˆèµ°sæ­¥ï¼Œåˆ™å¿«æŒ‡é’ˆèµ°2sæ­¥ï¼Œä¸”å¿«æŒ‡é’ˆè¿½ä¸Šæ…¢æŒ‡é’ˆæ˜¯åœ¨èµ°äº†næ¬¡ç¯çš„é•¿åº¦ä¹‹åï¼Œåˆ™æœ‰ï¼š$s=e+m$ï¼›$2s=e+nL+m$ æ‰€ä»¥ï¼Œ$nL=e+m$ ;$e=nL-m$ ; å³å¾—å‡ºï¼š<strong>ç›¸é‡ç‚¹åˆ°å…¥å£ç»“ç‚¹è·ç¦»=å¤´ç»“ç‚¹åˆ°ç›¸é‡ç‚¹è·ç¦»</strong><br>æ ¹æ®è¿™ä¸€ç»“è®ºï¼Œå½“ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡æ—¶ï¼Œæˆ‘ä»¬è®©æ…¢æŒ‡é’ˆæŒ‡å›å¤´ç»“ç‚¹å¤„ï¼Œå¿«æŒ‡é’ˆä»ç„¶æŒ‡å‘ç›¸é‡ç»“ç‚¹ï¼Œæ­¤æ—¶ä¸¤æŒ‡é’ˆåŒæ—¶å‰è¿›ï¼Œæ¯æ¬¡ä¸€æ­¥é•¿ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“ä»–ä»¬å†æ¬¡ç›¸é‡å°±æ˜¯åœ¨ç¯çš„å…¥å£ç»“ç‚¹å¤„å•¦ï¼ã€‚æ—¶é—´å¤æ‚åº¦O(n)ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  * <span class="doctag">@description</span> æ‰¾åˆ°ç¯çš„å…¥å£ç»“ç‚¹ï¼šç›¸é‡ç‚¹åˆ°è¿æ¥ç‚¹çš„è·ç¦»=å¤´æŒ‡é’ˆåˆ°è¿æ¥ç‚¹çš„è·ç¦»</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Node&lt;E&gt; <span class="title">getEntranceNode</span><span class="params">(Node&lt;E&gt; head)</span> </span>&#123;</span><br><span class="line">     Node&lt;E&gt; pre = head; <span class="comment">//è®¾ç½®ä¸¤æŒ‡é’ˆåŒæ—¶æŒ‡å‘å¤´ç»“ç‚¹</span></span><br><span class="line">     Node&lt;E&gt; post = head;</span><br><span class="line">     <span class="keyword">if</span> (pre.next == <span class="keyword">null</span> || post.next == <span class="keyword">null</span>)</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">while</span> (pre.next != <span class="keyword">null</span> &amp;&amp; post.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">         post = post.next;</span><br><span class="line">         pre = pre.next.next;</span><br><span class="line">         <span class="keyword">if</span> (post == pre) &#123;    <span class="comment">//ç›¸ç­‰ï¼Œåˆ™å•é“¾è¡¨æœ‰ç¯</span></span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     post = head; <span class="comment">//æ­¤æ—¶,ä¸¤ä¸ªæŒ‡é’ˆéƒ½åœ¨ç›¸é‡èŠ‚ç‚¹å¤„,è®©ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¤´ç»“ç‚¹å¤„,å¦ä¸€ä¸ªæŒ‡å‘ç›¸é‡ç»“ç‚¹</span></span><br><span class="line">     <span class="keyword">while</span> (post != pre) &#123;</span><br><span class="line">         post = post.next; <span class="comment">//ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶å‰è¿›ï¼Œæœ€åä¸€å®šç›¸é‡åœ¨ç¯å…¥å£ç»“ç‚¹</span></span><br><span class="line">         pre = pre.next;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> post; <span class="comment">//ç¯å…¥å£ç»“ç‚¹</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="4-æ±‚ç¯çš„é•¿åº¦"><a href="#4-æ±‚ç¯çš„é•¿åº¦" class="headerlink" title="4.æ±‚ç¯çš„é•¿åº¦"></a>4.æ±‚ç¯çš„é•¿åº¦</h3><p><strong>ç®—æ³•æ€æƒ³</strong>ï¼šæœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œæ±‚ç¯çš„é•¿åº¦å°±å¾ˆç®€å•å•¦ï¼Œæ–¹æ³•å°±æ˜¯åœ¨æ‰¾åˆ°å…¥å£ç»“ç‚¹çš„åŸºç¡€ä¸Šï¼Œè®©ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å…¥å£ç»“ç‚¹ï¼Œéå†ç›´åˆ°å†å›åˆ°å…¥å£ç»“ç‚¹ï¼Œèµ°è¿‡çš„é•¿åº¦å°±æ˜¯ç¯çš„é•¿åº¦Lã€‚æ—¶é—´å¤æ‚åº¦O(n)ã€‚</p><p><strong>ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  * <span class="doctag">@description</span> æ±‚ç¯çš„é•¿åº¦ï¼šè®©æŒ‡é’ˆæŒ‡å‘å…¥å£èŠ‚ç‚¹ï¼Œéå†ç›´åˆ°å›åˆ°å…¥å£èŠ‚ç‚¹ï¼Œèµ°è¿‡çš„é•¿åº¦å³ç¯çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">loopLength</span><span class="params">(Node&lt;E&gt; head)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!<span class="keyword">this</span>.hasLoop()) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">int</span> length = <span class="number">1</span>;</span><br><span class="line">     Node&lt;E&gt; enter = <span class="keyword">this</span>.getEntranceNode(<span class="keyword">this</span>.getHead());</span><br><span class="line">     Node&lt;E&gt; cur = enter.next;</span><br><span class="line">     <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123; <span class="comment">//ä»ç¯å…¥å£å¼€å§‹å†å›åˆ°ç¯ã€‚</span></span><br><span class="line">         length++;</span><br><span class="line">         cur = cur.next;</span><br><span class="line">         <span class="keyword">if</span> (cur == enter) &#123;</span><br><span class="line">             <span class="keyword">return</span> length;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> length;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="äºŒ-é“¾è¡¨ç›¸äº¤é—®é¢˜"><a href="#äºŒ-é“¾è¡¨ç›¸äº¤é—®é¢˜" class="headerlink" title="äºŒ. é“¾è¡¨ç›¸äº¤é—®é¢˜"></a>äºŒ. é“¾è¡¨ç›¸äº¤é—®é¢˜</h2><h3 id="1-åˆ¤æ–­å½“å‰é“¾è¡¨ä¸ç›®æ ‡é“¾è¡¨æ˜¯å¦ç›¸äº¤"><a href="#1-åˆ¤æ–­å½“å‰é“¾è¡¨ä¸ç›®æ ‡é“¾è¡¨æ˜¯å¦ç›¸äº¤" class="headerlink" title="1. åˆ¤æ–­å½“å‰é“¾è¡¨ä¸ç›®æ ‡é“¾è¡¨æ˜¯å¦ç›¸äº¤"></a>1. åˆ¤æ–­å½“å‰é“¾è¡¨ä¸ç›®æ ‡é“¾è¡¨æ˜¯å¦ç›¸äº¤</h3><p><img src="https://img.garenhou.com/LoopList.png" alt="å¸¦ç¯é“¾è¡¨"></p><p>å¦‚å›¾ï¼Œåˆ¤æ–­ä¸¤é“¾è¡¨æ˜¯å¦ç›¸äº¤å–å†³äºå°¾ç»“ç‚¹æ˜¯å¦ç›¸åŒï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œç›´æ¥çœ‹ä»£ç ã€‚</p><p><strong>ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> list2</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  * <span class="doctag">@description</span> åˆ¤æ–­å½“å‰é“¾è¡¨ä¸ç›®æ ‡é“¾è¡¨æ˜¯å¦ç›¸äº¤(ç›¸äº¤ä¸å¦å–å†³äºå°¾èŠ‚ç‚¹æ˜¯å¦ç›¸åŒ)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIntersect</span><span class="params">(LinkedList&lt;E&gt; list2)</span> </span>&#123;</span><br><span class="line">     Node&lt;E&gt; cur1 = head.next;   <span class="comment">// å½“å‰é“¾è¡¨</span></span><br><span class="line">     Node&lt;E&gt; cur2 = list2.getHead().next;  <span class="comment">// ç›®æ ‡é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// ä¸¤é“¾è¡¨æœ‰ä¸€ä¸ªä¸ºç©ºï¼Œåˆ™è¿”å› false</span></span><br><span class="line">     <span class="keyword">if</span> (cur1 == <span class="keyword">null</span> || cur2 == <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// éå†åˆ°ç¬¬ä¸€ä¸ªé“¾è¡¨çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">     <span class="keyword">while</span> (cur1.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">         cur1 = cur1.next;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// éå†åˆ°ç¬¬äºŒä¸ªé“¾è¡¨çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">     <span class="keyword">while</span> (cur2.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">         cur2 = cur2.next;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> cur1 == cur2;  <span class="comment">// å°¾èŠ‚ç‚¹æ˜¯å¦ç›¸åŒ</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ±‚ç›¸äº¤é“¾è¡¨äº¤ç‚¹"><a href="#2-æ±‚ç›¸äº¤é“¾è¡¨äº¤ç‚¹" class="headerlink" title="2.æ±‚ç›¸äº¤é“¾è¡¨äº¤ç‚¹"></a>2.æ±‚ç›¸äº¤é“¾è¡¨äº¤ç‚¹</h3><p><strong>ç®—æ³•æ€æƒ³</strong></p><ul><li>Brute Force ç®—æ³•ï¼šå³éå†ç¬¬ä¸€ä¸ªé“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒåŒæ—¶éå†ç¬¬äºŒä¸ªé“¾è¡¨ï¼Œçœ‹æ˜¯å¦æœ‰ç›¸åŒçš„èŠ‚ç‚¹ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹å³ç¬¬ä¸€ä¸ªäº¤ç‚¹ã€‚å¦‚æœç¬¬ä¸€ä¸ªé“¾è¡¨éå†ç»“æŸåï¼Œè¿˜æœªæ‰¾åˆ°ç›¸åŒçš„èŠ‚ç‚¹ï¼Œå³ä¸å­˜åœ¨äº¤ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦ä¸º$O(n^2)$ã€‚æ•ˆç‡ä¸é«˜ï¼Œä¸ä½œé‡ç‚¹è®¨è®ºã€‚</li><li>å¼•å…¥æ ˆï¼šä¼˜åŒ–ä¸€ä¸‹ï¼Œå¼•å…¥æ ˆï¼Œä»¥ç©ºé—´æ¢æ—¶é—´ã€‚åˆ™éœ€è¦åˆ›å»ºä¸¤ä¸ªæ ˆæ¥åˆ†åˆ«å­˜å‚¨ä¸¤ä¸ªé“¾è¡¨çš„ç»“ç‚¹ï¼Œéå†è¿‡çš„ç»“ç‚¹å…¥æ ˆï¼Œå…¥æ ˆç»“æŸåï¼Œé€šè¿‡åˆ¤æ–­ç»“ç‚¹æ˜¯å¦ç›¸ç­‰æ¥åˆ¤æ–­æ˜¯å¦ç›¸äº¤ï¼Œç›¸ç­‰çš„ç»“ç‚¹å³ä¸ºäº¤ç‚¹ã€‚å¼•å…¥æ ˆï¼Œç©ºé—´å¤æ‚åº¦è¾ƒé«˜ï¼Œä½†æ¯”è¾ƒç®€ä¾¿ã€‚</li><li>æ ¹æ®é“¾è¡¨é•¿åº¦ï¼š å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œé€šè¿‡è·å¾—ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦åï¼Œæˆ‘ä»¬æ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨å“ªä¸€ä¸ªé•¿ï¼Œè®¾è¾ƒé•¿çš„é“¾è¡¨é•¿åº¦ä¸ºlen1ï¼ŒçŸ­çš„é“¾è¡¨é•¿åº¦ä¸ºlen2ã€‚å…ˆè®©è¾ƒé•¿çš„é“¾è¡¨å‘åç§»åŠ¨(len1-len2)ä¸ªæ­¥ï¼Œç„¶åä»å½“å‰ä½ç½®åŒæ—¶éå†ä¸¤ä¸ªé“¾è¡¨ï¼Œå½“éå†åˆ°çš„é“¾è¡¨çš„èŠ‚ç‚¹ç›¸åŒæ—¶ï¼Œåˆ™è¿™ä¸ªç»“ç‚¹å°±æ˜¯äº¤ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚</li></ul><p><strong>ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span> è¿”å›ä¸¤é“¾è¡¨çš„äº¤ç‚¹(è‹¥ä¸ç›¸äº¤ï¼Œè¿”å›null)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node&lt;E&gt; <span class="title">getIntersectionPoint</span><span class="params">(LinkedList&lt;E&gt; list2)</span> </span>&#123;</span><br><span class="line">        Node&lt;E&gt; cur1 = head.next;</span><br><span class="line">        Node&lt;E&gt; cur2 = list2.getHead().next;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isIntersect(list2)) &#123;</span><br><span class="line">            <span class="keyword">int</span> step = Math.abs(<span class="keyword">this</span>.size - list2.size);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.size &gt; list2.size) &#123;</span><br><span class="line">                <span class="keyword">while</span> (step &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    cur1 = cur1.next;</span><br><span class="line">                    step--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.size &lt; list2.size) &#123;</span><br><span class="line">                <span class="keyword">while</span> (step &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    cur2 = cur2.next;</span><br><span class="line">                    step--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (cur1 != cur2) &#123;</span><br><span class="line">                cur1 = cur1.next;</span><br><span class="line">                cur2 = cur2.next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> cur1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-æŸ¥æ‰¾æŒ‡å®šç»“ç‚¹"><a href="#ä¸‰-æŸ¥æ‰¾æŒ‡å®šç»“ç‚¹" class="headerlink" title="ä¸‰.æŸ¥æ‰¾æŒ‡å®šç»“ç‚¹"></a>ä¸‰.æŸ¥æ‰¾æŒ‡å®šç»“ç‚¹</h2><h3 id="1-æŸ¥æ‰¾å€’æ•°ç¬¬Kä¸ªç»“ç‚¹"><a href="#1-æŸ¥æ‰¾å€’æ•°ç¬¬Kä¸ªç»“ç‚¹" class="headerlink" title="1.æŸ¥æ‰¾å€’æ•°ç¬¬Kä¸ªç»“ç‚¹"></a>1.æŸ¥æ‰¾å€’æ•°ç¬¬Kä¸ªç»“ç‚¹</h3><p><strong>ç®—æ³•æ€æƒ³</strong>ï¼šåœ¨ä¸çŸ¥é“é“¾è¡¨é•¿åº¦çš„æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾å•é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹å…ƒç´ ï¼Œåˆç”¨åˆ°æœ¬æ–‡ç»å¯¹ä¸»è§’â€”åŒæŒ‡é’ˆæ³•ï¼Œå…·ä½“æ“ä½œä¸ºï¼šè®©å¿«æŒ‡é’ˆå…ˆèµ°K-1ä¸ªæ­¥é•¿ï¼Œæ…¢æŒ‡é’ˆåœç•™åœ¨å¤´ç»“ç‚¹å¤„ï¼Œå½“å¿«æŒ‡é’ˆèµ°åˆ°é“¾è¡¨æœ«ç«¯æ—¶ï¼Œæ…¢æŒ‡é’ˆæ‰€æŒ‡å‘çš„åˆšå¥½å°±æ˜¯å€’æ•°ç¬¬Kä¸ªç»“ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚ï¼ˆå¾ˆå®¹æ˜“ç†è§£å§</p><p><strong>ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@description</span> æ‰¾å‡ºå•é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªå…ƒç´ (å‰æ : ä¸çŸ¥é“size ; åŒæŒ‡é’ˆæ³•, ç›¸å·®K - 1æ­¥) --------------------æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> k</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Node&lt;E&gt; <span class="title">getKthFromEnd</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">     Node&lt;E&gt; pre = head.next;</span><br><span class="line">     Node&lt;E&gt; post = head.next;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; k; i++) &#123; <span class="comment">// preå…ˆèµ°k-1æ­¥</span></span><br><span class="line">         <span class="keyword">if</span> (pre != <span class="keyword">null</span>) &#123;</span><br><span class="line">             pre = pre.next;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (pre != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="comment">// å½“preèµ°åˆ°é“¾è¡¨æœ«ç«¯æ—¶ï¼Œpostæ­£å¥½æŒ‡å‘å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹</span></span><br><span class="line">         <span class="keyword">while</span> (pre != <span class="keyword">null</span> &amp;&amp; pre.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">             pre = pre.next;</span><br><span class="line">             post = post.next;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> post;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="2-æŸ¥æ‰¾é“¾è¡¨ä¸­é—´ç»“ç‚¹"><a href="#2-æŸ¥æ‰¾é“¾è¡¨ä¸­é—´ç»“ç‚¹" class="headerlink" title="2.æŸ¥æ‰¾é“¾è¡¨ä¸­é—´ç»“ç‚¹"></a>2.æŸ¥æ‰¾é“¾è¡¨ä¸­é—´ç»“ç‚¹</h4><p><strong>ç®—æ³•æ€æƒ³</strong>ï¼šåŒæ ·è¿˜æ˜¯åŒæŒ‡é’ˆæ³•ï¼Œæˆ‘ä»¬è®©å¿«æ…¢æŒ‡é’ˆåŒæ—¶å‡ºå‘ï¼Œå¿«æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤ä¸ªæ­¥é•¿ï¼Œæ…¢æŒ‡é’ˆèµ°ä¸€ä¸ªæ­¥é•¿ï¼Œå½“å¿«æŒ‡é’ˆèµ°åˆ°é“¾è¡¨æœ«ç«¯(æˆ–ä¸‹ä¸€ä¸ªã€ä¸‹ä¸‹ä¸ªç»“ç‚¹ä¸ºæœ«ç«¯)æ—¶ï¼Œæ…¢æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç»“ç‚¹å°±æ˜¯ä¸­é—´ç»“ç‚¹ã€‚å¦‚æœå¿«æŒ‡é’ˆä¸‹ä¸€ç»“ç‚¹å°±æ˜¯æœ«ç«¯ï¼Œåˆ™è¯´æ˜é“¾è¡¨é•¿åº¦ä¸ºå¶æ•°ï¼Œåˆ™æ…¢æŒ‡é’ˆå½“å‰ä½ç½®çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºä¸­é—´ç»“ç‚¹ã€‚æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚</p><p><strong>ä»£ç </strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@description</span> å¯»æ‰¾å•é“¾è¡¨ä¸­çš„ä¸­é—´èŠ‚ç‚¹(åŒæŒ‡é’ˆæ³•)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printMiddleNodes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Node&lt;E&gt; index1 = head.next; <span class="comment">// æ…¢æŒ‡é’ˆ</span></span><br><span class="line">      Node&lt;E&gt; index2 = head.next; <span class="comment">// å¿«æŒ‡é’ˆ</span></span><br><span class="line">      <span class="keyword">if</span> (head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">          System.out.println(index1.data);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> (index2 != <span class="keyword">null</span> &amp;&amp; index2.next != <span class="keyword">null</span></span><br><span class="line">              &amp;&amp; index2.next.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">          index1 = index1.next;</span><br><span class="line">          index2 = index2.next.next;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"é“¾è¡¨ä¸­é—´ç»“ç‚¹ä¸ºï¼š"</span> + index1.data); <span class="comment">// ç¬¬ä¸€ä¸ªä¸­é—´èŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> (index2.next != <span class="keyword">null</span>) &#123; <span class="comment">// å½“é“¾è¡¨é•¿åº¦ä¸ºå¶æ•°æ—¶ï¼Œæ‰“å°ç¬¬äºŒä¸ªä¸­é—´èŠ‚ç‚¹</span></span><br><span class="line">          System.out.println(<span class="string">"é“¾è¡¨ä¸­é—´ç»“ç‚¹ä¸ºï¼š"</span> + index1.next.data);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="å››-åè½¬é“¾è¡¨"><a href="#å››-åè½¬é“¾è¡¨" class="headerlink" title="å››.åè½¬é“¾è¡¨"></a>å››.åè½¬é“¾è¡¨</h2><p>ç†è§£èµ·æ¥å¾ˆç®€å•ï¼Œè§ä»£ç </p><p><strong>ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> åè½¬é“¾è¡¨ï¼ˆåˆ©ç”¨å‰åæŒ‡é’ˆï¼Œæ¯ä¸ªç»“ç‚¹çš„nextéƒ½è¦æ›´æ–°ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reverseLinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.print(<span class="string">"åè½¬åé“¾è¡¨ä¸º: "</span>);</span><br><span class="line">    Node&lt;E&gt; cur = head.next; <span class="comment">// åŸé“¾è¡¨</span></span><br><span class="line">    Node&lt;E&gt; pre = <span class="keyword">null</span>; <span class="comment">// åè½¬åçš„é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123; <span class="comment">// å¯¹åŸé“¾è¡¨ä¸­çš„æ¯ä¸ªç»“ç‚¹è¿›è¡Œåè½¬</span></span><br><span class="line">        Node&lt;E&gt; next = cur.next;  <span class="comment">//è®°å½•å½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</span></span><br><span class="line">        cur.next = pre; <span class="comment">//æ›´æ–°å½“å‰ç»“ç‚¹çš„next</span></span><br><span class="line">        pre = cur; <span class="comment">//preåç§»</span></span><br><span class="line">        cur = next; <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">    head.next = pre;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>æœ¬æ–‡å…¨éƒ¨ä»£ç ï¼š è§<em><a href="https://github.com/Garen2994/DataStructure-Demo/tree/master/src/garen/demo/Linkedlist" target="_blank" rel="noopener">GitHub</a></em></p><blockquote><p><em>ä¸æ–­ä¼˜åŒ–å°±æ˜¯ç®—æ³•çš„é­…åŠ›æ‰€åœ¨ï¼Œé€šè¿‡æ€»ç»“æ›´åŠ èƒ½å¤Ÿç†è§£ç®—æ³•çš„ä¼˜åŒ–æ€æƒ³ï¼Œåœ¨é“¾è¡¨é—®é¢˜ä¸­ï¼ŒåŒæŒ‡é’ˆæ³•èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ï¼Œä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸åŒä½¿ç”¨æ–¹æ³•ï¼Œå°±å¯ä»¥ç”¨å‡ºâ€œç¥å¥‡çš„â€æ•ˆæœã€‚æ¯å½“é‡åˆ°è¿™äº›ç±»ä¼¼é—®é¢˜ï¼Œå…ˆæƒ³ä¸€æƒ³åŒæŒ‡é’ˆæ³•èƒ½ä¸èƒ½ç”¨ï¼Œå»æ€è€ƒï¼Œå»ä¼˜åŒ–ï¼Œç®—æ³•ï¼Œæ˜¯ ä¼˜åŒ– çš„è‰ºæœ¯ã€‚</em></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Structure and algorithm </category>
          
          <category> Linked list </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Structure and algorithm </tag>
            
            <tag> Linked list </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
